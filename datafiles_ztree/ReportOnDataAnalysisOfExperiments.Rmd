---
title: "Report on data analysis of Data Analysis of Experiments"
author: "Vinh Dang"
date: "4 November 2015"
output: pdf_document
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=6, fig.height=8, fig.path='all_data/',
                      warning=FALSE, message=FALSE, tidy=TRUE, tidy.opts=list(width.cutoff=50))
```

```{r, echo=FALSE}
  # Convert a vector to Z_score
make_scale <- function (v, num_grp) {
  res = as.numeric()
  num_row_per_grp = length(v) / num_grp
  for (grp_id in 1:num_grp) {
    first_round = 1 + num_row_per_grp * (grp_id - 1)
    last_round = num_row_per_grp * grp_id
    cur_data <- v[first_round:last_round]
    mean_cur_data <- mean (cur_data)
    sd_cur_data <- pop.sd(cur_data)
    for (user_id in 1:num_row_per_grp) {
      z_value = (cur_data[user_id] - mean_cur_data) / sd_cur_data
      res <- c (res, z_value)
    }
  }
  res
}
```

# Summary

Summary of all findings in the data analysis:

* Analyze by games
  ** People send more in ID, Score and Combine Games than Simple Game. The behavior of 3 info games are similar.
  ** People send back more in ID, Score and Combine Games than Simple Game.
  ** Profit of ID, Score and Combine Games are much higher than Simple Game.
* Analyze by information showed to users
  ** Showing trust and showing ID let people send more than not showing
* Group effect on game position
  ** There is group interaction on game position, but there is no effect of game position on behavior.
* Group effect on behavior
  ** There is no group effect on showing trust and ID.
  ** The effect of showing Trust in Sender is less than in Receiver
  ** The effect of showing Trust and ID is significant in Profit
* Effect by group
  ** There is no special thing
* Predicting the behavior
  ** Using two trust scores (by own player and partner), we can predict well the behavior of partner
* Group interaction on predicing power
  ** There is Group interaction on predicting power
* Comparing data
  ** The Simple Game is consistency with Giangiacomo
  ** Dubois's data is not useful, there is no effect of treatment, but there is for group interaction.
* Behavior over time
  ** There is no evidence to say that behavior decrease over time.
* Questionnaire analysis
  ** There is no consistency between questionnaire and real data.

\pagebreak

#Data Preparation

All data have been collected by running expriments from zTree and zLeaf 3.4.7.

There are 5 experiments so far, and both data files (XLS) and questionaire files (SBJ) have been put in the directory called "all_data". Through the document, the term "experiment" (5 experiments) and group (5 groups) are used interchangelly.

Here we set up the working space

```{r setup}

#Read data files into R
source ("ProcessData.R")
zTT <- readMultiXLS ("./all_data")
SBJs <- processMultiSBJ ("./all_data")

# Create my sending proportional
zTT[2]$subjects$my_send_proportional <- ifelse(zTT[2]$subjects$Type == 0, zTT[2]$subjects$Contribution/10, ifelse(zTT[2]$subjects$PartnerDecision > 0, zTT[2]$subjects$Contribution/3/zTT[2]$subjects$PartnerDecision, -1))

# add epsilon value to avoid the case 0/0
# EPSILON = 0.001
# zTT[2]$subjects$my_send_proportional <- ifelse(zTT[2]$subjects$Type == 0, zTT[2]$subjects$Contribution/10,  zTT[2]$subjects$Contribution/3/ (zTT[2]$subjects$PartnerDecision + EPSILON))

zTT[2]$subjects$CurrGameProfit <- ifelse(zTT[2]$subjects$Type == 0, zTT[2]$subjects$PartnerDecision - zTT[2]$subjects$Contribution, zTT[2]$subjects$PartnerDecision*3 - zTT[2]$subjects$Contribution)

# set some constants

# Numbers of user of a group
num_users = 6
# Number of rounds each user play to each other
average_rounds = 5
# Number of games for each group 
num_games = 4
# Number of rounds for each game (should be 25)
num_rounds_per_game = (num_users - 1) * average_rounds 
# Number of rounds for each experiment (should be 100, because we have 4 games)
num_rounds_per_exp = num_rounds_per_game * num_games
# Number of experiments (it is 5 at the time of writing, 
# but can be increased if we organize more experiments)
num_exp = nrow (zTT[1]$globals) / num_rounds_per_exp

Type_names = c("SENDER", "RECEIVER")
SIMPLE_GAME_ORDERS =      c(3,2,4,1,2)
ID_GAME_ORDERS =          c(1,4,1,2,3)
SCORE_GAME_ORDERS =       c(2,1,3,4,4)
COMBINE_GAME_ORDERS =     c(4,3,2,3,1)

GAME_NAMES <- c("Simple GAME", "ID GAME", "Score GAME", "Combine GAME")

col_list <- c("red","green","blue","black","orange","violet")

# first, create empty data frames to hold all the particular games
simple_games <- zTT[2]$subjects[0,]
id_games <- zTT[2]$subjects[0,]
score_games <- zTT[2]$subjects[0,]
combine_games <- zTT[2]$subjects[0,]

# create dataframe for each game

for (exp_id in 1:num_exp) {
    first_round_of_exp_globals = (exp_id - 1) * num_rounds_per_exp + 1
    last_round_of_exp_globals = exp_id * num_rounds_per_exp
    globals_of_exp = zTT[1]$globals[first_round_of_exp_globals:last_round_of_exp_globals,]
    
    first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_exp * num_users + 1
    last_round_of_exp_subjects = exp_id * num_rounds_per_exp * num_users
    subjects_of_exp = zTT[2]$subjects[first_round_of_exp_subjects:last_round_of_exp_subjects,]
    
    SIMPLE_GAME_ORDER = globals_of_exp[1,]$SIMPLE_GAME
    ID_GAME_ORDER = globals_of_exp[1,]$ID_GAME
    SCORE_GAME_ORDER = globals_of_exp[1,]$SCORE_GAME
    COMBINE_GAME_ORDER = globals_of_exp[1,]$COMBINE_GAME
    
    simple_games <- rbind(simple_games, subjects_of_exp[((SIMPLE_GAME_ORDER - 1) * 
        num_rounds_per_game * num_users + 1): 
        (SIMPLE_GAME_ORDER * num_rounds_per_game * num_users),])
    id_games <- rbind(id_games, subjects_of_exp[((ID_GAME_ORDER - 1) * 
        num_rounds_per_game * num_users + 1): 
        (ID_GAME_ORDER * num_rounds_per_game * num_users),])
    score_games <- rbind(score_games, subjects_of_exp[((SCORE_GAME_ORDER - 1) * 
        num_rounds_per_game * num_users + 1): 
        (SCORE_GAME_ORDER * num_rounds_per_game * num_users),])
    combine_games <- rbind(combine_games, subjects_of_exp[((COMBINE_GAME_ORDER - 1) * 
        num_rounds_per_game * num_users + 1): 
        (COMBINE_GAME_ORDER * num_rounds_per_game * num_users),])
  }
```

\pagebreak

#Data analysis

## Basic analysis

We can compute some basic metrics as follow:

For this, we can see that, the total behavior for 3 games with information are similar, and much more better than simple game.

```{r}
# calculate game metrics
  #calculate average sending amount per game
  print ("Mean of sending amount per games")
  print (mean (simple_games$Contribution))
  print (mean (id_games$Contribution))
  print (mean (score_games$Contribution))
  print (mean (combine_games$Contribution))
  
  print ("Mean of sending amount by sender  per games")
  print (mean (simple_games[simple_games$Type == 0,]$Contribution))
  print (mean (id_games[id_games$Type == 0,]$Contribution))
  print (mean (score_games[score_games$Type == 0,]$Contribution))
  print (mean (combine_games[combine_games$Type == 0,]$Contribution))
  
  print (mean (simple_games[simple_games$Type == 1,]$Contribution))
  print (mean (id_games[id_games$Type == 1,]$Contribution))
  print (mean (score_games[score_games$Type == 1,]$Contribution))
  print (mean (combine_games[combine_games$Type == 1,]$Contribution))
  
  # calculate average sending proportion per game
#   print ("Mean of sending proportion per game")
#   print (mean (simple_games[simple_games$my_send_proportional >= 0,]$my_send_proportional))
#   print (mean (id_games[id_games$my_send_proportional >= 0,]$my_send_proportional))
#   print (mean (score_games[score_games$my_send_proportional >= 0,]$my_send_proportional))
#   print (mean (combine_games[combine_games$my_send_proportional >= 0,]$my_send_proportional))

  print ("Average of sending amount by senders per game")
  print (mean (simple_games[simple_games$my_send_proportional >= 0 & simple_games$Type == 0,]$my_send_proportional))
  print (mean (id_games[id_games$my_send_proportional >= 0 & id_games$Type == 0,]$my_send_proportional))
  print (mean (score_games[score_games$my_send_proportional >= 0 & score_games$Type == 0,]$my_send_proportional))
  print (mean (combine_games[combine_games$my_send_proportional >= 0 & combine_games$Type == 0,]$my_send_proportional))
   
  print ("Average of sending back by receiver per game")
  print (mean (simple_games[simple_games$my_send_proportional >= 0 & simple_games$Type == 1,]$my_send_proportional))
  print (mean (id_games[id_games$my_send_proportional >= 0 & id_games$Type == 1,]$my_send_proportional))
  print (mean (score_games[score_games$my_send_proportional >= 0 & score_games$Type == 1,]$my_send_proportional))
  print (mean (combine_games[combine_games$my_send_proportional >= 0 & combine_games$Type == 1,]$my_send_proportional))
  
  print ("Average profit user get in 1 round per game")
  print (mean (simple_games[simple_games$Type == 0,]$CurrGameProfit))
  print (mean (id_games[id_games$Type == 0,]$CurrGameProfit))
  print (mean (score_games[score_games$Type == 0,]$CurrGameProfit))
  print (mean (combine_games[combine_games$Type == 0,]$CurrGameProfit))
  
  
  print (mean (simple_games[simple_games$Type == 1,]$CurrGameProfit))
  print (mean (id_games[id_games$Type == 1,]$CurrGameProfit))
  print (mean (score_games[score_games$Type == 1,]$CurrGameProfit))
  print (mean (combine_games[combine_games$Type == 1,]$CurrGameProfit))
  
  print ("Response time for games")
  print (mean(simple_games[simple_games$Type == 0,]$response_time))
  print (mean(simple_games[simple_games$Type == 1,]$response_time))
  
  print (mean(id_games[id_games$Type == 0,]$response_time))
  print (mean(id_games[id_games$Type == 1,]$response_time))
  
  print (mean(score_games[score_games$Type == 0,]$response_time))
  print (mean(score_games[score_games$Type == 1,]$response_time))
  
  print (mean(combine_games[combine_games$Type == 0,]$response_time))
  print (mean(combine_games[combine_games$Type == 1,]$response_time))
```


\pagebreak

## Basic analysis by role

Date: Thu 15-Jun-2017

```{r}
# calculate game metrics
for (type in 0:1) {
  print (paste("Basic game metric of:", Type_names[type+1]))
  #calculate average sending amount per game
  print ("Mean of sending amount per games")
  print (mean (simple_games[simple_games$Type == type,]$Contribution))
  print (mean (id_games[id_games$Type == type,]$Contribution))
  print (mean (score_games[score_games$Type == type,]$Contribution))
  print (mean (combine_games[combine_games$Type == type,]$Contribution))
  
  # calculate average sending proportion per game
  print ("Mean of sending proportion per game")
  print (mean (simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]$my_send_proportional))
  print (mean (id_games[id_games$Type == type & id_games$my_send_proportional >= 0,]$my_send_proportional))
  print (mean (score_games[score_games$Type == type & score_games$my_send_proportional >= 0,]$my_send_proportional))
  print (mean (combine_games[combine_games$Type == type & combine_games$my_send_proportional >= 0,]$my_send_proportional))
  
  # calculate by SHOW_TRUST and SHOW_ID
  print (paste ("Mean of send proportion no TRUST:", mean (c(simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]$my_send_proportional, id_games[id_games$Type == type & id_games$my_send_proportional >= 0,]$my_send_proportional))))
  print (paste ("Mean of send proportion with TRUST:", mean (c(score_games[score_games$Type == type & score_games$my_send_proportional >= 0,]$my_send_proportional, combine_games[combine_games$Type == type & combine_games$my_send_proportional >= 0,]$my_send_proportional))))
  
  print (paste ("Mean of send proportion no ID:", mean (c(simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]$my_send_proportional, score_games[score_games$Type == type & score_games$my_send_proportional >= 0,]$my_send_proportional))))
  print (paste ("Mean of send proportion with ID:", mean (c(id_games[id_games$Type == type & id_games$my_send_proportional >= 0,]$my_send_proportional, combine_games[combine_games$Type == type & combine_games$my_send_proportional >= 0,]$my_send_proportional))))
  
  print ("Average profit user get in 1 round per game")
  print (mean (simple_games[simple_games$Type == type,]$CurrGameProfit))
  print (mean (id_games[id_games$Type == type,]$CurrGameProfit))
  print (mean (score_games[score_games$Type == type,]$CurrGameProfit))
  print (mean (combine_games[combine_games$Type == type,]$CurrGameProfit))
}
  
```

Of course, these above metrics are very basic one. We need to calculate the group interaction on SHOW_TRUST and SHOW_ID variables (both of them are boolean values, mean in a particular game, we show trust score or identity to users or not). In order to do this, we will use 2 - way and 3 - way ANOVA in wide format. More details at http://www.uni-kiel.de/psychologie/rexrepos/posts/anovaSPFpqr.html

\pagebreak

### Testing the difference of users' behavior on different partners

```{r, echo=FALSE}
  # for non-parametric k-sample Anderson-Darling test
  games = id_games
  library("kSamples")
  ad_tests = c()
  
  all_send_proportions_by_user = list()
  user_count = 1
  
  for (date in unique(games$Date)) {
    for (user_id in 1:6) {
      user_send = data.frame (
        partner_id = as.numeric(),
        send_proportion = as.numeric()
      )
      
      # sum of send proportion of the current user on different partner
      # create array of 6 but in fact use only 5 cells
      send_proportions = list()
      for (partner_id in 1:6) {
        if (partner_id == user_id) {
          next()
        }
        # get the first time sending as sender only
        send_proportions[[partner_id]] = games[games$Date == date & games$Subject == user_id & games$Partner == partner_id & games$my_send_proportional >= 0,]$my_send_proportional
      }
      counter = 1
      for (i in 1:6) {
        if (i != user_id) {
          assign(paste("xk_",counter,sep = ""), send_proportions[[i]])
          counter = counter + 1
        }
      }
      ad_test = ad.test(xk_1, xk_2, xk_3, xk_4, xk_5)
      # print (ad_test$ad)
      ad_tests = c(ad_tests, ad_test$ad[2,3])
      # print (send_proportions)
      all_send_proportions_by_user[[user_count]] = c(mean(xk_1),mean(xk_2),mean(xk_3),mean(xk_4),mean(xk_5))
      user_count = user_count + 1
    }
  }
  print (mean (ad_tests))
  
  # plot average sending by user on different partners
  plot (x=0,y=0,xlim = c(1,30),ylim=c(0,100),type="n", ylab="Sending percentage",xlab = "User", cex.lab=1.5, cex.axis=1.5)
  for (i in 1:30) {
    # print (i)
    cur_list = all_send_proportions_by_user[[i]]
    for (j in 1:5) {
      points(x=i,y= cur_list[j]*100,col=c("red","black")[i%%2+1])
    }
  }
  
  #plot in a different view
  
  plot (x=0,y=0,xlim = c(0,100),ylim=c(1,30),type="n", xlab="Sending percentage",ylab = "User", cex.lab=1.5, cex.axis=1.5)
  for (i in 1:30) {
    # print (i)
    cur_list = all_send_proportions_by_user[[i]]
    for (j in 1:5) {
      points(y=i,x= cur_list[j]*100,col=c("red","black")[i%%2+1])
    }
  }
```

\pagebreak

### Game metrics for each person of each group

We calculate behavior for each group and see the effect of showing trust or showing ID. We can see that it is really better to show the information to users.

Temporary remove, move to effect of each group.

```{r, echo = FALSE}
#   for (exp_id in 1:num_exp) {
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       print (paste ("Abs sending of group ", exp_id))
#       print (mean (simple_game$Contribution))
#       print (mean (id_game$Contribution))
#       print (mean (score_game$Contribution))
#       print (mean (combine_game$Contribution))
#       
#       print ("Without and with trust")
#       print ((mean(simple_game$Contribution) + mean (id_game$Contribution))/ 2)
#       print ((mean(score_game$Contribution) + mean (combine_game$Contribution))/ 2)
#       
#       print ("With and without ID")
#       print ((mean(simple_game$Contribution) + mean (score_game$Contribution))/ 2)
#       print ((mean(id_game$Contribution) + mean (combine_game$Contribution))/ 2)
#       
#       print (paste ("Rel sending of group ", exp_id))
#       print (mean (simple_game[simple_game$my_send_proportional >= 0,]$my_send_proportional))
#       print (mean (id_game[id_game$my_send_proportional >= 0,]$my_send_proportional))
#       print (mean (score_game[score_game$my_send_proportional >= 0,]$my_send_proportional))
#       print (mean (combine_game[combine_game$my_send_proportional >= 0,]$my_send_proportional))
#       
#       print ("Without and with trust")
#       print ((mean(simple_game[simple_game$my_send_proportional >= 0,]$my_send_proportional) + mean (id_game[id_game$my_send_proportional >= 0,]$my_send_proportional))/ 2)
#       print ((mean(score_game[score_game$my_send_proportional >= 0,]$my_send_proportional) + mean (combine_game[combine_game$my_send_proportional >= 0,]$my_send_proportional))/ 2)
#       
#       print ("Without and With ID")
#       print ((mean(simple_game[simple_game$my_send_proportional >= 0,]$my_send_proportional) + mean (score_game[score_game$my_send_proportional >= 0,]$my_send_proportional))/ 2)
#       print ((mean(id_game[id_game$my_send_proportional >= 0,]$my_send_proportional) + mean (combine_game[combine_game$my_send_proportional >= 0,]$my_send_proportional))/ 2)
#       
#       print (paste ("Profit of group ", exp_id))
#       print (mean (simple_game$CurrGameProfit))
#       print (mean (id_game$CurrGameProfit))
#       print (mean (score_game$CurrGameProfit))
#       print (mean (combine_game$CurrGameProfit))
#       
#       print ("Without and with trust")
#       print ((mean(simple_game$CurrGameProfit) + mean (id_game$CurrGameProfit))/ 2)
#       print ((mean(score_game$CurrGameProfit) + mean (combine_game$CurrGameProfit))/ 2)
#       
#       print ("Without and With ID")
#       print ((mean(simple_game$CurrGameProfit) + mean (score_game$CurrGameProfit))/ 2)
#       print ((mean(id_game$CurrGameProfit) + mean (combine_game$CurrGameProfit))/ 2)
#   }
```

\pagebreak

```{r}
  require(ggplot2)
  require(reshape2)
  require(scales)
  c <- cbind(simple_games[simple_games$Type == 0 & simple_games$my_send_proportional >= 0,]$Contribution, id_games[id_games$Type == 0 & id_games$my_send_proportional >= 0,]$Contribution, score_games[score_games$Type == 0 & score_games$my_send_proportional >= 0,]$Contribution, combine_games[combine_games$Type == 0 & combine_games$my_send_proportional >= 0,]$Contribution)
  c=c/10
  d <- as.data.frame(c)
  colnames(d) <- c("Simple Game", "Partner Identity Game", "Partner Information Game", "Combine Game")
  # make histogram of sending amount by senders
  ggplot(melt(d), aes (value, fill = variable))+ geom_histogram(position = "dodge", binwidth = 0.1, aes(y=..count../sum(..count..) * 4)) + scale_x_continuous(breaks = seq(0,1,0.2),labels=percent) + xlab ("Sending percentage") + scale_y_continuous(labels=percent) + ylab ("Frequencies") + scale_fill_grey() + theme(text = element_text(size=30))
  
  # For receivers
  c <- cbind(simple_games[simple_games$Type == 1 & simple_games$my_send_proportional >= 0,]$my_send_proportional, id_games[id_games$Type == 1 & id_games$my_send_proportional >= 0,]$my_send_proportional, score_games[score_games$Type == 1 & score_games$my_send_proportional >= 0,]$my_send_proportional, combine_games[combine_games$Type == 1 & combine_games$my_send_proportional >= 0,]$my_send_proportional)
  d <- as.data.frame(c)
  colnames(d) <- c("Simple Game", "Partner Identity Game", "Partner Information Game", "Combine Game")
  # make histogram of sending amount by senders
  ggplot(melt(d), aes (value, fill = variable))+ geom_histogram(position = "dodge", binwidth = 0.1, aes(y=..count../sum(..count..) * 4)) + scale_x_continuous(breaks = seq(0,1,0.2),labels=percent) + xlab ("Sending percentage") + scale_y_continuous(labels=percent) + scale_fill_grey() + theme(text = element_text(size=30)) + ylab("")
  
  for (type in 0:1) {
    sg_senders <- simple_games[simple_games$Type == type & simple_games$my_send_proportional>= 0,]
    sg_senders_avg <- aggregate(sg_senders$my_send_proportional, list(sg_senders$Date, sg_senders$Subject), mean)
    
    pdg_senders <- id_games[id_games$Type == type & id_games$my_send_proportional>= 0,]
    pdg_senders_avg <- aggregate(pdg_senders$my_send_proportional, list(pdg_senders$Date, pdg_senders$Subject), mean)
    
    pfg_senders <- score_games[score_games$Type == type & score_games$my_send_proportional>= 0,]
    pfg_senders_avg <- aggregate(pfg_senders$my_send_proportional, list(pfg_senders$Date, pfg_senders$Subject), mean)
    
    cg_senders <- combine_games[combine_games$Type == type & combine_games$my_send_proportional>= 0,]
    cg_senders_avg <- aggregate(cg_senders$my_send_proportional, list(cg_senders$Date, cg_senders$Subject), mean)
    
    perml_ks (sg_senders_avg[['x']], pdg_senders_avg[['x']])
    perml_ks (sg_senders_avg[['x']], pfg_senders_avg[['x']])
    perml_ks (sg_senders_avg[['x']], cg_senders_avg[['x']])
    
    perml_ks (pdg_senders_avg[['x']], pfg_senders_avg[['x']])
    perml_ks (pdg_senders_avg[['x']], cg_senders_avg[['x']])
    
    perml_ks (pfg_senders_avg[['x']], cg_senders_avg[['x']])
    
    c2 <- cbind(sg_senders_avg[['x']], pdg_senders_avg[['x']], pfg_senders_avg[['x']], cg_senders_avg[['x']])
    d2 <- as.data.frame(c2)
    colnames(d2) <- c("Simple Game", "Partner Identity Game", "Partner Information Game", "Combine Game")
    
    r2 <- rbind(sg_senders_avg[['x']], pdg_senders_avg[['x']], pfg_senders_avg[['x']], cg_senders_avg[['x']])
    barplot(r2, beside = TRUE)  
  }
  
#   plot (id, sg_senders_avg[['x']], ylim = c(0,1), col="red", main = "Sending percentage of senders", xlab = "Participant", ylab = "Sending percentage", yaxt="n")
#   axis(2, at=pretty(sg_senders_avg[['x']]), lab= paste (pretty(sg_senders_avg[['x']]) * 100, "%"), las=TRUE)
#   lines (id, sg_senders_avg[['x']], lty = 2, col="red")
#   
#   lines (id, pdg_senders_avg[['x']], lty = 2, col="blue", type = "o")
#   
#   lines (id, pfg_senders_avg[['x']], lty = 2, col="green", type = "o")
#   
#   lines (id, cg_senders_avg[['x']], lty = 2, col="purple", type = "o")
```

\pagebreak

## Compare behavior between games

```{r, echo=FALSE}
  require(car)
compare_send = function (type = 0, comparing_value = "RelSend") {
    # AbsSend: absolute sending
    # RelSend: send proportion of maximum
    # Profit: profit get at this round
    # game_pos:  order of game to play in this experiment
    df <- data.frame("id" = as.numeric(), 
                     "GroupID"= as.numeric(),
                     "SHOW_TRUST"=as.numeric(),
                     "SHOW_ID"=as.numeric(),
                     "AbsSend" = as.numeric(),  
                     "RelSend" = as.numeric(),  
                     "Profit" = as.numeric(),
                     "game_pos" = as.numeric(),
                     "response_time" = as.numeric())
    for (j in 1:num_users) {
      for (exp_id in 1:num_exp) {
        for (k in 1:num_games) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          user_id = j + num_users * (exp_id - 1)
          
          if (k == 1) {
            new_row = c(as.numeric (user_id),
                        as.numeric (exp_id),
                        0,
                        0,
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$Contribution),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type & simple_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$CurrGameProfit),
                        SIMPLE_GAME_ORDERS[exp_id],
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 2) {
            new_row = c(user_id,
                        exp_id,
                        0,
                        1,
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$Contribution),
                        mean (id_game[id_game$Subject == j & id_game$Type == type & id_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$CurrGameProfit),
                        ID_GAME_ORDERS[exp_id],
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 3) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        0,
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$Contribution),
                        mean (score_game[score_game$Subject == j & score_game$Type == type & score_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$CurrGameProfit),
                        SCORE_GAME_ORDERS[exp_id],
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 4) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        1,
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$Contribution),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type & combine_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$CurrGameProfit),
                        COMBINE_GAME_ORDERS[exp_id],
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
        }
      }
    }
    
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_pos <- as.factor(df$game_pos)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    if (comparing_value == "RelSend") {
      print (paste("Compare rel sending for ", Type_names[type + 1]))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 0,]$RelSend, df[df$SHOW_TRUST == 0&df$SHOW_ID == 1,]$RelSend, paired =  TRUE))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 0,]$RelSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 0,]$RelSend, paired =  TRUE))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 0,]$RelSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 1,]$RelSend, paired =  TRUE))
    print ("---")
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 1,]$RelSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 0,]$RelSend, paired =  TRUE))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 1,]$RelSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 1,]$RelSend, paired =  TRUE))
    print ("---")
    print (t.test(df[df$SHOW_TRUST == 1&df$SHOW_ID == 0,]$RelSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 1,]$RelSend, paired =  TRUE))
    }
    else if (comparing_value == "AbsSend") {
      print (paste("Compare abs sending for ", Type_names[type + 1]))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 0,]$AbsSend, df[df$SHOW_TRUST == 0&df$SHOW_ID == 1,]$AbsSend, paired =  TRUE))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 0,]$AbsSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 0,]$AbsSend, paired =  TRUE))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 0,]$AbsSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 1,]$AbsSend, paired =  TRUE))
    print ("---")
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 1,]$AbsSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 0,]$AbsSend, paired =  TRUE))
    print (t.test(df[df$SHOW_TRUST == 0&df$SHOW_ID == 1,]$AbsSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 1,]$AbsSend, paired =  TRUE))
    print ("---")
    print (t.test(df[df$SHOW_TRUST == 1&df$SHOW_ID == 0,]$AbsSend, df[df$SHOW_TRUST == 1&df$SHOW_ID == 1,]$AbsSend, paired =  TRUE))
    }
}

print ("Compare send proportion of SENDER")
compare_send (type = 0)
print ("Compare send proportion of RECEIVER")
compare_send (type = 1)
```


\pagebreak

## Compare between games using ANOVA

Before, we compared average of sending amount and average of sending proportion between games using pairwise t-test on all possible pair games.

However, we can use ANOVA to test all four games in once. More information at [http://brownmath.com/stat/anova1](http://brownmath.com/stat/anova1).

The code is taken from [http://www.sthda.com/english/wiki/one-way-anova-test-in-r](http://www.sthda.com/english/wiki/one-way-anova-test-in-r)

```{r}
# For sender
send_simple = simple_games[simple_games$Type==0,]$my_send_proportional
send_id = id_games[id_games$Type==0,]$my_send_proportional
send_score = score_games[score_games$Type==0,]$my_send_proportional
send_combine = combine_games[combine_games$Type==0,]$my_send_proportional
dati = c(send_simple, send_id, send_score, send_combine)
groups = factor(rep(c("simple","id","score","combine"), each = length(send_simple)))

# test variance homogenity
bartlett.test(dati, groups)
fligner.test(dati, groups)

# ANOVA
# ANOVA answers if four means are equal or not
fit = lm(formula = dati ~ groups)

anova(fit)

# TukeyHSD test, to answer which mean is greater than which mean
TukeyHSD(aov(fit))

# Using multcomp package, little bit stronger than TukeyHSD test
library(multcomp)
pairwise <- glht(fit, linfct = mcp(groups = "Tukey"))
summary (pairwise)

# Kruskal - Wallis test for non-parametric
kruskal.test(dati ~ groups)

# if K-W test is significant, a post-hoc test can be performed
# here we use Dunn test
# http://rcompanion.org/rcompanion/d_06.html
library (FSA)
PT = dunnTest(dati ~ groups)
PT

# using Nemenyi test
# not suitable for groups with different length (Zar, J.H. 2010. Biostatistical Analysis, 5th ed.  Pearson Prentice Hall: Upper Saddle River, NJ.)
library(DescTools)
nt = NemenyiTest(x= dati, g=groups, dist = "tukey")
nt
```

```{r}
# For sender: net sending amount
send_simple = simple_games[simple_games$Type==0,]$Contribution
send_id = id_games[id_games$Type==0,]$Contribution
send_score = score_games[score_games$Type==0,]$Contribution
send_combine = combine_games[combine_games$Type==0,]$Contribution
dati = c(send_simple, send_id, send_score, send_combine)
groups = factor(rep(c("simple","id","score","combine"), each = length(send_simple)))

# test variance homogenity
bartlett.test(dati, groups)
fligner.test(dati, groups)

# ANOVA
# ANOVA answers if four means are equal or not
fit = lm(formula = dati ~ groups)

anova(fit)

# TukeyHSD test, to answer which mean is greater than which mean
TukeyHSD(aov(fit))
```

```{r}
# For receiver
receive_simple = simple_games[simple_games$Type==1 & simple_games$my_send_proportional >=0,]$my_send_proportional
receive_id = id_games[id_games$Type==1 & id_games$my_send_proportional >=0,]$my_send_proportional
receive_score = score_games[score_games$Type==1 & score_games$my_send_proportional >= 0,]$my_send_proportional
receive_combine = combine_games[combine_games$Type==1 & combine_games$my_send_proportional >= 0,]$my_send_proportional
dati = c(receive_simple, receive_id, receive_score, receive_combine)
groups = factor (c(rep("simple", length(receive_simple)),
                   rep("id", length(receive_id)),
                   rep("score", length(receive_score)),
                   rep("combine", length(receive_combine))
                   ))

# test variance homogenity
bartlett.test(dati, groups)
fligner.test(dati, groups)

# ANOVA
# ANOVA answers if four means are equal or not
fit = lm(formula = dati ~ groups)

anova(fit)

# TukeyHSD test, to answer which mean is greater than which mean
TukeyHSD(aov(fit))

# Using multcomp package, little bit stronger than TukeyHSD test
library(multcomp)
pairwise <- glht(fit, linfct = mcp(groups = "Tukey"))
summary (pairwise)

# Kruskal - Wallis test for non-parametric
kruskal.test(dati ~ groups)

# if K-W test is significant, a post-hoc test can be performed
# here we use Dunn test
# http://rcompanion.org/rcompanion/d_06.html
library (FSA)
PT = dunnTest(dati ~ groups)
PT
```

```{r}
# For receiver for net amount
receive_simple = simple_games[simple_games$Type==1 & simple_games$my_send_proportional >=0,]$Contribution
receive_id = id_games[id_games$Type==1 & id_games$my_send_proportional >=0,]$Contribution
receive_score = score_games[score_games$Type==1 & score_games$my_send_proportional >= 0,]$Contribution
receive_combine = combine_games[combine_games$Type==1 & combine_games$my_send_proportional >= 0,]$Contribution
dati = c(receive_simple, receive_id, receive_score, receive_combine)
groups = factor (c(rep("simple", length(receive_simple)),
                   rep("id", length(receive_id)),
                   rep("score", length(receive_score)),
                   rep("combine", length(receive_combine))
                   ))

# test variance homogenity
bartlett.test(dati, groups)
fligner.test(dati, groups)

# ANOVA
# ANOVA answers if four means are equal or not
fit = lm(formula = dati ~ groups)

anova(fit)

# TukeyHSD test, to answer which mean is greater than which mean
TukeyHSD(aov(fit))
```

==> all the tests confirmed that Simple_Game < ID-game ~ score-game ~ combine-game

\pagebreak

## Group effect on game position

```{r, echo=FALSE}
  require(car)
  for (type in 0:1) {
    # AbsSend: absolute sending
    # RelSend: send proportion of maximum
    # Profit: profit get at this round
    # game_pos:  order of game to play in this experiment
    df <- data.frame("id" = as.numeric(), 
                     "GroupID"= as.numeric(),
                     "SHOW_TRUST"=as.numeric(),
                     "SHOW_ID"=as.numeric(),
                     "AbsSend" = as.numeric(),  
                     "RelSend" = as.numeric(),  
                     "Profit" = as.numeric(),
                     "game_pos" = as.numeric(),
                     "response_time" = as.numeric())
    for (j in 1:num_users) {
      for (exp_id in 1:num_exp) {
        for (k in 1:num_games) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          user_id = j + num_users * (exp_id - 1)
          
          if (k == 1) {
            new_row = c(as.numeric (user_id),
                        as.numeric (exp_id),
                        0,
                        0,
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$Contribution),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type & simple_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$CurrGameProfit),
                        SIMPLE_GAME_ORDERS[exp_id],
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 2) {
            new_row = c(user_id,
                        exp_id,
                        0,
                        1,
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$Contribution),
                        mean (id_game[id_game$Subject == j & id_game$Type == type & id_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$CurrGameProfit),
                        ID_GAME_ORDERS[exp_id],
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 3) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        0,
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$Contribution),
                        mean (score_game[score_game$Subject == j & score_game$Type == type & score_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$CurrGameProfit),
                        SCORE_GAME_ORDERS[exp_id],
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 4) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        1,
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$Contribution),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type & combine_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$CurrGameProfit),
                        COMBINE_GAME_ORDERS[exp_id],
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
        }
      }
    }
    
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_pos <- as.factor(df$game_pos)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
#     print ("ANOVA analysis with absolute sending on GroupID:game_pos")
#     df$score <- df$AbsSend
#     anova_analysis (df, type, num_way = 2)
#     print ("ANOVA analysis with scale absolute sending on GroupID:game_pos (Z_score)")
#     df$score <- make_scale(df$AbsSend, num_grp = num_exp)
#     anova_analysis (df, type, num_way = 2)
    print ("ANOVA analysis with relative sending on GroupID:game_pos")
    df$score <- df$RelSend
    anova_analysis (df, type, num_way = 2)
#     print ("ANOVA analysis with scale relative sending on GroupID:game_pos (Z_score)")
#     df$score <- make_scale(df$RelSend, num_grp = num_exp)
#     anova_analysis (df, type, num_way = 2)
    print ("ANOVA analysis with absolute profit on GroupID:game_pos")
    df$score <- df$Profit
    anova_analysis (df, type, num_way = 2)
#     print ("ANOVA analysis with scale absolute profit on GroupID:game_pos (Z_score)")
#     df$score <- make_scale(df$Profit, num_grp = num_exp)
#     anova_analysis (df, type, num_way = 2)
    print ("ANOVA analysis with absolute response time on GroupID:game_pos")
    df$score <- df$response_time
    anova_analysis (df, type, num_way = 2)
  }
```

\pagebreak

## Test the effect of groups

In the following code chunk, we will use 'Anova' function, which is the part of 'car' package.

We want to test the effect of TRUST and ID to behavior, and see is there group interaction in the data or not. 

We can see that for relative sending, there is no group effect.

```{r, echo=FALSE}
# define a function to analyze ANOVA with the fact that id is random effect (subjects are pooled from a distribution --> we care about general subjects rather than recruited ones)
# date: Wed 14-Jun-2017
require(car)
anova_random_subject <- function(input_df)
{
  a1 <- summary (aov (score ~ GroupID * SHOW_TRUST * SHOW_ID + Error (id/(SHOW_TRUST*SHOW_ID)), data = input_df))
  
  # for more details, print a1 so you can check what is each column
  # col 1,2,3,4,5: degree of freedom (Df), sum sq, mean sq, F-value, p-value
  # recalculate F-score and p-value for SHOW_TRUST
  a1$`Error: id:SHOW_TRUST`[[1]][1,][4] <- a1$`Error: id:SHOW_TRUST`[[1]][1,][3] / (a1$`Error: id:SHOW_TRUST`[[1]][2,][2] / a1$`Error: id:SHOW_TRUST`[[1]][2,][1])  # F-score
  a1$`Error: id:SHOW_TRUST`[[1]][1,][5] <- 1 - pf (q = as.numeric(a1$`Error: id:SHOW_TRUST`[[1]][1,][4]), df1 = as.numeric(a1$`Error: id:SHOW_TRUST`[[1]][1,][1]), df2 = as.numeric(a1$`Error: id:SHOW_TRUST`[[1]][2,][1]))  #p-value
  
  #similar for SHOW_ID
  a1$`Error: id:SHOW_ID`[[1]][1,][4] <- a1$`Error: id:SHOW_ID`[[1]][1,][3] / (a1$`Error: id:SHOW_ID`[[1]][2,][2] / a1$`Error: id:SHOW_ID`[[1]][2,][1])  # F-score
  a1$`Error: id:SHOW_ID`[[1]][1,][5] <- 1 - pf (q = as.numeric(a1$`Error: id:SHOW_ID`[[1]][1,][4]), df1 = as.numeric(a1$`Error: id:SHOW_ID`[[1]][1,][1]), df2 = as.numeric(a1$`Error: id:SHOW_ID`[[1]][2,][1]))  #p-value
  
  #similar for SHOW_TRUST:SHOW_ID
  a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][1,][4] <- a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][1,][3] / (a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][2,][2] / a1$`Error: id:SHOW_ID`[[1]][2,][1])  # F-score
  a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][1,][5] <- 1 - pf (q = as.numeric(a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][1,][4]), df1 = as.numeric(a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][1,][1]), df2 = as.numeric(a1$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][2,][1]))
  
  print (a1)
}
  
    
    for (type in 0:1) {
      # AbsSend: absolute sending
      # RelSend: send proportion of maximum
      # Profit: profit get at this round
      # game_pos:  order of game to play in this experiment
      df <- data.frame("id" = as.numeric(), 
                       "GroupID"= as.numeric(),
                     "SHOW_TRUST"=as.numeric(),
                     "SHOW_ID"=as.numeric(),
                     "AbsSend" = as.numeric(),  
                     "RelSend" = as.numeric(),  
                     "Profit" = as.numeric(),
                     "game_pos" = as.numeric(),
                     "response_time" = as.numeric())
    for (j in 1:num_users) {
      for (exp_id in 1:num_exp) {
        for (k in 1:num_games) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          user_id = j + num_users * (exp_id - 1)
          
          if (k == 1) {
            new_row = c(as.numeric (user_id),
                        as.numeric (exp_id),
                        0,
                        0,
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$Contribution),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type & simple_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$CurrGameProfit),
                        SIMPLE_GAME_ORDERS[exp_id],
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 2) {
            new_row = c(user_id,
                        exp_id,
                        0,
                        1,
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$Contribution),
                        mean (id_game[id_game$Subject == j & id_game$Type == type & id_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$CurrGameProfit),
                        ID_GAME_ORDERS[exp_id],
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 3) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        0,
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$Contribution),
                        mean (score_game[score_game$Subject == j & score_game$Type == type & score_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$CurrGameProfit),
                        SCORE_GAME_ORDERS[exp_id],
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 4) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        1,
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$Contribution),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type & combine_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$CurrGameProfit),
                        COMBINE_GAME_ORDERS[exp_id],
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
        }
      }
    }
    
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_pos <- as.factor(df$game_pos)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    # df$game_setting <- NULl
#     print ("ANOVA analysis with absolute sending on GroupID:SHOW_TRUST:SHOW_ID")
#     df$score <- df$AbsSend
#     anova_analysis (df, type, num_way = 3)
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
#     print ("ANOVA analysis with scale absolute sending on GroupID:SHOW_TRUST:SHOW_ID (Z_score)")
#     df$score <- make_scale(df$AbsSend, num_grp = num_exp)
#     anova_analysis (df, type, num_way = 3)
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
    print ("ANOVA analysis with send proportion on GroupID:SHOW_TRUST:SHOW_ID")
    print (paste("Type:", Type_names[type+1]))
    df$score <- df$RelSend
    print ("With GroupID")
    anova_random_subject(df)
    
    print ("---------------------------------------------")
    print ("---------------------------------------------")
    
    # print ("Without GroupID")
    # anova_analysis(df, type, num_way = 4)
    # 
    # print ("---------------------------------------------")
    # print ("---------------------------------------------")
    
    
    # date: Wed 7-Jun-2017
    # print ("ANOVA analysis on arcsin transformation of send proportion")
    # print ("Without GroupID")
    # 
    # df$score <- asin(df$RelSend)
    # anova_analysis(df, type, num_way = 4)
    # 
    # print ("With GroupID")
    # 
    # df$score <- asin(df$RelSend)
    # anova_analysis(df, type, num_way = 3)
    
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
#     print ("ANOVA analysis with scale relative sending on GroupID:SHOW_TRUST:SHOW_ID (Z_score)")
#     df$score <- make_scale(df$RelSend, num_grp = num_exp)
#     anova_analysis (df, type, num_way = 3)
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
    # print ("ANOVA analysis with absolute profit on GroupID:SHOW_TRUST:SHOW_ID")
    # df$score <- df$Profit
    # print ("With GroupID")
    # anova_analysis (df, type, num_way = 3)
    # 
    # print ("---------------------------------------------")
    # print ("---------------------------------------------")
    # 
    # print ("Without GroupID")
    # anova_analysis(df, type, num_way = 4)
    # 
    # print ("---------------------------------------------")
    # print ("---------------------------------------------")
    # 
    # print ("ANOVA analysis with absolute sending amount on GroupID:SHOW_TRUST:SHOW_ID")
    # df$score <- df$AbsSend
    # print ("With GroupID")
    # anova_analysis (df, type, num_way = 3)
    # 
    # print ("---------------------------------------------")
    # print ("---------------------------------------------")
    # 
    # print ("Without GroupID")
    # anova_analysis(df, type, num_way = 4)
    # 
    # print ("---------------------------------------------")
    # print ("---------------------------------------------")
    
    
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
#     print ("ANOVA analysis with scale absolute profit on GroupID:SHOW_TRUST:SHOW_ID (Z_score)")
#     df$score <- make_scale(df$Profit, num_grp = num_exp)
#     anova_analysis (df, type, num_way = 3)
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
    # print ("ANOVA analysis with absolute response time on GroupID:SHOW_TRUST:SHOW_ID")
    # df$score <- df$response_time
    # anova_analysis (df, type, num_way = 3)
#     print ("---")
#     anova_analysis(df, type = type, num_way = 2)
}
```

Summary by information showed to users

```{r, echo=FALSE}
  df1 <- data.frame("RelSender" = as.numeric(),
                    "RelReceiver" = as.numeric(),
                    "ProfitSender" = as.numeric(),
                    "ProfitReceiver" = as.numeric()
                    )
  new_row <- c((mean(simple_games[simple_games$Type == 0 & simple_games$my_send_proportional >= 0,]$my_send_proportional) + mean(id_games[id_games$Type == 0 & id_games$my_send_proportional >= 0,]$my_send_proportional))/2,
                (mean(simple_games[simple_games$Type == 1 & simple_games$my_send_proportional >= 0,]$my_send_proportional) + mean(id_games[id_games$Type == 1 & id_games$my_send_proportional >= 0,]$my_send_proportional))/2,
               (mean(simple_games[simple_games$Type == 0,]$CurrGameProfit) + mean(id_games[id_games$Type == 0,]$CurrGameProfit))/2,
               (mean(simple_games[simple_games$Type == 1,]$CurrGameProfit) + mean(id_games[id_games$Type == 1,]$CurrGameProfit))/2)
  df1[(nrow(df1) + 1),] <- new_row
  
  new_row <- c((mean(score_games[score_games$Type == 0 & score_games$my_send_proportional >= 0,]$my_send_proportional) + mean(combine_games[combine_games$Type == 0 & combine_games$my_send_proportional >= 0,]$my_send_proportional))/2,
                (mean(score_games[score_games$Type == 1 & score_games$my_send_proportional >= 0,]$my_send_proportional) + mean(combine_games[combine_games$Type == 1 & combine_games$my_send_proportional >= 0,]$my_send_proportional))/2,
               (mean(score_games[score_games$Type == 0,]$CurrGameProfit) + mean(combine_games[combine_games$Type == 0,]$CurrGameProfit))/2,
               (mean(score_games[score_games$Type == 1,]$CurrGameProfit) + mean(combine_games[combine_games$Type == 1,]$CurrGameProfit))/2)
  df1[(nrow(df1) + 1),] <- new_row
  
  new_row <- c((mean(simple_games[simple_games$Type == 0 & simple_games$my_send_proportional >= 0,]$my_send_proportional) + mean(score_games[score_games$Type == 0 & score_games$my_send_proportional >= 0,]$my_send_proportional))/2,
                (mean(simple_games[simple_games$Type == 1 & simple_games$my_send_proportional >= 0,]$my_send_proportional) + mean(score_games[score_games$Type == 1 & score_games$my_send_proportional >= 0,]$my_send_proportional))/2,
               (mean(simple_games[simple_games$Type == 0,]$CurrGameProfit) + mean(score_games[score_games$Type == 0,]$CurrGameProfit))/2,
               (mean(simple_games[simple_games$Type == 1,]$CurrGameProfit) + mean(score_games[score_games$Type == 1,]$CurrGameProfit))/2)
  df1[(nrow(df1) + 1),] <- new_row
  
  new_row <- c((mean(id_games[id_games$Type == 0 & id_games$my_send_proportional >= 0,]$my_send_proportional) + mean(combine_games[combine_games$Type == 0 & combine_games$my_send_proportional >= 0,]$my_send_proportional))/2,
                (mean(id_games[id_games$Type == 1 & id_games$my_send_proportional >= 0,]$my_send_proportional) + mean(combine_games[combine_games$Type == 1 & combine_games$my_send_proportional >= 0,]$my_send_proportional))/2,
               (mean(id_games[id_games$Type == 0,]$CurrGameProfit) + mean(combine_games[combine_games$Type == 0,]$CurrGameProfit))/2,
               (mean(id_games[id_games$Type == 1,]$CurrGameProfit) + mean(combine_games[combine_games$Type == 1,]$CurrGameProfit))/2)
  df1[(nrow(df1) + 1),] <- new_row
  
  df1 <- cbind(Row.names = c("Without Trust", "With Trust", "Without ID", "With ID"), df1)
  
  print (df1)
```



\pagebreak
## Group effect on game_setting

Date:Sat 10-Jun-2017
Here, we create a new variable called game_setting which runs from 1 to 4 correspond to 4 games.

```{r, echo = FALSE}
  require(car)
  for (type in 0:1) {
    # AbsSend: absolute sending
    # RelSend: send proportion of maximum
    # Profit: profit get at this round
    # game_pos:  order of game to play in this experiment
    df <- data.frame("id" = as.numeric(),
                     "GroupID"= as.numeric(),
                     "SHOW_TRUST"=as.numeric(),
                     "SHOW_ID"=as.numeric(),
                     "AbsSend" = as.numeric(),
                     "RelSend" = as.numeric(),
                     "Profit" = as.numeric(),
                     "game_pos" = as.numeric(),
                     "response_time" = as.numeric())
    for (j in 1:num_users) {
      for (exp_id in 1:num_exp) {
        # if (exp_id == 3) {next()}
        for (k in 1:num_games) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]

          user_id = j + num_users * (exp_id - 1)

          if (k == 1) {
            
              new_row = c(as.numeric (user_id),
                          as.numeric (exp_id),
                          0,
                          0,
                          sum (simple_game[simple_game$Subject == j & simple_game$Type == type,]$Contribution),
                          mean (simple_game[simple_game$Subject == j & simple_game$Type == type & simple_game$my_send_proportional >= 0,]$my_send_proportional),
                          sum (simple_game[simple_game$Subject == j & simple_game$Type == type,]$CurrGameProfit),
                          SIMPLE_GAME_ORDERS[exp_id],
                          mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$response_time)
              )
              df[nrow(df)+1,] <- new_row
            
          }
          if (k == 2) {
            
              new_row = c(user_id,
                          exp_id,
                          0,
                          1,
                          sum (id_game[id_game$Subject == j & id_game$Type == type,]$Contribution),
                          mean (id_game[id_game$Subject == j & id_game$Type == type & id_game$my_send_proportional >= 0,]$my_send_proportional),
                          sum (id_game[id_game$Subject == j & id_game$Type == type,]$CurrGameProfit),
                          ID_GAME_ORDERS[exp_id],
                          mean (id_game[id_game$Subject == j & id_game$Type == type,]$response_time)
              )
              df[nrow(df)+1,] <- new_row
            
          }
          if (k == 3) {
            
              new_row = c(user_id,
                          exp_id,
                          1,
                          0,
                          sum (score_game[score_game$Subject == j & score_game$Type == type,]$Contribution),
                          mean (score_game[score_game$Subject == j & score_game$Type == type & score_game$my_send_proportional >= 0,]$my_send_proportional),
                          sum (score_game[score_game$Subject == j & score_game$Type == type,]$CurrGameProfit),
                          SCORE_GAME_ORDERS[exp_id],
                          mean (score_game[score_game$Subject == j & score_game$Type == type,]$response_time)
              )
              df[nrow(df)+1,] <- new_row
            
          }
          if (k == 4) {
            
              new_row = c(user_id,
                          exp_id,
                          1,
                          1,
                          sum (combine_game[combine_game$Subject == j & combine_game$Type == type,]$Contribution),
                          mean (combine_game[combine_game$Subject == j & combine_game$Type == type & combine_game$my_send_proportional >= 0,]$my_send_proportional),
                          sum (combine_game[combine_game$Subject == j & combine_game$Type == type,]$CurrGameProfit),
                          COMBINE_GAME_ORDERS[exp_id],
                          mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$response_time)
              )
              df[nrow(df)+1,] <- new_row
            
          }
        }
      }
    }

    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_pos <- as.factor(df$game_pos)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))

    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    df$game_setting <- NULL
    print ("ANOVA analysis with sending proportion on GroupID:game_setting.")
    print (paste("Type: ", Type_names[type+1]))
    df$score <- df$RelSend
    anova_analysis(df, type = type, num_way = 2)
}
```

\pagebreak

## Analyze the effect on each group

We want to see effect of TRUST and ID on each group (above is for all groups). Because of the less power, we cannot expect the same significant level as whole data, but the effect are similar between groups.

Because there is only group interaction on Profit of GroupID:SHOW_TRUST:SHOW_ID, so we only analyze the Profit of each group.

```{r, echo=FALSE}
  require(car)
  for (type in 0:1) {
    # AbsSend: absolute sending
    # RelSend: send proportion of maximum
    # Profit: profit get at this round
    # game_pos:  order of game to play in this experiment
    df <- data.frame("id" = as.numeric(), 
                     "GroupID"= as.numeric(),
                     "SHOW_TRUST"=as.numeric(),
                     "SHOW_ID"=as.numeric(),
                     "AbsSend" = as.numeric(),  
                     "RelSend" = as.numeric(),  
                     "Profit" = as.numeric(),
                     "game_pos" = as.numeric(),
                     "response_time" = as.numeric())
    for (j in 1:num_users) {
      for (exp_id in 1:num_exp) {
        for (k in 1:num_games) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          user_id = j + num_users * (exp_id - 1)
          
          if (k == 1) {
            new_row = c(as.numeric (user_id),
                        as.numeric (exp_id),
                        0,
                        0,
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$Contribution),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type & simple_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$CurrGameProfit),
                        SIMPLE_GAME_ORDERS[exp_id],
                        mean (simple_game[simple_game$Subject == j & simple_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 2) {
            new_row = c(user_id,
                        exp_id,
                        0,
                        1,
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$Contribution),
                        mean (id_game[id_game$Subject == j & id_game$Type == type & id_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$CurrGameProfit),
                        ID_GAME_ORDERS[exp_id],
                        mean (id_game[id_game$Subject == j & id_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 3) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        0,
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$Contribution),
                        mean (score_game[score_game$Subject == j & score_game$Type == type & score_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$CurrGameProfit),
                        SCORE_GAME_ORDERS[exp_id],
                        mean (score_game[score_game$Subject == j & score_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
          if (k == 4) {
            new_row = c(user_id,
                        exp_id,
                        1,
                        1,
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$Contribution),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type & combine_game$my_send_proportional >= 0,]$my_send_proportional),
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$CurrGameProfit),
                        COMBINE_GAME_ORDERS[exp_id],
                        mean (combine_game[combine_game$Subject == j & combine_game$Type == type,]$response_time)
            )
            df[nrow(df)+1,] <- new_row
          }
        }
      }
    }
    
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_pos <- as.factor(df$game_pos)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    # df$game_setting <- NULl
#     df$score <- df$AbsSend
#     
#     for (exp_id in 1:num_exp) {
#       print ( paste ("Analyze abs sending of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
#       df$id <- as.numeric(df$id)
#       min_id = 1 +  num_users * (exp_id - 1)
#       max_id =  num_users * exp_id
#       this_group <- df [df$id >= min_id & df$id <= max_id,]
#       this_group$id <- as.factor(this_group$id)
#       aov1 <- aov (score ~ SHOW_TRUST * SHOW_ID, data = this_group)
#       print (summary (aov1))
#       
# #       print ("With participant level")
# #       aov1 <- aov (score ~ id * SHOW_TRUST * SHOW_ID, data = this_group)
# #       print (summary (aov1))
#     }
    
    df$score <- df$Profit
    for (exp_id in 1:num_exp) {
      print ( paste ("Analyze Profit of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
      this_group <- df [df$GroupID == exp_id,]
      this_group$id <- as.factor(this_group$id)
      aov1 <- anova_analysis(df = this_group, type = type, num_way =  4)
      
      df_group <- data.frame("Without Trust" <- as.numeric(),
                             "With Trust" <- as.numeric())
      new_row <- c(mean(this_group[this_group$SHOW_TRUST == 0 & this_group$SHOW_ID == 0,]$Profit),
                   mean(this_group[this_group$SHOW_TRUST == 1 & this_group$SHOW_ID == 0,]$Profit))
      df_group[(nrow(df_group) + 1),] <- new_row
      
      new_row <- c(mean(this_group[this_group$SHOW_TRUST == 0 & this_group$SHOW_ID == 1,]$Profit),
                   mean(this_group[this_group$SHOW_TRUST == 1 & this_group$SHOW_ID == 1,]$Profit))
      df_group[(nrow(df_group) + 1),] <- new_row
      
      df_group <- cbind(Row.Names = c("Without ID", "With ID"), df_group)
      colnames(df_group) <- c("","Without Trust", "With Trust")
      
      print (df_group)
#       print ("With participant level")
#       aov1 <- aov (score ~ id * SHOW_TRUST * SHOW_ID, data = this_group)
#       print (summary (aov1))
    }
    
#     df$score <- df$RelSend
#     for (exp_id in 1:num_exp) {
#       print ( paste ("Analyze rel sending of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
#       df$id <- as.numeric(df$id)
#       min_id = 1 +  num_users * (exp_id - 1)
#       max_id =  num_users * exp_id
#       this_group <- df [df$id >= min_id & df$id <= max_id,]
#       this_group$id <- as.factor(this_group$id)
#       aov1 <- aov (score ~ SHOW_TRUST * SHOW_ID, data = this_group)
#       print (summary (aov1))
#     }
    
    df$score <- df$response_time
    for (exp_id in 1:num_exp) {
      print ( paste ("Analyze response time of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
      this_group <- df [df$GroupID == exp_id,]
      this_group$id <- as.factor(this_group$id)
      aov1 <- anova_analysis(df = this_group, type = type, num_way =  4)
    }
  }
  
  
```


```{r, echo=FALSE}
#   df <- data.frame("id" = as.numeric(), 
#                      "GroupID"= as.numeric(),
#                      "SHOW_TRUST"=as.numeric(),
#                      "SHOW_ID"=as.numeric(),
#                      "AbsSend" = as.numeric(),  
#                      "RelSend" = as.numeric(),  
#                      "Profit" = as.numeric(),
#                      "game_pos" = as.numeric(),
#                      "response_time" = as.numeric())
#     for (j in 1:num_users) {
#       for (exp_id in 1:num_exp) {
#         for (k in 1:num_games) {
#           first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#           last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#           simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#           id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#           score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#           combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#           
#           user_id = j + num_users * (exp_id - 1)
#           
#           if (k == 1) {
#             new_row = c(as.numeric (user_id),
#                         as.numeric (exp_id),
#                         0,
#                         0,
#                         sum (simple_game[simple_game$Subject == j,]$Contribution),
#                         mean (simple_game[simple_game$Subject == j  & simple_game$my_send_proportional >= 0,]$my_send_proportional),
#                         sum (simple_game[simple_game$Subject == j,]$CurrGameProfit),
#                         SIMPLE_GAME_ORDERS[exp_id],
#                         mean (simple_game[simple_game$Subject == j,]$response_time)
#             )
#             df[nrow(df)+1,] <- new_row
#           }
#           if (k == 2) {
#             new_row = c(user_id,
#                         exp_id,
#                         0,
#                         1,
#                         sum (id_game[id_game$Subject == j,]$Contribution),
#                         mean (id_game[id_game$Subject == j  & id_game$my_send_proportional >= 0,]$my_send_proportional),
#                         sum (id_game[id_game$Subject == j ,]$CurrGameProfit),
#                         ID_GAME_ORDERS[exp_id],
#                         mean (id_game[id_game$Subject == j ,]$response_time)
#             )
#             df[nrow(df)+1,] <- new_row
#           }
#           if (k == 3) {
#             new_row = c(user_id,
#                         exp_id,
#                         1,
#                         0,
#                         sum (score_game[score_game$Subject == j ,]$Contribution),
#                         mean (score_game[score_game$Subject == j  & score_game$my_send_proportional >= 0,]$my_send_proportional),
#                         sum (score_game[score_game$Subject == j ,]$CurrGameProfit),
#                         SCORE_GAME_ORDERS[exp_id],
#                         mean (score_game[score_game$Subject == j ,]$response_time)
#             )
#             df[nrow(df)+1,] <- new_row
#           }
#           if (k == 4) {
#             new_row = c(user_id,
#                         exp_id,
#                         1,
#                         1,
#                         sum (combine_game[combine_game$Subject == j ,]$Contribution),
#                         mean (combine_game[combine_game$Subject == j  & combine_game$my_send_proportional >= 0,]$my_send_proportional),
#                         sum (combine_game[combine_game$Subject == j ,]$CurrGameProfit),
#                         COMBINE_GAME_ORDERS[exp_id],
#                         mean (combine_game[combine_game$Subject == j ,]$response_time)
#             )
#             df[nrow(df)+1,] <- new_row
#           }
#         }
#       }
#     }
#     
#     df$id <- as.factor(df$id)
#     df$GroupID <- as.factor(df$GroupID)
#     df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
#     df$SHOW_ID <- as.factor(df$SHOW_ID)
#     df$game_pos <- as.factor(df$game_pos)
#     df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
#     
#     df$game_pos <- NULL
#     df$game_pos <-df$game_setting
#     # df$game_setting <- NULl
#     df$score <- df$AbsSend
#     
#     for (exp_id in 1:num_exp) {
#       print ( paste ("Analyze abs sending of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
#       df$id <- as.numeric(df$id)
#       min_id = 1 +  num_users * (exp_id - 1)
#       max_id =  num_users * exp_id
#       this_group <- df [df$id >= min_id & df$id <= max_id,]
#       this_group$id <- as.factor(this_group$id)
#       aov1 <- aov (score ~ SHOW_TRUST * SHOW_ID, data = this_group)
#       print (summary (aov1))
#       
# #       print ("With participant level")
# #       aov1 <- aov (score ~ id * SHOW_TRUST * SHOW_ID, data = this_group)
# #       print (summary (aov1))
#     }
#     
#     df$score <- df$Profit
#     for (exp_id in 1:num_exp) {
#       print ( paste ("Analyze Profit of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
#       df$id <- as.numeric(df$id)
#       min_id = 1 +  num_users * (exp_id - 1)
#       max_id =  num_users * exp_id
#       this_group <- df [df$id >= min_id & df$id <= max_id,]
#       this_group$id <- as.factor(this_group$id)
#       aov1 <- aov (score ~ SHOW_TRUST * SHOW_ID, data = this_group)
#       print (summary (aov1))
#       
# #       print ("With participant level")
# #       aov1 <- aov (score ~ id * SHOW_TRUST * SHOW_ID, data = this_group)
# #       print (summary (aov1))
#     }
#     
#     df$score <- df$RelSend
#     for (exp_id in 1:num_exp) {
#       print ( paste ("Analyze rel sending of SHOW_TRUST and SHOW_ID interaction on Group: ", exp_id, " for type: ", Type_names[(type + 1)]))
#       df$id <- as.numeric(df$id)
#       min_id = 1 +  num_users * (exp_id - 1)
#       max_id =  num_users * exp_id
#       this_group <- df [df$id >= min_id & df$id <= max_id,]
#       this_group$id <- as.factor(this_group$id)
#       aov1 <- aov (score ~ SHOW_TRUST * SHOW_ID, data = this_group)
#       print (summary (aov1))
#     }
```

\pagebreak

## Test the regression of sending behavior on different pieces of information

In the above section, we consider all games in a same kind as a whole. In this section, we want to see how each person behave in different kinds of situation.

First, we define four empty data frames for 4 kinds of game.

The new variable 'peak_end_trust' is used for calculate "peak end effect", which basically said that the feeling about a repeated event is average of maximum feeling so far and the last feeling the subject have with this event.

Then again we run through the whole data and load the game to corresponding dataframes.

After that, we applied the analysis on each individual game.

```{r, echo = FALSE}
  for (type in 0:1) {
    df_simple <- data.frame ("id" = as.numeric(),
                             "trust_value" = as.numeric(),
                             "RelSend" = as.numeric(),
                             "AbsSend" = as.numeric(),
                             "response_time" = as.numeric(),
                             "game_pos" = as.numeric(),
                             "peak_end_trust" = as.numeric(),
                             "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric())
    df_id <- data.frame ("id" = as.numeric(),
                         "trust_value" = as.numeric(),
                         "RelSend" = as.numeric(),
                         "AbsSend" = as.numeric(),
                         "response_time" = as.numeric(),
                         "game_pos" = as.numeric(),
                         "peak_end_trust" = as.numeric(),
                         "AbsPartnerSend" = as.numeric(),
                          "my_trust_value" = as.numeric(),
                         "PartnerRelSend" = as.numeric())
    df_score <- data.frame ("id" = as.numeric(),
                            "trust_value" = as.numeric(),
                            "RelSend" = as.numeric(),
                            "AbsSend" = as.numeric(),
                            "response_time" = as.numeric(),
                            "game_pos" = as.numeric(),
                            "peak_end_trust" = as.numeric(),
                            "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                            "PartnerRelSend" = as.numeric())
    df_combine <- data.frame ("id" = as.numeric(),
                              "trust_value" = as.numeric(),
                              "RelSend" = as.numeric(),
                              "AbsSend" = as.numeric(),
                              "response_time" = as.numeric(),
                              "game_pos" = as.numeric(),
                              "peak_end_trust" = as.numeric(),
                              "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric())
    for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      for (user_id in 1:num_users) {
        new_row = c((exp_id - 1) * num_users + user_id,
                    mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$showing_trust_score),
                    mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id & simple_game$my_send_proportional >= 0,]$my_send_proportional),
                    mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$Contribution),
                    mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$response_time),
                    SIMPLE_GAME_ORDERS[exp_id],
                    mean (calc_peak_end_trust(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$showing_trust_score)),
                    mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$PartnerDecision),
                    mean(simple_game[simple_game$Type == (1  - type) & simple_game$Partner == user_id,]$showing_trust_score),
                    mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$send_proportion)
                    )
        df_simple[nrow(df_simple) + 1,] <- new_row
        new_row = c((exp_id - 1) * num_users + user_id,
                    mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$showing_trust_score),
                    mean(id_game[id_game$Type == type & id_game$Subject == user_id & id_game$my_send_proportional >= 0,]$my_send_proportional),
                    mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$Contribution),
                    mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$response_time),
                    ID_GAME_ORDERS[exp_id],
                    mean(calc_peak_end_trust(id_game[id_game$Type == type & id_game$Subject == user_id,]$showing_trust_score)),
                    mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$PartnerDecision),
                    mean(id_game[id_game$Type == (1  - type) & id_game$Partner == user_id,]$showing_trust_score),
                    mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$send_proportion)
        )
        df_id[nrow(df_id) + 1,] <- new_row
        new_row = c((exp_id - 1) * num_users + user_id,
                    mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$showing_trust_score),
                    mean(score_game[score_game$Type == type & score_game$Subject == user_id & score_game$my_send_proportional >= 0,]$my_send_proportional),
                    mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$Contribution),
                    mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$response_time),
                    SCORE_GAME_ORDERS[exp_id],
                    mean (calc_peak_end_trust(score_game[score_game$Type == type & score_game$Subject == user_id,]$showing_trust_score)),
                    mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$PartnerDecision),
                    mean(score_game[score_game$Type == (1  - type) & score_game$Partner == user_id,]$showing_trust_score),
                    mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$send_proportion)
        )
        df_score[nrow(df_score) + 1,] <- new_row
        new_row = c((exp_id - 1) * num_users + user_id,
                    mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$showing_trust_score),
                    mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id & combine_game$my_send_proportional >= 0,]$my_send_proportional),
                    mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$Contribution),
                    mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$response_time),
                    COMBINE_GAME_ORDERS[exp_id],
                    mean (calc_peak_end_trust(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$showing_trust_score)),
                    mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$PartnerDecision),
                    mean(combine_game[combine_game$Type == (1  - type) & combine_game$Partner == user_id,]$showing_trust_score),
                    mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$send_proportion)
        )
        df_combine[nrow(df_combine) + 1,] <- new_row
      }
    }
    # Regression of response time on game position
#     jpeg(filename = "./all_data/Response_time_simple_game.jpeg", width = 1000,quality = 100)
#     print ("*****")
#     print (paste ("PLAYER ROLE: ", Type_names[type + 1]))
#     print ("*****")
#     print ("Response time of Simple Game (mean and std)")
#     print (mean(df_simple$response_time))
#     print (pop.sd(df_simple$response_time))
#     print ("Response time of Simple Game with the the order 1st has been removed")
#     print (mean(df_simple[df_simple$game_pos > 1,]$response_time))
#     print (pop.sd(df_simple[df_simple$game_pos > 1,]$response_time))
#     print ("Response time of Simple Game when it was played at the 1st game")
#     print (mean(df_simple[df_simple$game_pos == 1,]$response_time))
#     print (pop.sd(df_simple[df_simple$game_pos == 1,]$response_time))
#     print ("Residual plot of response time on game position")
#     mod1 <- lm(response_time ~ game_pos, data = df_simple)
#     plot(df_simple$game_pos, df_simple$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "Simple Game")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_simple$game_pos, df_simple$response_time, df_simple$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_simple$game_pos, df_simple$response_time, res, cx=0.7)
#     print (summary (mod1))
#     
#     print ("Residual plot of response time on game position without 1st order game")
#     mod1 <- lm(response_time ~ game_pos, data = df_simple[df_simple$game_pos > 1,])
#     plot(df_simple[df_simple$game_pos > 1,]$game_pos, df_simple[df_simple$game_pos > 1,]$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "Simple Game without 1st order")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_simple[df_simple$game_pos > 1,]$game_pos, df_simple[df_simple$game_pos > 1,]$response_time, df_simple[df_simple$game_pos > 1,]$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_simple[df_simple$game_pos > 1,]$game_pos, df_simple[df_simple$game_pos > 1,]$response_time, res, cx=0.7)
#     print (summary (mod1))
# #     dev.off()
# 
#     print ("*****")
#     print (paste ("PLAYER ROLE: ", Type_names[type + 1]))
#     print ("*****")
#     print ("Response time of Simple Game (mean and std)")
#     print (mean(df_id$response_time))
#     print (pop.sd(df_id$response_time))
#     print ("Response time of Simple Game with the the order 1st has been removed")
#     print (mean(df_id[df_id$game_pos > 1,]$response_time))
#     print (pop.sd(df_id[df_id$game_pos > 1,]$response_time))
#     print ("Response time of Simple Game when it was played at the 1st game")
#     print (mean(df_id[df_id$game_pos == 1,]$response_time))
#     print (pop.sd(df_id[df_id$game_pos == 1,]$response_time))
#     
#     print ("Residual plot of response time on game position")
#     mod1 <- lm(response_time ~ game_pos, data = df_id)
#     plot(df_id$game_pos, df_id$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "ID Game")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_id$game_pos, df_id$response_time, df_id$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_id$game_pos, df_id$response_time, res, cx=0.7)
#     print (summary (mod1))
#     
#     print ("Residual plot of response time on game position without 1st order game")
#     mod1 <- lm(response_time ~ game_pos, data = df_id[df_id$game_pos > 1,])
#     plot(df_id[df_id$game_pos > 1,]$game_pos, df_id[df_id$game_pos > 1,]$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "ID Game without 1st order")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_id[df_id$game_pos > 1,]$game_pos, df_id[df_id$game_pos > 1,]$response_time, df_id[df_id$game_pos > 1,]$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_id[df_id$game_pos > 1,]$game_pos, df_id[df_id$game_pos > 1,]$response_time, res, cx=0.7)
#     print (summary (mod1))
#     
#     print ("*****")
#     print (paste ("PLAYER ROLE: ", Type_names[type + 1]))
#     print ("*****")
#     print ("Response time of Simple Game (mean and std)")
#     print (mean(df_score$response_time))
#     print (pop.sd(df_score$response_time))
#     print ("Response time of Simple Game with the the order 1st has been removed")
#     print (mean(df_score[df_score$game_pos > 1,]$response_time))
#     print (pop.sd(df_score[df_score$game_pos > 1,]$response_time))
#     print ("Response time of Simple Game when it was played at the 1st game")
#     print (mean(df_score[df_score$game_pos == 1,]$response_time))
#     print (pop.sd(df_score[df_score$game_pos == 1,]$response_time))
#     
#     print ("Residual plot of response time on game position")
#     mod1 <- lm(response_time ~ game_pos, data = df_score)
#     plot(df_score$game_pos, df_score$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "Score Game")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_score$game_pos, df_score$response_time, df_score$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_score$game_pos, df_score$response_time, res, cx=0.7)
#     print (summary (mod1))
#     
#     print ("Residual plot of response time on game position without 1st order game")
#     mod1 <- lm(response_time ~ game_pos, data = df_score[df_score$game_pos > 1,])
#     plot(df_score[df_score$game_pos > 1,]$game_pos, df_score[df_score$game_pos > 1,]$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "Score Game without 1st order")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_score[df_score$game_pos > 1,]$game_pos, df_score[df_score$game_pos > 1,]$response_time, df_score[df_score$game_pos > 1,]$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_score[df_score$game_pos > 1,]$game_pos, df_score[df_score$game_pos > 1,]$response_time, res, cx=0.7)
#     print (summary (mod1))
#     
#     print ("*****")
#     print (paste ("PLAYER ROLE: ", Type_names[type + 1]))
#     print ("*****")
#     print ("Response time of Simple Game (mean and std)")
#     print (mean(df_combine$response_time))
#     print (pop.sd(df_combine$response_time))
#     print ("Response time of Simple Game with the the order 1st has been removed")
#     print (mean(df_combine[df_combine$game_pos > 1,]$response_time))
#     print (pop.sd(df_combine[df_combine$game_pos > 1,]$response_time))
#     print ("Response time of Simple Game when it was played at the 1st game")
#     print (mean(df_combine[df_combine$game_pos == 1,]$response_time))
#     print (pop.sd(df_combine[df_combine$game_pos == 1,]$response_time))
#     
#     print ("Residual plot of response time on game position")
#     mod1 <- lm(response_time ~ game_pos, data = df_combine)
#     plot(df_combine$game_pos, df_combine$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "Combine Game")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_combine$game_pos, df_combine$response_time, df_combine$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_combine$game_pos, df_combine$response_time, res, cx=0.7)
#     print (summary (mod1))
#     
#     print ("Residual plot of response time on game position without 1st order game")
#     mod1 <- lm(response_time ~ game_pos, data = df_combine[df_combine$game_pos > 1,])
#     plot(df_combine[df_combine$game_pos > 1,]$game_pos, df_combine[df_combine$game_pos > 1,]$response_time, xlim=c(0,5), ylim=c(0, 40), xlab = "Game Postion", ylab = "Response time in seconds",
#          main = "Combine Game without 1st order")
#     abline(mod1, lwd=2)
#     # calculate residuals and predicted values
#     res <- signif(residuals(mod1), 5)
#     pre <- predict(mod1) # plot distances between points and the regression line
#     segments(df_combine[df_combine$game_pos > 1,]$game_pos, df_combine[df_combine$game_pos > 1,]$response_time, df_combine[df_combine$game_pos > 1,]$game_pos, pre, col="red")
#     # add labels (res values) to points
#     library(calibrate)
#     textxy(df_combine[df_combine$game_pos > 1,]$game_pos, df_combine[df_combine$game_pos > 1,]$response_time, res, cx=0.7)
#     print (summary (mod1))
    
    # Linear regression
    print (paste (("Linear regression of relative sending on trust value of Simple Game for type: "), Type_names [ type + 1]))
    # print (summary (lm(RelSend ~ trust_value, data = df_simple)))
    if (type == 0) {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_simple)))
    } else {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_simple)))
      print ("--------")
      print (summary (lm(RelSend ~ trust_value + my_trust_value + AbsPartnerSend, data = df_simple)))
      print ("--------")
      print (summary (lm(RelSend ~ my_trust_value + AbsPartnerSend, data = df_simple)))
    }
    
#     print (paste (("Linear regression of abs sending on trust value of Simple Game for type: "), Type_names [ type + 1]))
#     print (summary (lm(AbsSend ~ trust_value, data = df_simple)))
#     print (summary (lm(AbsSend ~ trust_value + my_trust_value, data = df_simple)))
    
    print (paste (("Linear regression of relative sending on trust value of ID Game for type: "), Type_names [ type + 1]))
    # print (summary (lm(RelSend ~ trust_value, data = df_id)))
    if (type == 0) {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_id)))
    } else {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_id)))
      print ("--------")
      print (summary (lm(RelSend ~ trust_value + my_trust_value + AbsPartnerSend, data = df_id)))
      print ("--------")
      print (summary (lm(RelSend ~ my_trust_value + AbsPartnerSend, data = df_id)))
    }
    
#     print (paste (("Linear regression of abs sending on trust value of ID Game for type: "), Type_names [ type + 1]))
#     print (summary (lm(AbsSend ~ trust_value, data = df_id)))
#     print (summary (lm(AbsSend ~ trust_value + my_trust_value, data = df_id)))
    
    print (paste (("Linear regression of relative sending on trust value of Score Game for type: "), Type_names [ type + 1]))
    # print (summary (lm(RelSend ~ trust_value, data = df_score)))
    if (type == 0) {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_score)))
    } else {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_score)))
      print ("--------")
      print (summary (lm(RelSend ~ trust_value + my_trust_value + AbsPartnerSend, data = df_score)))
      print ("--------")
      print (summary (lm(RelSend ~ my_trust_value + AbsPartnerSend, data = df_score)))
    }
    
#     print (paste (("Linear regression of abs sending on trust value of Score Game for type: "), Type_names [ type + 1]))
#     print (summary (lm(AbsSend ~ trust_value, data = df_score)))
#     print (summary (lm(AbsSend ~ trust_value + my_trust_value, data = df_score)))
    
    print (paste (("Linear regression of relative sending on trust value of Combine Game for type: "), Type_names [ type + 1]))
    # print (summary (lm(RelSend ~ trust_value, data = df_combine)))
    if (type == 0) {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_combine)))
    } else {
      print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_combine)))
      print ("--------")
      print (summary (lm(RelSend ~ trust_value + my_trust_value + AbsPartnerSend, data = df_combine)))
      print ("--------")
      print (summary (lm(RelSend ~ my_trust_value + AbsPartnerSend, data = df_combine)))
    }
    
#     for (exp_id in 1:num_exp) {
#       print (paste("Regression of sending behavior on 2 trust score for Group ", exp_id))
#       first_round = 1 + (nrow(df_simple)/num_exp) * (exp_id - 1)
#       last_round = (nrow(df_simple)/num_exp) * exp_id
#       print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_simple[first_round:last_round,])))
#       print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_id[first_round:last_round,])))
#       print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_score[first_round:last_round,])))
#       print (summary (lm(RelSend ~ trust_value + my_trust_value, data = df_combine[first_round:last_round,])))
#     }
    
#     print (paste (("Linear regression of abs sending on trust value of Combine Game for type: "), Type_names [ type + 1]))
#     print (summary (lm(AbsSend ~ trust_value, data = df_combine)))
#     print (summary (lm(AbsSend ~ trust_value + my_trust_value, data = df_combine)))
    
#     # Correlation
#     print (paste (("Correlation for type: "), Type_names [ type + 1]))
#     print (cor.test(df_simple$AbsSend, df_simple$trust_value))
#     print (cor.test(df_id$AbsSend, df_id$trust_value))
#     print (cor.test(df_score$AbsSend, df_score$trust_value))
#     print (cor.test(df_combine$AbsSend, df_combine$trust_value))
#     
#     print (cor.test(df_simple$RelSend, df_simple$trust_value))
#     print (cor.test(df_id$RelSend, df_id$trust_value))
#     print (cor.test(df_score$RelSend, df_score$trust_value))
#     print (cor.test(df_combine$RelSend, df_combine$trust_value))
    
#     require (cocor)
#     print (cocor(~AbsSend + trust_value|AbsSend + trust_value, list(df_simple, df_id)))
#     print (cocor(~RelSend + trust_value|RelSend + trust_value, list(df_simple, df_id)))
#     
#     print (cocor(~AbsSend + trust_value|AbsSend + trust_value, list(df_score, df_combine)))
#     print (cocor(~RelSend + trust_value|RelSend + trust_value, list(df_score, df_combine)))
#     
#     print ("")
#     print ("*****")
    
    # Linear regression with peak_end_trust, instead of trust_value
#     print (paste (("Linear regression of sending on peak_end_trust for type: "), Type_names [ type + 1]))
#     print (summary (lm(RelSend ~ peak_end_trust, data = df_simple)))
#     print (summary (lm(AbsSend ~ peak_end_trust, data = df_simple)))
#     
#     print (summary (lm(RelSend ~ peak_end_trust, data = df_id)))
#     print (summary (lm(AbsSend ~ peak_end_trust, data = df_id)))
#     
#     print (summary (lm(RelSend ~ peak_end_trust, data = df_score)))
#     print (summary (lm(AbsSend ~ peak_end_trust, data = df_score)))
#     
#     print (summary (lm(RelSend ~ peak_end_trust, data = df_combine)))
#     print (summary (lm(AbsSend ~ peak_end_trust, data = df_combine)))
  }
```

\pagebreak

## Group effect analysis with group and round number as between variables

Date: 2-Jun-2017

```{r, echo=FALSE}
require(car)
for (type in 0:1) {
  # AbsSend: absolute sending
  # RelSend: send proportion of maximum
  # Profit: profit get at this round
  # game_pos:  order of game to play in this experiment
  df <- data.frame("id" = as.numeric(), 
                   "GroupID"= as.numeric(),
                 "SHOW_TRUST"=as.numeric(),
                 "SHOW_ID"=as.numeric(),
                 # "AbsSend" = as.numeric(),  
                 "RelSend" = as.numeric(),  
                 # "Profit" = as.numeric(),
                 # "game_pos" = as.numeric(),
                 # "response_time" = as.numeric(),
                 "round_number" = as.numeric()
                 )
  print (paste("Analyze", Type_names[type+1]))
      for (exp_id in 1:num_exp) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          # user_id = j + num_users * (exp_id - 1)
          
          all_game <- list (simple_game, id_game, score_game, combine_game)
          
          for (k in 1:num_games) {
            cur_game <- as.data.frame(all_game [k])
            
            
            for (user_id in 1:6) {
              for (partner_id in 1:6) {
                if (user_id != partner_id) {
                  send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                  partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                  my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                  types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                  
                  for (period in 1:5) {
                    if (types[period] == type & send_proportion[period] >= 0) {
                      
                      new_row <- c(as.numeric (user_id) + num_users * (exp_id - 1),
                        as.numeric (exp_id),
                        ifelse (k <= 2, 0, 1),
                        ifelse (k %% 2 == 0, 1, 0),
                        send_proportion[period],
                        period
                      )
                      
                      df[nrow(df)+1,] <- new_row
                    }
                  }
                }          
              }
            }
          }
      }
    
  
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    
    df$score <- df$RelSend
    
    df$AbsSend <- NULL
    df$RelSend <- NULL
    df$Profit <- NULL
    df$response_time <- NULL
    df$game_pos <- NULL
    df$game_setting <- NULL
    
    df$round_number <- as.factor(df$round_number)
    
    a1 <- aov (score ~ SHOW_TRUST * SHOW_ID * round_number + Error (id * GroupID / SHOW_TRUST * SHOW_ID * round_number), data=df)
    print (summary (a1))
    
    # a1 <- aov (score ~ SHOW_TRUST * SHOW_ID + Error (id * GroupID / SHOW_TRUST * SHOW_ID), data=df)
    # print (summary (a1))
}
```

\pagebreak

## Group effect analysis with group and round number as between variables

However, we keep only first 2 rounds in each roles

Date: 12-Jun-2017

```{r, echo=FALSE}
require(car)
for (type in 0:1) {
  # AbsSend: absolute sending
  # RelSend: send proportion of maximum
  # Profit: profit get at this round
  # game_pos:  order of game to play in this experiment
  df <- data.frame("id" = as.numeric(), 
                   "GroupID"= as.numeric(),
                 "SHOW_TRUST"=as.numeric(),
                 "SHOW_ID"=as.numeric(),
                 # "AbsSend" = as.numeric(),  
                 "RelSend" = as.numeric(),  
                 # "Profit" = as.numeric(),
                 # "game_pos" = as.numeric(),
                 # "response_time" = as.numeric(),
                 "round_number" = as.numeric()
                 )
  print (paste("Analyze", Type_names[type+1]))
      for (exp_id in 1:num_exp) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          # user_id = j + num_users * (exp_id - 1)
          
          all_game <- list (simple_game, id_game, score_game, combine_game)
          
          for (k in 1:num_games) {
            cur_game <- as.data.frame(all_game [k])
            
            
            for (user_id in 1:6) {
              for (partner_id in 1:6) {
                
                add_count = 0 # count to keep only 2 first rounds for each role
                if (user_id != partner_id) {
                  send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                  partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                  my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                  types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                  
                  for (period in 1:5) {
                    if (types[period] == type & send_proportion[period] >= 0 & add_count < 2) {
                      
                      new_row <- c(as.numeric (user_id) + num_users * (exp_id - 1),
                        as.numeric (exp_id),
                        ifelse (k <= 2, 0, 1),
                        ifelse (k %% 2 == 0, 1, 0),
                        send_proportion[period],
                        period
                      )
                      
                      df[nrow(df)+1,] <- new_row
                      add_count = add_count + 1
                    }
                  }
                }          
              }
            }
          }
      }
    
  
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    
    df$score <- df$RelSend
    
    df$AbsSend <- NULL
    df$RelSend <- NULL
    df$Profit <- NULL
    df$response_time <- NULL
    df$game_pos <- NULL
    df$game_setting <- NULL
    
    df$round_number <- as.factor(df$round_number)
    
    a1 <- aov (score ~ SHOW_TRUST * SHOW_ID * round_number + Error (id * GroupID / SHOW_TRUST * SHOW_ID * round_number), data=df)
    print (summary (a1))
    
    # a1 <- aov (score ~ SHOW_TRUST * SHOW_ID + Error (id * GroupID / SHOW_TRUST * SHOW_ID), data=df)
    # print (summary (a1))
}
```

\pagebreak

## Group effect analysis for each round

Now, we create five datasets for five rounds to analyze ANOVA. We expected that the same effect will appear in 5 analysis.

Date: 12-Jun-2017

```{r, echo=FALSE}
require(car)
for (type in 0:1) {
  # AbsSend: absolute sending
  # RelSend: send proportion of maximum
  # Profit: profit get at this round
  # game_pos:  order of game to play in this experiment
  
  for (round_id in 1:5) {
    df <- data.frame("id" = as.numeric(), 
                   "GroupID"= as.numeric(),
                 "SHOW_TRUST"=as.numeric(),
                 "SHOW_ID"=as.numeric(),
                 # "AbsSend" = as.numeric(),  
                 "RelSend" = as.numeric(),  
                 # "Profit" = as.numeric(),
                 # "game_pos" = as.numeric(),
                 # "response_time" = as.numeric(),
                 "round_number" = as.numeric()
                 )
    print (paste("Analyze", Type_names[type+1]))
    print (paste("Round number:", round_id))
    for (exp_id in 1:num_exp) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          # user_id = j + num_users * (exp_id - 1)
          
          all_game <- list (simple_game, id_game, score_game, combine_game)
          
          for (k in 1:num_games) {
            cur_game <- as.data.frame(all_game [k])
            
            
            for (user_id in 1:6) {
              for (partner_id in 1:6) {
                
                add_count = 1 
                if (user_id != partner_id) {
                  send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                  partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                  my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                  types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                  
                  for (period in 1:5) {
                    if (types[period] == type & send_proportion[period] >= 0 & add_count <= 1 & period == round_id) {
                      
                      new_row <- c(as.numeric (user_id) + num_users * (exp_id - 1),
                        as.numeric (exp_id),
                        ifelse (k <= 2, 0, 1),
                        ifelse (k %% 2 == 0, 1, 0),
                        send_proportion[period],
                        period
                      )
                      
                      df[nrow(df)+1,] <- new_row
                      add_count = add_count + 1
                    }
                  }
                }          
              }
            }
          }
      }
    
  
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    
    df$score <- df$RelSend
    
    df$AbsSend <- NULL
    df$RelSend <- NULL
    df$Profit <- NULL
    df$response_time <- NULL
    df$game_pos <- NULL
    df$game_setting <- NULL
    
    df$round_number <- as.factor(df$round_number)
    
    anova_analysis(df, type = type, num_way = 3)
  }
}
```

\pagebreak

##Test against group effect on each round

Repeat the previous analysis but for all 12 rounds and without group id

Date: Tue 13-Jun-2017

Date: 14-Jun-2017 I added the function anove_random_subject(df) so we can run ANOVA with corrected error term

```{r, echo=FALSE}
require(car)
for (type in 0:1) {
  # AbsSend: absolute sending
  # RelSend: send proportion of maximum
  # Profit: profit get at this round
  # game_pos:  order of game to play in this experiment
  
  list_of_p_values <- c()
  list_of_avg_send_proportion <- c()
  for (round_id in 1:12) {
    df <- data.frame("id" = as.numeric(), 
                   "GroupID"= as.numeric(),
                 "SHOW_TRUST"=as.numeric(),
                 "SHOW_ID"=as.numeric(),
                 # "AbsSend" = as.numeric(),  
                 "RelSend" = as.numeric(),  
                 # "Profit" = as.numeric(),
                 # "game_pos" = as.numeric(),
                 # "response_time" = as.numeric(),
                 "round_number" = as.numeric()
                 )
    print (paste("Analyze", Type_names[type+1]))
    print (paste("Round number:", round_id))
    
    # for calculating means
    send_simple <- c()
    send_id <- c()
    send_score <- c()
    send_combine <- c()
    
    for (exp_id in 1:num_exp) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          # user_id = j + num_users * (exp_id - 1)
          
          all_game <- list (simple_game, id_game, score_game, combine_game)
          
          for (k in 1:num_games) {
            cur_game <- as.data.frame(all_game [k])
            for (user_id in 1:6) {
              send_proportion <- cur_game[cur_game$Subject == user_id  & cur_game$Type == type,]$my_send_proportional
              partner_trust_score <- cur_game[cur_game$Subject == user_id  & cur_game$Type == type,]$showing_trust_score
              # print (paste(user_id, exp_id, k))
              if (length(send_proportion) >= round_id) {
                if (send_proportion[round_id] >= 0) {
                  new_row <- c(as.numeric (user_id) + num_users * (exp_id - 1),
                    as.numeric (exp_id),
                    ifelse (k <= 2, 0, 1),
                    ifelse (k %% 2 == 0, 1, 0),
                    send_proportion[round_id],
                    round_id
                  )
                  df[nrow(df)+1,] <- new_row
                  if (k==1) {
                    send_simple <- c(send_simple, send_proportion[round_id])
                  } else if (k==2) {
                    send_id <- c(send_id, send_proportion[round_id])
                  } else if (k==3) {
                    send_score <- c(send_score, send_proportion[round_id])
                  } else if (k==4) {
                    send_combine <- c(send_combine, send_proportion[round_id])
                  }
                }
              }
            }
          }
      }
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    
    df$score <- df$RelSend
    
    df$AbsSend <- NULL
    df$RelSend <- NULL
    df$Profit <- NULL
    df$response_time <- NULL
    df$game_pos <- NULL
    df$game_setting <- NULL
    
    df$round_number <- as.factor(df$round_number)
    
    # aov1 <- aov (score ~ SHOW_TRUST * SHOW_ID + Error (id/(SHOW_TRUST*SHOW_ID)), data = df)
    # aov1.summary <- summary (aov1)
    # p.value <- aov1.summary$`Error: id:SHOW_TRUST:SHOW_ID`[[1]][["Pr(>F)"]][[1]]
    # list_of_p_values <- c(list_of_p_values, p.value)
    # print (aov1.summary)
    # 
    # # do linear regression
    # # date: 13 - Jun - 2017
    # 
    # lm1 <- lm (score ~ id, data = df)
    # df$lm1.res = resid(lm1)
    # lm2 <- lm (lm1.res ~ SHOW_TRUST + SHOW_ID + SHOW_TRUST * SHOW_ID, data=df)
    # print (summary (lm2))
    # 
    # p_value <- summary(lm2)$coefficients[,4]
    
    # date: Tue 13-Jun-2017
    # ANOVA on linear regression with Type 3 Sum of Sqr
    
    l1 <- lm (score ~ SHOW_TRUST + SHOW_ID + SHOW_TRUST * SHOW_ID + id, data = df)
    a1 <- Anova(l1, type = "III")

    print (a1)

    p_value <- a1$`Pr(>F)`

    # check p_value of SHOW_TRUST
    if (p_value[2] < 0.05) {
      print ("SHOW TRUST significant")
      print (paste("Mean no trust:", mean (c(send_simple, send_id))))
      print (paste("Mean with trust:", mean (c(send_score, send_combine))))
    }
    # check p_value of SHOW_ID
    if (p_value[3] < 0.05) {
      print ("SHOW ID significant")
      print (paste("Mean no nickname:", mean (c(send_simple, send_score))))
      print (paste("Mean with nickname:", mean (c(send_id, send_combine))))
    }
    # check p_value of SHOW_TRUST*SHOW_ID
    if (p_value[5] < 0.05) {
      print ("SHOW_TRUST*SHOW_ID significant")
      print (paste("Mean simple", mean(send_simple)))
      print (paste("Mean id", mean(send_id)))
      print (paste("Mean score", mean(send_score)))
      print (paste("Mean combine", mean(send_combine)))
    }

    mean_send_proportion <- mean (c(send_simple, send_id, send_score, send_combine))
    print (paste("Mean of all games this round:", mean_send_proportion))

    print ("Length of each vector")
    print (length(send_simple))
    print (length(send_id))
    print (length(send_score))
    print (length(send_combine))

    list_of_p_values <- c(list_of_p_values, p_value[5])
    list_of_avg_send_proportion <- c(list_of_avg_send_proportion, mean_send_proportion)
    # # 14-Jun-2017: test against group effect by using anova_random_subject() on each round
    # anova_random_subject(df)
  }
  # 
  print ("------")
  print (paste("TYPE: ", Type_names[type+1]))
  # print (paste("List of p_value:", list_of_p_values))
  plot (list_of_p_values, xlab = paste("Round (regardless partner) for:", Type_names[type+1]), ylab="p_value of ANOVA", type = "o", ylim =c(0,1))
  lines(list_of_avg_send_proportion, col = "red", type = "o", lty = 2)
  legend(x=1,y=1, col=c("black","red"), lty = c(1,2), c("p_value of interaction","mean of send proportion of all games"))
  abline (h=0.05, col = "green") 
}
```

\pagebreak

##ANOVA on each round to check the group effect

Date: 14-Jun-2017
It is only available for SENDER because for RECEIVER the data is imbalanced (due to zero transaction removal)

```{r, echo=FALSE}
require(car)
for (type in 0:0) {
  # AbsSend: absolute sending
  # RelSend: send proportion of maximum
  # Profit: profit get at this round
  # game_pos:  order of game to play in this experiment
  
  list_of_p_values <- c()
  list_of_avg_send_proportion <- c()
  for (round_id in 1:7) {
    df <- data.frame("id" = as.numeric(), 
                   "GroupID"= as.numeric(),
                 "SHOW_TRUST"=as.numeric(),
                 "SHOW_ID"=as.numeric(),
                 # "AbsSend" = as.numeric(),  
                 "RelSend" = as.numeric(),  
                 # "Profit" = as.numeric(),
                 # "game_pos" = as.numeric(),
                 # "response_time" = as.numeric(),
                 "round_number" = as.numeric()
                 )
    print (paste("Analyze", Type_names[type+1]))
    print (paste("Round number:", round_id))
    
    # for calculating means
    send_simple <- c()
    send_id <- c()
    send_score <- c()
    send_combine <- c()
    
    for (exp_id in 1:num_exp) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          # user_id = j + num_users * (exp_id - 1)
          
          all_game <- list (simple_game, id_game, score_game, combine_game)
          
          for (k in 1:num_games) {
            cur_game <- as.data.frame(all_game [k])
            for (user_id in 1:6) {
              send_proportion <- cur_game[cur_game$Subject == user_id  & cur_game$Type == type,]$my_send_proportional
              partner_trust_score <- cur_game[cur_game$Subject == user_id  & cur_game$Type == type,]$showing_trust_score
              # print (paste(user_id, exp_id, k))
              if (length(send_proportion) >= round_id) {
                if (send_proportion[round_id] >= 0) {
                  new_row <- c(as.numeric (user_id) + num_users * (exp_id - 1),
                    as.numeric (exp_id),
                    ifelse (k <= 2, 0, 1),
                    ifelse (k %% 2 == 0, 1, 0),
                    send_proportion[round_id],
                    round_id
                  )
                  df[nrow(df)+1,] <- new_row
                  if (k==1) {
                    send_simple <- c(send_simple, send_proportion[round_id])
                  } else if (k==2) {
                    send_id <- c(send_id, send_proportion[round_id])
                  } else if (k==3) {
                    send_score <- c(send_score, send_proportion[round_id])
                  } else if (k==4) {
                    send_combine <- c(send_combine, send_proportion[round_id])
                  }
                }
              }
            }
          }
      }
    df$id <- as.factor(df$id)
    df$GroupID <- as.factor(df$GroupID)
    df$SHOW_TRUST <- as.factor (df$SHOW_TRUST)
    df$SHOW_ID <- as.factor(df$SHOW_ID)
    df$game_setting <- as.factor (((as.numeric (df$SHOW_TRUST) - 1) * 2 + (as.numeric (df$SHOW_ID) - 1) + 1))
    
    df$game_pos <- NULL
    df$game_pos <-df$game_setting
    
    df$score <- df$RelSend
    
    df$AbsSend <- NULL
    df$RelSend <- NULL
    df$Profit <- NULL
    df$response_time <- NULL
    df$game_pos <- NULL
    df$game_setting <- NULL
    
    df$round_number <- as.factor(df$round_number)
    # # 14-Jun-2017: test against group effect by using anova_random_subject() on each round
    anova_random_subject(df)
  }
}
```

\pagebreak

## Group effect analysis in each game

Date: Tue 6-Jun-2017

First we do send_proportion ~ subject id, then run residual of the first regression ~ round_number

```{r, echo=FALSE}
require(car)
for (type in 0:1) {
  
  print (paste("Analyze", Type_names[type+1]))
  for (game_number in 1:4) {
    df <- data.frame("id" = as.numeric(), 
                   "GroupID"= as.numeric(),
                 "SHOW_TRUST"=as.numeric(),
                 "SHOW_ID"=as.numeric(),
                 # "AbsSend" = as.numeric(),  
                 "RelSend" = as.numeric(),  
                 # "Profit" = as.numeric(),
                 # "game_pos" = as.numeric(),
                 # "response_time" = as.numeric(),
                 "round_number" = as.numeric()
                 )
    print (paste ("Analyze game,", GAME_NAMES[game_number]))
      for (exp_id in 1:num_exp) {
          first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
          last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
          simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
          combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
          
          user_id = j + num_users * (exp_id - 1)
          
          all_game <- list (simple_game, id_game, score_game, combine_game)
          
          
            cur_game <- as.data.frame(all_game [game_number])
            
            
            for (user_id in 1:6) {
              for (partner_id in 1:6) {
                if (user_id != partner_id) {
                  send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                  partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                  my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                  types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                  
                  for (period in 1:5) {
                    if (types[period] == type & send_proportion[period] >= 0) {
                      
                      new_row <- c(as.numeric (user_id),
                        as.numeric (exp_id),
                        ifelse (game_number <= 2, 0, 1),
                        ifelse (game_number %% 2 == 0, 1, 0),
                        send_proportion[period],
                        period
                      )
                      
                      df[nrow(df)+1,] <- new_row
                    }
                  }
                }          
              }
            }
          
      }
    
    
    df <- df[df$RelSend >= 0,]
    l1 <- lm (RelSend ~ id, data = df)
    l1.res <- resid(l1)
    l2 <- lm (l1.res ~ df$round_number)
    print (summary(l2))
  }
    
    # a1 <- aov (score ~ SHOW_TRUST * SHOW_ID + Error (id * GroupID / SHOW_TRUST * SHOW_ID), data=df)
    # print (summary (a1))
}
```

\pagebreak

## Regression of sending behavior on subjectID and round number

We test the regression power of predicting future sending proportion

```{r,echo=FALSE}
for (type in 0:1) {
  sends <- c()
  subject_ids <- c()
  my_trusts <- c()
  partner_trusts <- c()
  round_numbers <- c()
  print (paste ("SIMPLE GAME with ", Type_names[type + 1]))
  for (exp_id in 1:num_exp) {
    
    
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      
      cur_game <- simple_game
      for (user_id in 1:6) {
            for (partner_id in 1:6) {
              if (user_id != partner_id) {
                send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                
                for (period in 2:5) {
                  if (types[period] == type) {
                    sends <- c(sends, send_proportion[period])
                    partner_trusts <- c(partner_trusts, partner_trust_score[period])
                    my_trusts <- c(my_trusts, my_trust_score[period])
                    subject_ids <- c(subject_ids, user_id + (exp_id-1) * num_users)
                    round_numbers <- c(round_numbers, period)
                  }
                }
                
              }          
            }
            
          }
      }
      
      l_model <- lm (sends ~ as.factor(subject_ids) + my_trusts + partner_trusts + round_numbers)
      print (summary (l_model))
}
```

```{r,echo=FALSE}
for (type in 0:1) {
  sends <- c()
  subject_ids <- c()
  my_trusts <- c()
  partner_trusts <- c()
  round_numbers <- c()
  
  print (paste ("ID GAME with ", Type_names[type + 1]))
  for (exp_id in 1:num_exp) {
    
    
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      
      cur_game <- id_game
      for (user_id in 1:6) {
            for (partner_id in 1:6) {
              if (user_id != partner_id) {
                send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                
                for (period in 2:5) {
                  if (types[period] == type) {
                    sends <- c(sends, send_proportion[period])
                    partner_trusts <- c(partner_trusts, partner_trust_score[period])
                    my_trusts <- c(my_trusts, my_trust_score[period])
                    subject_ids <- c(subject_ids, user_id + (exp_id-1) * num_users)
                    round_numbers <- c(round_numbers, period)
                  }
                }
                
              }          
            }
            
          }
      }
      
      l_model <- lm (sends ~ as.factor(subject_ids) + my_trusts + partner_trusts + round_numbers)
      print (summary (l_model))
}
```

```{r,echo=FALSE}
for (type in 0:1) {
  sends <- c()
  subject_ids <- c()
  my_trusts <- c()
  partner_trusts <- c()
  round_numbers <- c()
  print (paste ("SCORE GAME with ", Type_names[type + 1]))
  for (exp_id in 1:num_exp) {
    
    
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      
      cur_game <- score_game
      for (user_id in 1:6) {
            for (partner_id in 1:6) {
              if (user_id != partner_id) {
                send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                
                for (period in 2:5) {
                  if (types[period] == type) {
                    sends <- c(sends, send_proportion[period])
                    partner_trusts <- c(partner_trusts, partner_trust_score[period])
                    my_trusts <- c(my_trusts, my_trust_score[period])
                    subject_ids <- c(subject_ids, user_id + (exp_id-1) * num_users)
                    round_numbers <- c(round_numbers, period)
                  }
                }
                
              }          
            }
            
          }
      }
      
      l_model <- lm (sends ~ as.factor(subject_ids) + my_trusts + partner_trusts + round_numbers)
      print (summary (l_model))
}
```

```{r,echo=FALSE}
for (type in 0:1) {
  sends <- c()
  subject_ids <- c()
  my_trusts <- c()
  partner_trusts <- c()
  round_numbers <- c()
  print (paste ("COMBINE GAME with ", Type_names[type + 1]))
  for (exp_id in 1:num_exp) {
    
    
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      
      cur_game <- combine_game
      for (user_id in 1:6) {
            for (partner_id in 1:6) {
              if (user_id != partner_id) {
                send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
                partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
                my_trust_score <- cur_game[cur_game$Subject == partner_id & cur_game$Partner == user_id,]$showing_trust_score
                types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
                
                for (period in 2:5) {
                  if (types[period] == type) {
                    sends <- c(sends, send_proportion[period])
                    partner_trusts <- c(partner_trusts, partner_trust_score[period])
                    my_trusts <- c(my_trusts, my_trust_score[period])
                    subject_ids <- c(subject_ids, user_id + (exp_id-1) * num_users)
                    round_numbers <- c(round_numbers, period)
                  }
                }
                
              }          
            }
            
          }
      }
      
      l_model <- lm (sends ~ as.factor(subject_ids) + my_trusts + partner_trusts + round_numbers)
      print (summary (l_model))
}
```

\pagebreak

##Predict average send proportion

We applied linear regression on reputation score to see if the reputation score should be used instead of trust score.

Reputation score = average of previous send proportion

Dependent measure: average send proportion by user (eliminate case 0 for receiver)

```{r, echo = FALSE}
  for (type in 0:1) {
    df_simple <- data.frame ("id" = as.numeric(),
                             "trust_value" = as.numeric(),
                             "RelSend" = as.numeric(),
                             "AbsSend" = as.numeric(),
                             "response_time" = as.numeric(),
                             "game_pos" = as.numeric(),
                             "peak_end_trust" = as.numeric(),
                             "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric()
                             )
    df_id <- data.frame ("id" = as.numeric(),
                         "trust_value" = as.numeric(),
                         "RelSend" = as.numeric(),
                         "AbsSend" = as.numeric(),
                         "response_time" = as.numeric(),
                         "game_pos" = as.numeric(),
                         "peak_end_trust" = as.numeric(),
                         "AbsPartnerSend" = as.numeric(),
                          "my_trust_value" = as.numeric(),
                         "PartnerRelSend" = as.numeric(),
                          "my_reputation" = as.numeric(),
                          "partner_reputation" = as.numeric()
                         )
    df_score <- data.frame ("id" = as.numeric(),
                            "trust_value" = as.numeric(),
                            "RelSend" = as.numeric(),
                            "AbsSend" = as.numeric(),
                            "response_time" = as.numeric(),
                            "game_pos" = as.numeric(),
                            "peak_end_trust" = as.numeric(),
                            "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                            "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric()
                            )
    df_combine <- data.frame ("id" = as.numeric(),
                              "trust_value" = as.numeric(),
                              "RelSend" = as.numeric(),
                              "AbsSend" = as.numeric(),
                              "response_time" = as.numeric(),
                              "game_pos" = as.numeric(),
                              "peak_end_trust" = as.numeric(),
                              "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric()
                             )
    for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      cur_game = simple_game
      for (user_id in 1:num_users) {
        cur_reputation = 0.5
        partner_reputation = 0.5
        for (i in 1:nrow(cur_game)) {
          if (cur_game[i,]$Subject == user_id) {
            if (cur_game[i,]$my_send_proportional >= 0 & cur_game[i,]$Type == type) {
              my_trust_score = cur_game[cur_game$Type == (1  - type) & cur_game$Partner == user_id 
                                        & cur_game$Period == cur_game[i,]$Period,]$showing_trust_score
              if (cur_game[i,]$Period %% 25 > 1) {
                
                # calculate my reputation
                cur_period = cur_game[i,]$Period
                cur_reputation = mean (cur_game[cur_game$Subject == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan(cur_reputation)) {
                  cur_reputation = 0.5
                }
                
                # calculate partner reputation
                partner_reputation = mean (cur_game[cur_game$Partner == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan (partner_reputation)) {
                  partner_reputation = 0.5
                }
                
              } else {
                cur_reputation = 0.5
                partner_reputation = 0.5
              }
              new_row = c((exp_id - 1) * num_users + user_id,
                    (cur_game[i,]$showing_trust_score),
                    (cur_game[i,]$my_send_proportional),
                    (cur_game[i,]$Contribution),
                    (cur_game[i,]$response_time),
                    SIMPLE_GAME_ORDERS[exp_id],
                     (calc_peak_end_trust(cur_game[i,]$showing_trust_score)),
                    (cur_game[i,]$PartnerDecision),
                    my_trust_score,
                    (cur_game[i,]$send_proportion),
                    cur_reputation,
                    partner_reputation
                    )
                  df_simple[nrow(df_simple) + 1,] <- new_row
            }
          }
        }
      }
        
      cur_game = id_game
      for (user_id in 1:num_users) {
        cur_reputation = 0.5
        partner_reputation = 0.5
        for (i in 1:nrow(cur_game)) {
          if (cur_game[i,]$Subject == user_id) {
            if (cur_game[i,]$my_send_proportional >= 0 & cur_game[i,]$Type == type) {
              my_trust_score = cur_game[cur_game$Type == (1  - type) & cur_game$Partner == user_id 
                                        & cur_game$Period == cur_game[i,]$Period,]$showing_trust_score
              
              if (cur_game[i,]$Period %% 25 > 1) {
                
                # calculate my reputation
                cur_period = cur_game[i,]$Period
                cur_reputation = mean (cur_game[cur_game$Subject == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan(cur_reputation)) {
                  cur_reputation = 0.5
                }
                
                # calculate partner reputation
                partner_reputation = mean (cur_game[cur_game$Partner == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan (partner_reputation)) {
                  partner_reputation = 0.5
                }
                
              } else {
                cur_reputation = 0.5
                partner_reputation = 0.5
              }
              
              new_row = c((exp_id - 1) * num_users + user_id,
                    (cur_game[i,]$showing_trust_score),
                    (cur_game[i,]$my_send_proportional),
                    (cur_game[i,]$Contribution),
                    (cur_game[i,]$response_time),
                    SIMPLE_GAME_ORDERS[exp_id],
                     (calc_peak_end_trust(cur_game[i,]$showing_trust_score)),
                    (cur_game[i,]$PartnerDecision),
                    my_trust_score,
                    (cur_game[i,]$send_proportion),
                    cur_reputation,
                    partner_reputation
                    )
                  df_id[nrow(df_id) + 1,] <- new_row
            }
          }
        }
      }
        
      cur_game = score_game
      for (user_id in 1:num_users) {
        cur_reputation = 0.5
        partner_reputation = 0.5
        for (i in 1:nrow(cur_game)) {
          if (cur_game[i,]$Subject == user_id) {
            if (cur_game[i,]$my_send_proportional >= 0 & cur_game[i,]$Type == type) {
              my_trust_score = cur_game[cur_game$Type == (1  - type) & cur_game$Partner == user_id 
                                        & cur_game$Period == cur_game[i,]$Period,]$showing_trust_score
              if (cur_game[i,]$Period %% 25 > 1) {
                
                # calculate my reputation
                cur_period = cur_game[i,]$Period
                cur_reputation = mean (cur_game[cur_game$Subject == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan(cur_reputation)) {
                  cur_reputation = 0.5
                }
                
                # calculate partner reputation
                partner_reputation = mean (cur_game[cur_game$Partner == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan (partner_reputation)) {
                  partner_reputation = 0.5
                }
                
              } else {
                cur_reputation = 0.5
                partner_reputation = 0.5
              }
              new_row = c((exp_id - 1) * num_users + user_id,
                    (cur_game[i,]$showing_trust_score),
                    (cur_game[i,]$my_send_proportional),
                    (cur_game[i,]$Contribution),
                    (cur_game[i,]$response_time),
                    SIMPLE_GAME_ORDERS[exp_id],
                     (calc_peak_end_trust(cur_game[i,]$showing_trust_score)),
                    (cur_game[i,]$PartnerDecision),
                    my_trust_score,
                    (cur_game[i,]$send_proportion),
                    cur_reputation,
                    partner_reputation
                    )
                  df_score[nrow(df_score) + 1,] <- new_row
            }
          }
        }
      }
        
      cur_game = combine_game
      for (user_id in 1:num_users) {
        cur_reputation = 0.5
        partner_reputation = 0.5
        for (i in 1:nrow(cur_game)) {
          if (cur_game[i,]$Subject == user_id) {
            if (cur_game[i,]$my_send_proportional >= 0 & cur_game[i,]$Type == type) {
              my_trust_score = cur_game[cur_game$Type == (1  - type) & cur_game$Partner == user_id 
                                        & cur_game$Period == cur_game[i,]$Period,]$showing_trust_score
              if (cur_game[i,]$Period %% 25 > 1) {
                
                # calculate my reputation
                cur_period = cur_game[i,]$Period
                cur_reputation = mean (cur_game[cur_game$Subject == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan(cur_reputation)) {
                  cur_reputation = 0.5
                }
                
                # calculate partner reputation
                partner_reputation = mean (cur_game[cur_game$Partner == user_id 
                                                & cur_game$Period < cur_period
                                                & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                if (is.nan (partner_reputation)) {
                  partner_reputation = 0.5
                }
                
              } else {
                cur_reputation = 0.5
                partner_reputation = 0.5
              }
              
              new_row = c((exp_id - 1) * num_users + user_id,
                    (cur_game[i,]$showing_trust_score),
                    (cur_game[i,]$my_send_proportional),
                    (cur_game[i,]$Contribution),
                    (cur_game[i,]$response_time),
                    SIMPLE_GAME_ORDERS[exp_id],
                     (calc_peak_end_trust(cur_game[i,]$showing_trust_score)),
                    (cur_game[i,]$PartnerDecision),
                    my_trust_score,
                    (cur_game[i,]$send_proportion),
                    cur_reputation,
                    partner_reputation
                    )
                  df_combine[nrow(df_combine) + 1,] <- new_row
            }
          }
        }
      }
      
    }
        
    # Linear regression
    print (paste (("Linear regression of relative sending on reputation value of Simple Game for type: "), Type_names [ type + 1]))
    
    x_simple <- aggregate(df_simple[,c(3,2,11,8,9,12)], list(df_simple$id), mean, na.rm = TRUE)
    # colnames(x_simple) <- c("grp","RelSend","my_reputation","trust_value","AbsPartnerSend","my_trust_value")
    if (type == 0) {
      print (summary (lm (RelSend ~ my_reputation  + partner_reputation, data = x_simple)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value, data = x_simple)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value, data = x_simple)))
    } else {
      print (summary (lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data = x_simple)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = x_simple)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value + AbsPartnerSend, data = x_simple)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value * AbsPartnerSend, data = x_simple)))
    }
    
    # print ("Test the interaction")
    # print (summary (lm (RelSend ~ my_trust_value + trust_value + trust_value * my_trust_value, data = x_simple)))
    # 
    # print ("Test the interaction variable alone")
    # print (summary (lm (RelSend ~ my_trust_value , data = x_simple)))
    # x_simple$combine_trust <- x_simple$trust_value * x_simple$my_trust_value
    # print (summary (lm (RelSend ~ combine_trust, data = x_simple)))
    
    
    print (paste (("Linear regression of relative sending on reputation value of ID Game for type: "), Type_names [ type + 1]))
    
    x_id <- aggregate(df_id[,c(3,2,11,8,9,12)], list(df_id$id), mean, na.rm = TRUE)
    # colnames(x_id) <- c("grp","RelSend","my_reputation","trust_value","AbsPartnerSend","my_trust_value")
    if (type == 0) {
      print (summary (lm (RelSend ~ my_reputation + partner_reputation, data = x_id)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value, data = x_id)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value, data = x_id)))
    } else {
      print (summary (lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data = x_id)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = x_id)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value + AbsPartnerSend, data = x_id)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value * AbsPartnerSend, data = x_id)))
    }
    
    # print ("Test the interaction")
    # print (summary (lm (RelSend ~ my_trust_value + trust_value + trust_value * my_trust_value, data = x_id)))
    # 
    # print ("Test the interaction variable alone")
    # print (summary (lm (RelSend ~ my_trust_value , data = x_id)))
    # x_id$combine_trust <- x_id$trust_value * x_id$my_trust_value
    # print (summary (lm (RelSend ~ combine_trust, data = x_id)))
    
    print (paste (("Linear regression of relative sending on reputation value of Score Game for type: "), Type_names [ type + 1]))
    
    x_score <- aggregate(df_score[,c(3,2,11,8,9,12)], list(df_score$id), mean, na.rm = TRUE)
    # colnames(x_score) <- c("grp","RelSend","my_reputation","trust_value","AbsPartnerSend","my_trust_value")
    if (type == 0) {
      print (summary (lm (RelSend ~ my_reputation +  partner_reputation, data = x_score)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value, data = x_score)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value, data = x_score)))
    } else {
      print (summary (lm (RelSend ~ my_reputation +  partner_reputation + AbsPartnerSend, data = x_score)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = x_score)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value + AbsPartnerSend, data = x_score)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value * AbsPartnerSend, data = x_score)))
    }
    
    # print ("Test the interaction")
    # print (summary (lm (RelSend ~ my_trust_value + trust_value + trust_value * my_trust_value, data = x_score)))
    # 
    # print ("Test the interaction variable alone")
    # print (summary (lm (RelSend ~ my_trust_value , data = x_score)))
    # x_score$combine_trust <- x_score$trust_value * x_score$my_trust_value
    # print (summary (lm (RelSend ~ combine_trust, data = x_score)))
    
    
    print (paste (("Linear regression of relative sending on reputation value of Combine Game for type: "), Type_names [ type + 1]))
    
    x_combine <- aggregate(df_combine[,c(3,2,11,8,9,12)], list(df_combine$id), mean, na.rm = TRUE)
    # colnames(x_combine) <- c("grp","RelSend","my_reputation","trust_value","AbsPartnerSend","my_trust_value")
    if (type == 0) {
      print (summary (lm (RelSend ~ my_reputation  + partner_reputation, data = x_combine)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value , data = x_combine)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value , data = x_combine)))
    } else {
      print (summary (lm (RelSend ~ my_reputation  + partner_reputation + AbsPartnerSend, data = x_combine)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = x_combine)))
      print (summary (lm (RelSend ~ my_trust_value * trust_value + AbsPartnerSend, data = x_combine)))
      print (summary (lm (RelSend ~ my_trust_value + trust_value * AbsPartnerSend, data = x_combine)))
    }
    
    # print ("Test the interaction")
    # print (summary (lm (RelSend ~ my_trust_value + trust_value + trust_value * my_trust_value, data = x_combine)))
    # 
    # print ("Test the interaction variable alone")
    # print (summary (lm (RelSend ~ my_trust_value , data = x_combine)))
    # x_combine$combine_trust <- x_combine$trust_value * x_combine$my_trust_value
    # print (summary (lm (RelSend ~ combine_trust, data = x_combine)))
    
  }
  
```

\pagebreak

# Analyze by individual trial rather than average value

```{r, echo=FALSE}
# utility function
prepare_individual_behavior_data <- function (type = 0) {
  df_simple <- data.frame ("id" = as.numeric(),
                             "trust_value" = as.numeric(),
                             "RelSend" = as.numeric(),
                             "AbsSend" = as.numeric(),
                             "response_time" = as.numeric(),
                             "game_pos" = as.numeric(),
                             "peak_end_trust" = as.numeric(),
                             "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric(),
                             "round_number_with_partner" = as.numeric(),  # indicate round number when play with a partner (1-5)
                             "partner_id" = as.numeric(),
                            "period" = as.numeric()   # indicate the period in this game (1-25)
                             )
    df_id <- data.frame ("id" = as.numeric(),
                         "trust_value" = as.numeric(),
                         "RelSend" = as.numeric(),
                         "AbsSend" = as.numeric(),
                         "response_time" = as.numeric(),
                         "game_pos" = as.numeric(),
                         "peak_end_trust" = as.numeric(),
                         "AbsPartnerSend" = as.numeric(),
                          "my_trust_value" = as.numeric(),
                         "PartnerRelSend" = as.numeric(),
                          "my_reputation" = as.numeric(),
                          "partner_reputation" = as.numeric(),
                          "round_number_with_partner" = as.numeric(),
                         "partner_id" = as.numeric(),
                            "period" = as.numeric()
                         )
    df_score <- data.frame ("id" = as.numeric(),
                            "trust_value" = as.numeric(),
                            "RelSend" = as.numeric(),
                            "AbsSend" = as.numeric(),
                            "response_time" = as.numeric(),
                            "game_pos" = as.numeric(),
                            "peak_end_trust" = as.numeric(),
                            "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                            "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric(),
                             "round_number_with_partner" = as.numeric(),
                            "partner_id" = as.numeric(),
                            "period" = as.numeric()
                            )
    df_combine <- data.frame ("id" = as.numeric(),
                              "trust_value" = as.numeric(),
                              "RelSend" = as.numeric(),
                              "AbsSend" = as.numeric(),
                              "response_time" = as.numeric(),
                              "game_pos" = as.numeric(),
                              "peak_end_trust" = as.numeric(),
                              "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric(),
                             "round_number_with_partner" = as.numeric(),
                             "partner_id" = as.numeric(),
                            "period" = as.numeric()
                             )
    for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      all_game <- list (simple_game, id_game, score_game, combine_game)
      
      for (k in 1:num_games) {
        cur_game <- as.data.frame(all_game[k])
        round_number_with_partners = c(0,0,0,0,0,0)
        for (user_id in 1:num_users) {
          cur_reputation = 0.5
          partner_reputation = 0.5
          for (i in 1:nrow(cur_game)) {
            if (cur_game[i,]$Subject == user_id) {
              partner_id <- cur_game[i,]$Partner
              round_number_with_partners[partner_id] <- round_number_with_partners[partner_id] + 1
              if (cur_game[i,]$my_send_proportional >= 0 & cur_game[i,]$Type == type) {
                my_trust_score = cur_game[cur_game$Type == (1  - type) & cur_game$Partner == user_id 
                                          & cur_game$Period == cur_game[i,]$Period,]$showing_trust_score
                if (cur_game[i,]$Period %% 25 > 1 | cur_game[i,]$Period %% 25 == 0) {
                  # calculate my reputation
                  cur_period = cur_game[i,]$Period
                  cur_reputation = mean (cur_game[cur_game$Subject == user_id 
                                                  & cur_game$Period < cur_period
                                                  & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                  if (is.nan(cur_reputation)) {
                    cur_reputation = 0.5
                  }
                  
                  # calculate partner reputation
                  partner_id <- cur_game[i,]$Partner
                  partner_reputation = mean (cur_game[cur_game$Subject == partner_id
                                                  & cur_game$Period < cur_period
                                                  & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                  if (is.nan (partner_reputation)) {
                    partner_reputation = 0.5
                  }
                  
                } else {
                  cur_reputation = 0.5
                  partner_reputation = 0.5
                }
                new_row = c((exp_id - 1) * num_users + user_id,
                      (cur_game[i,]$showing_trust_score),
                      (cur_game[i,]$my_send_proportional),
                      (cur_game[i,]$Contribution),
                      (cur_game[i,]$response_time),
                      SIMPLE_GAME_ORDERS[exp_id],
                       (calc_peak_end_trust(cur_game[i,]$showing_trust_score)),
                      (cur_game[i,]$PartnerDecision),
                      my_trust_score,
                      (cur_game[i,]$send_proportion),
                      cur_reputation,
                      partner_reputation,
                      ifelse (round_number_with_partners[partner_id] %% 5 == 0,5,round_number_with_partners[partner_id] %% 5),
                      ifelse(partner_id < user_id, partner_id, partner_id - 1),
                      cur_game[i,]$Period
                      )
                if (k == 1) {
                    df_simple[nrow(df_simple) + 1,] <- new_row
                } else if (k == 2) {
                  df_id[nrow(df_id) + 1,] <- new_row
                } else if (k == 3) {
                  df_score[nrow(df_score) + 1,] <- new_row
                } else if (k == 4) {
                  df_combine[nrow(df_combine) + 1,] <- new_row
                }
              }
            }
          }
        }
      }
    }
    all_df <- list (df_simple, df_id, df_score, df_combine)
    all_df
}
```

```{r, echo=FALSE}
# Prepare two datasets
all_df_sender <- prepare_individual_behavior_data(type = 0)
all_df_receiver <- prepare_individual_behavior_data(type = 1)
```

##Trust score over time & Chi-square on frequency of sending proportion by game

Date: Tue 13-Jun-2017
Test the amound sent based on trust value and amount received (if any) using individual but not average sending proportion

Update on Thu 15-Jun-2017

```{r, echo = FALSE}
  for (type in 0:1) {
    
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    
    #create table for chi-square
    print (paste("Number of sending 0.0 as:", Type_names[type+1]))
    x <- rep (0,4)
    for (k in 1:num_games) {
      cur_game <-as.data.frame(all_df[k])
      print(paste(GAME_NAMES[k],":", nrow(cur_game[cur_game$RelSend == 0,])))
      x[k] <- nrow(cur_game[cur_game$RelSend == 0,])
    }
    x <- matrix (x, byrow = TRUE, 2, 2)
    print (x)
    print (chisq.test(x))
    
    print ("Update on Fri 16-Jun-2017: due to the fact that chisq is tested on dependent data, we switch to logistic regression to check if sending 0 is really different between games")
    df0 <- data.frame("id" = as.numeric(),
                      "send0" = as.numeric(),
                      "show_trust" = as.numeric(),
                      "show_id" = as.numeric()
                      )
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      id <- cur_df$id
      send0 <- ifelse(cur_df$RelSend == 0, 1, 0)
      show_trust <- rep(ifelse(k > 2, 1, 0), length(send0))
      show_id <- rep(ifelse (k %% 2 == 0, 1, 0), length (send0))
      df0 <- rbind (df0,cbind(id, send0, show_trust, show_id))
    }
    df0 <- as.data.frame(df0)
    df0$id <- as.factor(df0$id)
    df0$send0 <- as.logical(df0$send0)
    df0$show_trust <- as.logical (df0$show_trust)
    df0$show_id <- as.logical (df0$show_id)
    
    g1 <- glm(send0 ~ id + show_trust+ show_id + show_trust * show_id,family=binomial(link='logit'),data=df0)
    print (summary (g1))
    
    print (paste("Number of sending >= 0.7 as:", Type_names[type+1]))
    x <- rep (0,4)
    for (k in 1:num_games) {
      cur_game <-as.data.frame(all_df[k])
      print(paste(GAME_NAMES[k],":", nrow(cur_game[cur_game$RelSend >= 0.7,])))
      x[k] <- nrow(cur_game[cur_game$RelSend >= 0.7,])
    }
    x <- matrix (x, byrow = TRUE, 2, 2)
    print (x)
    print (chisq.test(x))
    
    # print ("Update on Fri 16-Jun-2017: due to the fact that chisq is tested on dependent data, we switch to logistic regression to check if sending 0 is really different between games")
    df0 <- data.frame("id" = as.numeric(),
                      "send0" = as.numeric(),
                      "show_trust" = as.numeric(),
                      "show_id" = as.numeric()
                      )
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      id <- cur_df$id
      send0 <- ifelse(cur_df$RelSend >= 0.7, 1, 0)
      show_trust <- rep(ifelse(k > 2, 1, 0), length(send0))
      show_id <- rep(ifelse (k %% 2 == 0, 1, 0), length (send0))
      df0 <- rbind (df0,cbind(id, send0, show_trust, show_id))
    }
    df0 <- as.data.frame(df0)
    df0$id <- as.factor(df0$id)
    df0$send0 <- as.logical(df0$send0)
    df0$show_trust <- as.logical (df0$show_trust)
    df0$show_id <- as.logical (df0$show_id)
    
    g1 <- glm(send0 ~ id + show_trust+ show_id + show_trust * show_id,family=binomial(link='logit'),data=df0)
    print (summary (g1))
    
    print (paste("Number of sending 1.0 (maximum) as:", Type_names[type+1]))
    x <- rep (0,4)
    for (k in 1:num_games) {
      cur_game <-as.data.frame(all_df[k])
      print(paste(GAME_NAMES[k],":", nrow(cur_game[cur_game$RelSend == 1.0,])))
      x[k] <- nrow(cur_game[cur_game$RelSend >= 0.7,])
    }
    x <- matrix (x, byrow = TRUE, 2, 2)
    print (x)
    print (chisq.test(x))
    
    print ("Update on Fri 16-Jun-2017: due to the fact that chisq is tested on dependent data, we switch to logistic regression to check if sending 0 is really different between games")
    df0 <- data.frame("id" = as.numeric(),
                      "send0" = as.numeric(),
                      "show_trust" = as.numeric(),
                      "show_id" = as.numeric()
                      )
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      id <- cur_df$id
      send0 <- ifelse(cur_df$RelSend == 1.0, 1, 0)
      show_trust <- rep(ifelse(k > 2, 1, 0), length(send0))
      show_id <- rep(ifelse (k %% 2 == 0, 1, 0), length (send0))
      df0 <- rbind (df0,cbind(id, send0, show_trust, show_id))
    }
    df0 <- as.data.frame(df0)
    df0$id <- as.factor(df0$id)
    df0$send0 <- as.logical(df0$send0)
    df0$show_trust <- as.logical (df0$show_trust)
    df0$show_id <- as.logical (df0$show_id)
    
    g1 <- glm(send0 ~ id + show_trust+ show_id + show_trust * show_id,family=binomial(link='logit'),data=df0)
    print (summary (g1))
    
    # for (k in 1:num_games) {
    #   cur_game <- as.data.frame(all_df[k])
    #   print (paste("Analyze: ", Type_names[type+1], "for game:", GAME_NAMES[k]))
    #   # print ("Residual on subject then multiple regression")
    #   cur_game$id <- as.factor (cur_game$id)
    #   cur_game <- cur_game [cur_game$my_trust_value != 0.5,]
    #   cur_game$resid <- residuals(lm(RelSend~id, data=cur_game))
    #   print (cor.test(cur_game$my_reputation, cur_game$my_trust_value))
    #   print (cor.test(cur_game$partner_reputation, cur_game$trust_value))
    #   if (type == 0) {
    #     # l1 <- lm (RelSend ~ id + my_trust_value + trust_value, data = cur_game)
    #     l1 <- lm (RelSend ~ my_trust_value + my_reputation + trust_value + partner_reputation, data=cur_game)
    #     print (summary (l1))
    #     # print (Anova(l1, type = "III"))
    #   }
    #   else if (type == 1) {
    #     # l1 <- lm (RelSend ~ id + my_trust_value + trust_value, data = cur_game)
    #     l1 <- lm (RelSend ~ my_trust_value + my_reputation + trust_value + partner_reputation + AbsPartnerSend, data = cur_game)
    #     print (summary (l1))
    #     # print (Anova(l1, type = "III"))
    #   }
    # }
    
    # plot trust score over time
    plot(1, type="n", xlim=c(0, 10), ylim=c(0, 1), ylab = "Trust value", xlab = "Round number", main = paste(Type_names[type+1]))
    for (k in 1:num_games) {
      cur_game <- as.data.frame(all_df[k])
      trusts <- c()
      rounds <- c()
      subject_ids <- c()
      for (i in 2:5) {
        trusts <- c(trusts, cur_game[cur_game$round_number_with_partner == i,]$my_trust_value)
        rounds <- c(rounds, rep(i, length(cur_game[cur_game$round_number_with_partner == i,]$my_trust_value)))
        subject_ids <- c (subject_ids, cur_game[cur_game$round_number_with_partner == i,]$id)
      }
      
      
      ldf <- as.data.frame(cbind (subject_ids, trusts, rounds))
      agg_trust <- aggregate(ldf$trusts, list(ldf$rounds), mean)
      lines (agg_trust, col = col_list[k], lty = k, type = "o")
      ldf$subject_ids <- as.factor(ldf$subject_ids)
      ldf$resid <- resid(lm(trusts~subject_ids, data = ldf))
      ldf.lm <- lm (resid ~ rounds, data = ldf)
      print (paste("Regression of resid trust score on round after elimiate subject effect of game:", GAME_NAMES[k], Type_names[type+1]))
      print (summary (ldf.lm))
    }
    legend(x=6,y=1,lty=1:4,col = col_list[1:4], GAME_NAMES)
  }
  
```

\pagebreak

##Send proportion overtime (plot)

Date: Wed 21-Jun-2017

We plot the send proportion by role over time in each game to see how people send more or less by time in each game

For each partner (5 rounds in total)

```{r, echo=FALSE}
require(tools)
plot_std_error <- function (x_values, y_values, std_errors, color = "black", lty_value = 1, lwd_value = 1, bar_width=0.1) {
  # assertError(length(x_values) == length(y_values))
  # assertError(length(x_values) == length(std_errors))
  n = length (x_values)
  for (i in 1:n) {
    segments(col = color,lty = lty_value,lwd=lwd_value,
             x0 = x_values[i],
             y0 = y_values[i] - std_errors[i],
             x1 = x_values[i],
             y1 = y_values[i] + std_errors[i])
    segments(col = color,lty = 1,lwd=lwd_value,
             x0 = x_values[i] - bar_width,
             y0 = y_values[i] - std_errors[i],
             x1 = x_values[i] + bar_width,
             y1 = y_values[i] - std_errors[i])
    segments(col = color,lty = 1,lwd=lwd_value,
             x0 = x_values[i] - bar_width,
             y0 = y_values[i] + std_errors[i],
             x1 = x_values[i] + bar_width,
             y1 = y_values[i] + std_errors[i])
  }
}

for (type in 0:1) {
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    print (paste("Type:", Type_names[type+1]))
    plot(1, type="n", xlab="Round number", ylab="Send proportion", xlim=c(0, 6), ylim=c(0, 1))
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      sends <- c()
      std_errors <- c()
      
      # Update: 22 - Jun - 2017
      # perform regression to see if there is change overtime
      change_df <- data.frame("subject_id" =as.numeric(),
                              "send_proportion" = as.numeric(),
                              "round_number" = as.numeric()
                              )
      for (cur_round in 1:5) {
        this_round <- cur_df[cur_df$round_number_with_partner == cur_round,]
        # this_send <- this_round[this_round$RelSend >= 0,]$RelSend
        
        # get subject id, send proportion and round number only
        this_round <- this_round[,c(1,3,13)]
        colnames(this_round) <- colnames(change_df)
        # change_df <- rbind(change_df, this_round)
        
        # regression
        
        # change_df$subject_id <- as.factor(change_df$subject_id)
        for (subject_id in unique(this_round$subject_id)) {
            new_row <- c(subject_id,
                         mean (this_round[this_round$subject_id == subject_id 
                                         & this_round$round_number == cur_round,]$send_proportion),
                         cur_round)
            change_df [nrow(change_df) + 1,] <- new_row
        }
        sends <- c(sends, mean (change_df[change_df$round_number == cur_round,]$send_proportion))
        std_errors <- c(std_errors, plotrix::std.error(change_df[change_df$round_number == cur_round,]$send_proportion))
      }
      x_vals <- (1:5+(k-2)*0.05)
      lines (y=sends, x=x_vals, col = col_list[k], type = "o", lty = k)
      plot_std_error(x_values = x_vals, y_values = sends, lty_value = k, lwd_value = 1, std_errors = std_errors, color = col_list[k], bar_width = 0.025)
      
      change_df$resid <- resid(lm(send_proportion ~ subject_id, data = change_df))
      print (paste("Regression to see change over time of send proportion on game:", GAME_NAMES[k]))
      l1 <- lm (resid ~ round_number, data = change_df)
      print (summary (l1))
      
    }
    legend(x=1,y=1,lty=1:4, col = col_list[1:4], GAME_NAMES, pch = rep(1,4))
    cat("\n\n\n")
}
```

\pagebreak
For all 25 rounds (so no distinguish between partners)

```{r, echo=FALSE}
for (type in 0:1) {
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    print (paste("Type:", Type_names[type+1]))
    plot(1, type="n", xlab="Round number", ylab="Send proportion", xlim=c(0, 25), ylim=c(0, 1))
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      sends <- c()
      for (cur_round in 1:25) {
        cur_df$cur_period = ifelse (cur_df$period %% 25 == 0, 25, cur_df$period %% 25)
        this_round <- cur_df[cur_df$cur_period == cur_round,]
        this_send <- mean (this_round[this_round$RelSend >= 0,]$RelSend)
        sends <- c(sends, this_send)
      }
      lines (y=sends, x=1:25, col = col_list[k], type = "o", lty = k)
    }
    legend(x=1,y=1,lty=1:4, col = col_list[1:4], GAME_NAMES, pch = rep(1,4))
    cat("\n\n\n")
}
```

\pagebreak

## Study the scatter in round 5 in each game
Date: Fri 23-Jun-2017

We realized that the prediction model with reputation is better than the model with trust in Receiver, Round 5, Score Game.

My hypothesis is in Score Game, people act more constantly, therefore reputation is good.

I will check the scatter of each game, Receiver, Round 5 to see.

```{r, echo=FALSE}
for (type in 0:1) {
  all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
  df_rsp <- as.data.frame(all_df[1])
  df_rd <- as.data.frame(all_df[2])
  df_rs <- as.data.frame(all_df[3])
  df_rc <- as.data.frame(all_df[4])
  
  round_number <- 4
  
  df_rsp4 <- df_rsp[df_rsp$round_number_with_partner == round_number,]
  df_rd4 <- df_rd[df_rd$round_number_with_partner == round_number,]
  df_rs4 <- df_rs[df_rs$round_number_with_partner == round_number,]
  df_rc4 <- df_rc[df_rc$round_number_with_partner == round_number,]
  
  df4 <- list (df_rsp4, df_rd4, df_rs4, df_rc4)
  
  round_number <- 5
  
  df_rsp5 <- df_rsp[df_rsp$round_number_with_partner == round_number,]
  df_rd5 <- df_rd[df_rd$round_number_with_partner == round_number,]
  df_rs5 <- df_rs[df_rs$round_number_with_partner == round_number,]
  df_rc5 <- df_rc[df_rc$round_number_with_partner == round_number,]
  
  df5 <- list (df_rsp5, df_rd5, df_rs5, df_rc5)
  
  
  
  # commented the below code because the difference is not significant
  # for (k in 1:num_games) {
  #   cur_df5 <- as.data.frame(df5[k])
  #   print (paste("Type:", Type_names[type+1]))
  #   print (paste("Process game:", GAME_NAMES[k]))
  #   print (paste("Round:", round_number))
  #   plot (cur_df5$RelSend ~ cur_df5$id, ylim = c(0,1), 
  #         xlab = "Subject ID", ylab = "Send proportion",
  #         main = GAME_NAMES[k])
  #   
  #   diffs <- c() # contain the difference between max and min send proportion for each user
  #   for (user_id in 1:30) {
  #     if (length(cur_df5[cur_df5$id == user_id,]$RelSend) > 1) { 
  #       diff <- max (cur_df5[cur_df5$id == user_id,]$RelSend) - min ((cur_df5[cur_df5$id == user_id,]$RelSend))
  #       diffs <- c(diffs, diff)
  #     }
  #   }
  #   print (paste ("Average diff: ", mean (diffs[diffs>0])))
  # }
}
```

We checked the difference between send proportion in round 4 and round 5 for each pair of users to see in which game users change their behavior with same partner in last 2 rounds most. In this analysis there is only for 1 role.

```{r,echo=FALSE}
for (k in 1:num_games) {
  # cur_df <- as.data.frame(all_df[k])
  cur_df <- rbind (as.data.frame(all_df_sender[k]), as.data.frame(all_df_receiver[k]))
  
  print (paste("Type:", Type_names[type+1]))
  print (paste("Process game:", GAME_NAMES[k]))
  print ("Study the different in send proportion between last 2 rounds of same sender-receiver pairs")
  
  diffs <- c()
  for (user_id in 1:30) {
    for (partner_id in 1:5) {
      this_pair <- cur_df[cur_df$id == user_id 
                      & cur_df$partner_id == partner_id,]
      if (nrow(this_pair) >= 2) {
        # N = length (sends)
        
        send1 <- this_pair[this_pair$round_number_with_partner 
                           == 1,]$RelSend
        send2 <- this_pair[this_pair$round_number_with_partner 
                           == 5,]$RelSend
        # send1 <- min (this_pair$RelSend)
        # send2 <- max (this_pair$RelSend)
        diff <- send2 - send1
        diffs <- c(diffs, diff)
      }
    }
  }
  print (length (diffs))
  print (paste("Average diff:", mean (diffs)))
}
```

We plot the average send proportion of each user to each partner in each game

```{r,echo=FALSE}
for (k in 1:num_games) {
  # cur_df <- as.data.frame(all_df[k])
  cur_df <- rbind (as.data.frame(all_df_sender[k]), as.data.frame(all_df_receiver[k]))
  
  # print (paste("Type:", Type_names[type+1]))
  print (paste("Process game:", GAME_NAMES[k]))
  
  sends <- c()
  ids <- c()
  vars <- c()
  for (user_id in 1:30) {
    for (partner_id in 1:5) {
      this_pair <- cur_df[cur_df$id == user_id 
                      & cur_df$partner_id == partner_id,]
      if (nrow(this_pair) >= 1) {
        sends <- c(sends, mean (this_pair$RelSend))
        ids <- c(ids, user_id)
        vars <- c(vars, var (this_pair$RelSend))
        # print (var (this_pair$RelSend))
      }
    }
  }
  print (paste ("Mean of variance:", mean (vars[vars>0], na.rm = TRUE)))
  plot (sends ~ ids, ylim = c(0,1), ylab = "Send proportion", xlab= "Subject ID", main = GAME_NAMES[k])
}
```

### Scatter plot by role

Repeat the above analysis, but separate role

```{r,echo=FALSE}
for (type in 0:1) {
  all_df <- all_df_sender
  if (type == 1) {
    all_df <- all_df_receiver
  }
  for (k in 1:num_games) {
    cur_df <- as.data.frame(all_df[k])
    # cur_df <- rbind (as.data.frame(all_df_sender[k]), as.data.frame(all_df_receiver[k]))
    
    print (paste("Type:", Type_names[type+1]))
    print (paste("Process game:", GAME_NAMES[k]))
    
    sends <- c()
    ids <- c()
    vars <- c()
    for (user_id in 1:30) {
      for (partner_id in 1:5) {
        this_sends <- c()
        this_pair <- cur_df[cur_df$id == user_id 
                        & cur_df$partner_id == partner_id,]
        if (nrow(this_pair) >= 1) {
          this_sends <- c(this_sends, this_pair$RelSend)
          # print (var (this_pair$RelSend))
          sends <- c(sends, mean (this_sends))
          ids <- c(ids, user_id)
        }
      }
    }
    # print (paste ("Mean of variance:", mean (vars[vars > 0], na.rm = TRUE)))
    plot (sends ~ ids, ylim = c(0,1), ylab = "Send proportion", xlab= "Subject ID", main = paste(GAME_NAMES[k],":", Type_names[type+1]))
    
    send_df <- as.data.frame(cbind (ids, sends))
    vars <- aggregate(send_df$sends, list(send_df$ids), var)
    vars [is.na(vars)] <- 0
    # meanwhile focus on receiver only because the result for sender is already good
    if (type == 1) {
      high_ids <- vars[vars$x >= median(vars$x),]$Group.1
      low_ids <- vars[vars$x < median(vars$x),]$Group.1
      
      df_round5 <- cur_df [cur_df$round_number_with_partner == 5,]
      
      print ("Predict for all")
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = df_round5)))
      print (summary (lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data = df_round5)))
      
      print ("Predict for high variance")
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = df_round5[df_round5$id %in% high_ids,])))
      print (summary (lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data = df_round5[df_round5$id %in% high_ids,])))
      
      print ("Predict for low variance")
      # df_round5 <- cur_df [cur_df$round_number_with_partner == 5,]
      print (summary (lm (RelSend ~ my_trust_value + trust_value + AbsPartnerSend, data = df_round5[df_round5$id %in% low_ids,])))
      print (summary (lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data = df_round5[df_round5$id %in% low_ids,])))
    }
  }
}
```

\pagebreak

##Predict send proportion based on trust scores

### For round 4

```{r, echo = FALSE}
  for (type in 0:1) {
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    
    require(MASS) #for variable selection
    require(relaimpo)
    
    # for (k in 1:num_games) {
    #   for (round_number in 2:5) {
    #     cur_df <- as.data.frame(all_df[k])
    #     print (paste("Analyze: ", Type_names[type+1], "for game:", GAME_NAMES[k]))
    #     print (paste("ROUND:", round_number))
    #     # print ("Residual on subject then multiple regression")
    #     cur_df$id <- as.factor (cur_df$id)
    #     cur_df <- cur_df [cur_df$round_number_with_partner == round_number,]
    #     cur_df$resid <- residuals(lm(RelSend~id, data=cur_df))
    #     # print (cor.test(cur_df$resid, cur_df$my_trust_value))
    #     # print (cor.test(cur_df$resid, cur_df$my_reputation))
    #     # print (cor.test(cur_df$partner_reputation, cur_df$trust_value))
    #     if (type == 0) {
    #       # l1 <- lm (RelSend ~ id + my_trust_value + trust_value, data = cur_game)
    #       l1 <- lm (RelSend ~ my_trust_value + my_reputation + trust_value + partner_reputation, data=cur_df)
    #       print (summary (l1))
    #       # print (Anova(l1, type = "III"))
    #       
    #       #variable selection
    #       print ("variable selection")
    #       steps <- MASS::stepAIC(l1)
    #       print (steps$anova)
    #       
    #       # variable importance
    #       # relimp <- calc.relimp(l1,type=c("lmg","last","first","pratt"),rela=TRUE)
    #       # print (relimp)
    #     }
    #     else if (type == 1) {
    #       # l1 <- lm (RelSend ~ id + my_trust_value + trust_value, data = cur_game)
    #       l1 <- lm (RelSend ~ my_trust_value + my_reputation + trust_value + partner_reputation + AbsPartnerSend, data = cur_df)
    #       print (summary (l1))
    #       # print (Anova(l1, type = "III"))
    #       
    #       #variable selection
    #       print ("variable selection")
    #       steps <- MASS::stepAIC(l1)
    #       print (steps$anova)
    #       
    #       # variable importance
    #       # relimp <- calc.relimp(l1,type=c("lmg","last","first","pratt"),rela=TRUE)
    #       # print (relimp)
    #     }
    #   }
    # }
    
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      print (paste("Analyze: ", Type_names[type+1], "for game:", GAME_NAMES[k]))
      # print ("For  rounds 4 and 5")
      print ("For Round 4 only")
      # print ("Residual on subject then multiple regression")
      cur_df$id <- as.factor (cur_df$id)
      cur_df <- cur_df [cur_df$round_number_with_partner == 4,]
      cur_df$resid <- residuals(lm(RelSend~id, data=cur_df))
      cur_df$round_number_with_partner <- as.factor(cur_df$round_number_with_partner)
      cur_df$partner_id <- as.factor(cur_df$partner_id)
      # print (cor.test(cur_df$resid, cur_df$my_trust_value))
      # print (cor.test(cur_df$resid, cur_df$my_reputation))
      # print (cor.test(cur_df$partner_reputation, cur_df$trust_value))
      if (type == 0) {
        print ("Model without interaction")
        l1 <- lm (RelSend ~ my_trust_value + trust_value, data=cur_df)
        print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("---")
        
        print ("Model with interaction")
        # l1 <- lm (RelSend ~ id + my_trust_value + trust_value, data = cur_game)
        l1 <- lm (RelSend ~ my_trust_value + trust_value + my_trust_value * trust_value, data=cur_df)
        # l1 <- lm (resid ~ my_trust_value + trust_value + round_number_with_partner, data=cur_df)
        print (summary (l1))
        # l1 <- lm (RelSend ~ my_trust_value + trust_value + my_trust_value * trust_value, data=cur_df[cur_df$trust_value >= median(cur_df$trust_value),])
        # print (summary (l1))
        # l1 <- lm (RelSend ~ my_trust_value + trust_value + my_trust_value * trust_value, data=cur_df[cur_df$trust_value < median(cur_df$trust_value),])
        # print (summary (l1))
        # stepwise regression
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("Do prediction for reputation score")
        print (summary(lm (RelSend ~ my_reputation + partner_reputation, data=cur_df)))
      } else if (type == 1) {
        print ("Some basic information")
        print ("My trust")
        print (summary (cur_df$my_trust_value))
        print ("Partner trust")
        print (summary (cur_df$trust_value))
        print ("Partner Send")
        print (summary (cur_df$AbsPartnerSend))
        print ("Send back proportion")
        print (summary (cur_df$RelSend))
        
        print ("Model without interaction")
        l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend, data=cur_df)
        print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("---")
        
        print ("Model with interaction")
        # l1 <- lm (RelSend ~ id + my_trust_value + trust_value, data = cur_game)
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value*AbsPartnerSend, data = cur_df)
        l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend + trust_value * my_trust_value * AbsPartnerSend, data = cur_df)
        # l1 <- lm (resid ~ my_trust_value + trust_value + AbsPartnerSend + round_number_with_partner, data=cur_df)
        print (summary (l1))
        
        # # stepwise regression
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("Do prediction for reputation score")
        print (summary(lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data=cur_df)))
        
        # divide the dataset to study the interaction
        # date: Mon 19-Jun-2017
        # print ("Divide the dataset to study the interaction")
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend + trust_value * my_trust_value  + trust_value * AbsPartnerSend +
        #             my_trust_value * AbsPartnerSend,
        #           data=cur_df[cur_df$AbsPartnerSend >= median(cur_df$AbsPartnerSend),])
        # print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        # 
        # print ("--------")
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value,
        #           data=cur_df[cur_df$AbsPartnerSend >= median(cur_df$AbsPartnerSend),])
        # print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        # print ("_-----------------------------------")
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend + trust_value * my_trust_value  + trust_value * AbsPartnerSend +
        #             my_trust_value * AbsPartnerSend,
        #           data=cur_df[cur_df$AbsPartnerSend < median(cur_df$AbsPartnerSend),])
        # steps <- MASS::stepAIC(l1)
        # print (summary (l1))
        # print (steps$anova)
      }
    }
  }
  
```

\pagebreak

### For round 5

```{r, echo = FALSE}
  for (type in 0:1) {
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    
    require(MASS) #for variable selection
    require(relaimpo)
    
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      print (paste("Analyze: ", Type_names[type+1], "for game:", GAME_NAMES[k]))
      # print ("For  rounds 4 and 5")
      print ("For Round 5 only")
      print ("Residual on subject then multiple regression")
      cur_df$id <- as.factor (cur_df$id)
      cur_df <- cur_df [cur_df$round_number_with_partner == 5,]
      cur_df$resid <- residuals(lm(RelSend~id, data=cur_df))
      cur_df$round_number_with_partner <- as.factor(cur_df$round_number_with_partner)
      cur_df$partner_id <- as.factor(cur_df$partner_id)
      if (type == 0) {
        print ("Model without interaction")
        l1 <- lm (RelSend ~ my_trust_value  + trust_value, data=cur_df)
        print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("---")
        
        print ("Model with interaction")
        l1 <- lm (RelSend ~ my_trust_value + trust_value + my_trust_value * trust_value, data=cur_df)
        print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("Do prediction for reputation score")
        print (summary(lm (RelSend ~ my_reputation + partner_reputation, data=cur_df)))
        
      } else if (type == 1) {
        print ("Model without interaction")
        l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend, data=cur_df)
        print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("---")
        
        print ("Model with interaction")
        l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend + trust_value * my_trust_value * AbsPartnerSend, data = cur_df)
        print (summary (l1))
        
        # # stepwise regression
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        
        print ("Do prediction for reputation score")
        print (summary(lm (RelSend ~ my_reputation + partner_reputation + AbsPartnerSend, data=cur_df)))
        
        # print ("Divide the dataset to study the interaction")
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend + trust_value * my_trust_value  + trust_value * AbsPartnerSend +
        #             my_trust_value * AbsPartnerSend,
        #           data=cur_df[cur_df$AbsPartnerSend >= median(cur_df$AbsPartnerSend),])
        # print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        # 
        # print ("--------")
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value,
        #           data=cur_df[cur_df$AbsPartnerSend >= median(cur_df$AbsPartnerSend),])
        # print (summary (l1))
        # steps <- MASS::stepAIC(l1)
        # print (steps$anova)
        # print ("_-----------------------------------")
        # l1 <- lm (RelSend ~ my_trust_value  + trust_value + AbsPartnerSend + trust_value * my_trust_value  + trust_value * AbsPartnerSend +
        #             my_trust_value * AbsPartnerSend,
        #           data=cur_df[cur_df$AbsPartnerSend < median(cur_df$AbsPartnerSend),])
        # steps <- MASS::stepAIC(l1)
        # print (summary (l1))
        # print (steps$anova)
      }
    }
  }
  
```


\pagebreak

##Compare the effect of nick-name and trust score
Date: Tue 20-Jun-2017

We take the send proportion of sender and receiver for each pair in ID game and Score game, then compare them with a paired t-test to see if they are different. If they are not, we could claim that there is no difference on the effect of nick-name and score.

```{r, echo=FALSE}
for (type in 0:1) {
  all_df <- all_df_sender
  if (type == 1) {
    all_df <- all_df_receiver
  }
  print (paste("Compare ID Game and Score Game for", Type_names[type+1]))
  # print ("Only for round 4 and 5")
  comp_df <- data.frame("user_id" = as.numeric(),
                        "partner_id" = as.numeric(),
                        "send_id_game" = as.numeric(),
                        "send_score_game" = as.numeric()
                        )
  
  df_id <- as.data.frame(all_df[2])
  df_score <- as.data.frame(all_df[3])
  for (user_id in 1:(num_users * num_exp)) {
    for (partner_id in 1:num_users) {
      if (user_id != partner_id) {
        x_id <- df_id[df_id$id == user_id 
                                        & df_id$partner_id == partner_id,]$RelSend
        x_score <- df_score[df_score$id == user_id 
                                        & df_score$partner_id == partner_id,]$RelSend
        m <- min (length(x_id),length(x_score))
        
        if (m > 0) {
          for (n in 1:m) {
            new_row <- c(user_id, partner_id, x_id[n], x_score[n])
            comp_df[nrow(comp_df)+1,] <- new_row
          }
        }
      }
    }
  }
  compare_value <- t.test(comp_df$send_id_game, comp_df$send_score_game, paired = TRUE)
  print (compare_value)
}
```

\pagebreak

## Predict send proportion with reputation score

### Round 4

```{r, echo = FALSE}
for (type in 0:1) {
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    
    require(MASS) #for variable selection
    require(relaimpo)
    
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      print (paste("Analyze: ", Type_names[type+1], "for game:", GAME_NAMES[k]))
      # print ("For  rounds 4 and 5")
      print ("For Round 4 only")
      print ("Residual on subject then multiple regression")
      cur_df$id <- as.factor (cur_df$id)
      cur_df <- cur_df [cur_df$round_number_with_partner == 4,]
      cur_df$resid <- residuals(lm(RelSend~id, data=cur_df))
      cur_df$round_number_with_partner <- as.factor(cur_df$round_number_with_partner)
      cur_df$partner_id <- as.factor(cur_df$partner_id)
      if (type == 0) {
        l1 <- lm (RelSend ~ my_trust_value + trust_value + my_reputation+ partner_reputation , data=cur_df)
        print (summary (l1))
        steps <- MASS::stepAIC(l1)
        print (steps$anova)
      } else if (type == 1) {
        l1 <- lm (RelSend ~ my_trust_value  + trust_value + + my_reputation+ partner_reputation + AbsPartnerSend, data = cur_df)
        print (summary (l1))
        
        # # stepwise regression
        steps <- MASS::stepAIC(l1)
        print (steps$anova)
      }
    }
  }
```

\pagebreak

### Round 5

```{r, echo = FALSE}
for (type in 0:1) {
    all_df <- all_df_sender
    if (type == 1) {
      all_df <- all_df_receiver
    }
    
    require(MASS) #for variable selection
    require(relaimpo)
    
    for (k in 1:num_games) {
      cur_df <- as.data.frame(all_df[k])
      print (paste("Analyze: ", Type_names[type+1], "for game:", GAME_NAMES[k]))
      # print ("For  rounds 4 and 5")
      print ("For Round 5 only")
      print ("Residual on subject then multiple regression")
      cur_df$id <- as.factor (cur_df$id)
      cur_df <- cur_df [cur_df$round_number_with_partner == 5,]
      cur_df$resid <- residuals(lm(RelSend~id, data=cur_df))
      cur_df$round_number_with_partner <- as.factor(cur_df$round_number_with_partner)
      cur_df$partner_id <- as.factor(cur_df$partner_id)
      if (type == 0) {
        l1 <- lm (RelSend ~ my_trust_value + trust_value + my_reputation+ partner_reputation , data=cur_df)
        print (summary (l1))
        steps <- MASS::stepAIC(l1)
        print (steps$anova)
      } else if (type == 1) {
        l1 <- lm (RelSend ~ my_trust_value  + trust_value + + my_reputation+ partner_reputation + AbsPartnerSend, data = cur_df)
        print (summary (l1))
        
        # # stepwise regression
        steps <- MASS::stepAIC(l1)
        print (steps$anova)
      }
    }
  }
```

\pagebreak

##Analyze effect of SHOW_TRUST and SHOW_ID in individual send proportion

Date: Wed 14-Jun-2017

We will perform ANOVA without groupID.

```{r, echo = FALSE}
  for (type in 0:1) {
    df <- data.frame ("id" = as.numeric(),
                             "trust_value" = as.numeric(),
                             "RelSend" = as.numeric(),
                             "AbsSend" = as.numeric(),
                             "response_time" = as.numeric(),
                             "game_pos" = as.numeric(),
                             "peak_end_trust" = as.numeric(),
                             "AbsPartnerSend" = as.numeric(),
                             "my_trust_value" = as.numeric(),
                             "PartnerRelSend" = as.numeric(),
                             "my_reputation" = as.numeric(),
                             "partner_reputation" = as.numeric(),
                              "SHOW_TRUST" = as.numeric(),
                              "SHOW_ID" = as.numeric()
                             )
    for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      all_game <- list (simple_game, id_game, score_game, combine_game)
      
      for (k in 1:num_games) {
        cur_game <- as.data.frame(all_game[k])
        for (user_id in 1:num_users) {
          cur_reputation = 0.5
          partner_reputation = 0.5
          for (i in 1:nrow(cur_game)) {
            if (cur_game[i,]$Subject == user_id) {
              if (cur_game[i,]$my_send_proportional >= 0 & cur_game[i,]$Type == type) {
                my_trust_score = cur_game[cur_game$Type == (1  - type) & cur_game$Partner == user_id 
                                          & cur_game$Period == cur_game[i,]$Period,]$showing_trust_score
                if (cur_game[i,]$Period %% 25 > 1 | cur_game[i,]$Period %% 25 == 0) {
                  
                  # calculate my reputation
                  cur_period = cur_game[i,]$Period
                  cur_reputation = mean (cur_game[cur_game$Subject == user_id 
                                                  & cur_game$Period < cur_period
                                                  & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                  if (is.nan(cur_reputation)) {
                    cur_reputation = 0.5
                  }
                  
                  # calculate partner reputation
                  partner_id <- cur_game[i,]$Partner
                  partner_reputation = mean (cur_game[cur_game$Subject == partner_id 
                                                  & cur_game$Period < cur_period
                                                  & cur_game$my_send_proportional >= 0,]$my_send_proportional)
                  if (is.nan (partner_reputation)) {
                    partner_reputation = 0.5
                  }
                  
                } else {
                  cur_reputation = 0.5
                  partner_reputation = 0.5
                }
                new_row = c((exp_id - 1) * num_users + user_id,
                      (cur_game[i,]$showing_trust_score),
                      (cur_game[i,]$my_send_proportional),
                      (cur_game[i,]$Contribution),
                      (cur_game[i,]$response_time),
                      SIMPLE_GAME_ORDERS[exp_id],
                       (calc_peak_end_trust(cur_game[i,]$showing_trust_score)),
                      (cur_game[i,]$PartnerDecision),
                      my_trust_score,
                      (cur_game[i,]$send_proportion),
                      cur_reputation,
                      partner_reputation,
                      ifelse(k <= 2, 0, 1),
                      ifelse (k %% 2 == 0,1,0)
                      )
                df[nrow(df) + 1,] <- new_row
              }
            }
          }
        }
      }
    }
    # ANOVA here
    df.aov <- aov(RelSend ~ SHOW_TRUST * SHOW_ID + Error (id/(SHOW_TRUST*SHOW_ID)), data = df)
    print (paste ("ANOVA on SHOW_TRUST and SHOW_ID for:", Type_names[type+1]))
    print (summary(df.aov))
  }
  
```

\pagebreak

## Understanding interactions between two trust values

```{r, echo=FALSE}
for (type in 0:1) {
  plot(1, type="n", main=paste ("Interaction in score game for type", Type_names [ type + 1]), ylab="Send_proportion", xlab="My trust value", xlim=c(0, 1.5), ylim=c(0, 1.1))
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      x11 <- c()
      x12 <- c()
      x13 <- c()  #x13: low my trust value, high partner trust value
      
      x21 <- c()
      x22 <- c()
      x23 <- c()
      
      x31 <- c()
      x32 <- c()
      x33 <- c()
      
      MAX_TRUST_VALUE <- max(score_game$showing_trust_score)
      
      for (i in 1:nrow(score_game)) {
        if (score_game[i,]$Type == type & score_game[i,]$my_send_proportional >= 0) {
          my_trust_value <- score_game[score_game$Period == score_game[i,]$Period
                                       & score_game$Partner == score_game[i,]$Subject,]$showing_trust_score
          partner_trust_value <- score_game[i,]$showing_trust_score
          my_send_proportion <- score_game[i,]$my_send_proportional
          
          if (my_trust_value <= 1/3 * MAX_TRUST_VALUE & partner_trust_value <= 1/3 * MAX_TRUST_VALUE) {
            x11 <- c(x11, my_send_proportion)
          }
          else if (my_trust_value <= 1/3 * MAX_TRUST_VALUE & partner_trust_value <= 2/3 * MAX_TRUST_VALUE) {
            x12 <- c(x12, my_send_proportion)
          }
          else if (my_trust_value <= 1/3 * MAX_TRUST_VALUE & partner_trust_value <= 1 * MAX_TRUST_VALUE) {
            x13 <- c(x13, my_send_proportion)
          }
          else if (my_trust_value <= 2/3 * MAX_TRUST_VALUE & partner_trust_value <= 1/3 * MAX_TRUST_VALUE) {
            x21 <- c(x21, my_send_proportion)
          }
          else if (my_trust_value <= 2/3 * MAX_TRUST_VALUE & partner_trust_value <= 2/3 * MAX_TRUST_VALUE) {
            x22 <- c(x22, my_send_proportion)
          }
          else if (my_trust_value <= 2/3 * MAX_TRUST_VALUE & partner_trust_value <= 1 * MAX_TRUST_VALUE) {
            x23 <- c(x23, my_send_proportion)
          }
          else if (my_trust_value <= 1 * MAX_TRUST_VALUE & partner_trust_value <= 1/3 * MAX_TRUST_VALUE) {
            x31 <- c(x31, my_send_proportion)
          }
          else if (my_trust_value <= 1 * MAX_TRUST_VALUE & partner_trust_value <= 2/3 * MAX_TRUST_VALUE) {
            x32 <- c(x32, my_send_proportion)
          }
          else if (my_trust_value <= 1 * MAX_TRUST_VALUE & partner_trust_value <= 1 * MAX_TRUST_VALUE) {
            x33 <- c(x33, my_send_proportion)
          }
        }
      }
  }
  points (y = mean(x11), x = 1/4, pch = 10, col = "black")
  points (y = mean(x12), x = 1/4, pch = 11, col = "black")
  points (y = mean(x13), x = 1/4, pch = 12, col = "black")
  
  points (y = mean(x21), x = 2/4, pch = 10, col = "blue")
  points (y = mean(x22), x = 2/4, pch = 11, col = "blue")
  points (y = mean(x23), x = 2/4, pch = 12, col = "blue")
  
  points (y = mean(x31), x = 3/4, pch = 10, col = "red")
  points (y = mean(x32), x = 3/4, pch = 11, col = "red")
  points (y = mean(x33), x = 3/4, pch = 12, col = "red")
  
  legend(x=1,y=1,pch=c(10,11,12),c("Low partner trust","Medium","High"))
  
  cat("\n\n\\pagebreak\n")
}

for (type in 0:1) {
  plot(1, type="n", main=paste ("Interaction in combine game for type", Type_names [ type + 1]), ylab="Send_proportion", xlab= "My trust value", xlim=c(-0.1, 1.5), ylim=c(-0.1, 1.1))
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      x11 <- c()
      x12 <- c()
      x13 <- c()  #x13: low my trust value, high partner trust value
      
      x21 <- c()
      x22 <- c()
      x23 <- c()
      
      x31 <- c()
      x32 <- c()
      x33 <- c()
      
      MAX_TRUST_VALUE <- max(combine_game$showing_trust_score)
      
      for (i in 1:nrow(combine_game)) {
        if (combine_game[i,]$Type == type & combine_game[i,]$my_send_proportional >= 0) {
          my_trust_value <- combine_game[combine_game$Period == combine_game[i,]$Period
                                       & combine_game$Partner == combine_game[i,]$Subject,]$showing_trust_score
          partner_trust_value <- combine_game[i,]$showing_trust_score
          my_send_proportion <- combine_game[i,]$my_send_proportional
          
          if (my_trust_value <= 1/3 * MAX_TRUST_VALUE & partner_trust_value <= 1/3 * MAX_TRUST_VALUE) {
            x11 <- c(x11, my_send_proportion)
          }
          else if (my_trust_value <= 1/3 * MAX_TRUST_VALUE & partner_trust_value <= 2/3 * MAX_TRUST_VALUE) {
            x12 <- c(x12, my_send_proportion)
          }
          else if (my_trust_value <= 1/3 * MAX_TRUST_VALUE & partner_trust_value <= 1 * MAX_TRUST_VALUE) {
            x13 <- c(x13, my_send_proportion)
          }
          else if (my_trust_value <= 2/3 * MAX_TRUST_VALUE & partner_trust_value <= 1/3 * MAX_TRUST_VALUE) {
            x21 <- c(x21, my_send_proportion)
          }
          else if (my_trust_value <= 2/3 * MAX_TRUST_VALUE & partner_trust_value <= 2/3 * MAX_TRUST_VALUE) {
            x22 <- c(x22, my_send_proportion)
          }
          else if (my_trust_value <= 2/3 * MAX_TRUST_VALUE & partner_trust_value <= 1 * MAX_TRUST_VALUE) {
            x23 <- c(x23, my_send_proportion)
          }
          else if (my_trust_value <= 1 * MAX_TRUST_VALUE & partner_trust_value <= 1/3 * MAX_TRUST_VALUE) {
            x31 <- c(x31, my_send_proportion)
          }
          else if (my_trust_value <= 1 * MAX_TRUST_VALUE & partner_trust_value <= 2/3 * MAX_TRUST_VALUE) {
            x32 <- c(x32, my_send_proportion)
          }
          else if (my_trust_value <= 1 * MAX_TRUST_VALUE & partner_trust_value <= 1 * MAX_TRUST_VALUE) {
            x33 <- c(x33, my_send_proportion)
          }
        }
      }
  }
  
  points (y = mean(x11), x = 1/4, pch = 10, col = "black")
  points (y = mean(x12), x = 1/4, pch = 11, col = "black")
  points (y = mean(x13), x = 1/4, pch = 12, col = "black")
  
  points (y = mean(x21), x = 2/4, pch = 10, col = "blue")
  points (y = mean(x22), x = 2/4, pch = 11, col = "blue")
  points (y = mean(x23), x = 2/4, pch = 12, col = "blue")
  
  points (y = mean(x31), x = 3/4, pch = 10, col = "red")
  points (y = mean(x32), x = 3/4, pch = 11, col = "red")
  points (y = mean(x33), x = 3/4, pch = 12, col = "red")
  
  legend(x=1,y=1,pch=c(10,11,12),c("Low partner trust","Medium","High"))
  
  cat("\n\n\\pagebreak\n")
}
```

\pagebreak

## Check the change of user behavior with a partner over time in presence of trust score

In this section, we will see do the behavior of one user converge in the end of a game.

```{r, echo=FALSE}
for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      # pick one user as example
      random_userid = sample (1:6,1)
      
      plot(1, type="n", xlab=paste ("User",random_userid,"of exp:", exp_id), ylab="Send_proportion/partner_trust", xlim=c(0, 5), ylim=c(0, 10))
      for (partner_id in 1:6) {
        if (partner_id != random_userid) {
          send_proportion <- score_game[score_game$Subject == random_userid & score_game$Partner == partner_id,]$my_send_proportional
          partner_trust_score <- score_game[score_game$Subject == random_userid & score_game$Partner == partner_id,]$showing_trust_score
          y_value <- send_proportion / partner_trust_score
          y_value <- replace(y_value, y_value < 0, 0)
          lines (x = 1:5, y = y_value)
        }
      }
      cat("\n\n\\pagebreak\n")
}
```

\pagebreak

As the metric send_proportion/partner_trust does not say anything, we now display both send_proportion and partner_trust in one graph to check the stability of user behavior over time.

```{r, echo=FALSE}
for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      # pick one user as example
      random_userid = sample (1:6,1)
      
      plot(1, type="n", xlab=paste ("(Score Game) User",random_userid,"of group:", exp_id), ylab="Send_proportion/partner_trust", xlim=c(0, 5), ylim=c(-1, 1))
      for (partner_id in 1:6) {
        if (partner_id != random_userid) {
          send_proportion <- score_game[score_game$Subject == random_userid & score_game$Partner == partner_id,]$my_send_proportional
          partner_trust_score <- score_game[score_game$Subject == random_userid & score_game$Partner == partner_id,]$showing_trust_score
          # print (partner_trust_score)
          # y_value <- send_proportion / partner_trust_score
          # y_value <- replace(y_value, y_value < 0, 0)
          lines (x = 1:5,y = send_proportion, type = "o", col = col_list[partner_id], pch = 1 + partner_id, lty = partner_id+1, lwd = 2)
          lines (x = 1:5,y = partner_trust_score, type = "o", col = col_list[partner_id], pch = 10 + partner_id, lty = 1, lwd = 2)
        }
      }
      legend(x=0,y=0,lty = c(1,2),c("Partner trust", "Send proportion"))
      cat("\n\n\\pagebreak\n")
}
```

\pagebreak

## Change of send_proportion ~ partner_trust over time

We want to see how user send proportion depends on partner trust in each round for each game

```{r,echo=FALSE}
for (type in 0:1) {
  plot(1, type="n", xlab=paste ("Partner Trust"), ylab="Send_proportion", main = paste("Simple Game", Type_names[type+1]), xlim=c(0, 1), ylim=c(0 - type *1, 1))
  
  for (period in 1:5) {
        send_proportions <- c()
        partner_trusts <- c()
        
        for (exp_id in 1:num_exp) {
        first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
        last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
        simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        
        cur_game <- simple_game
        for (user_id in 1:6) {
          sends <- c()
          trusts <- c()
          for (partner_id in 1:6) {
            if (user_id != partner_id) {
              send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
              partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
              types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
              
              if (types[period] == type) {
                sends <- c(sends, send_proportion[period])
                trusts <- c(trusts, partner_trust_score[period])
              }
            }          
          }
          if (length(sends) > 0) {
            send_proportions <- c(send_proportions, mean (sends))
            partner_trusts <- c(partner_trusts, mean (trusts))
          } 
          
        }
      }
      y_value <- send_proportions[order (partner_trusts)]
      x_value <- partner_trusts[order (partner_trusts)]
      lines ( y = y_value , x = x_value, col = col_list [period], pch = 21, lty = 5)
      
      
      if (period > 1) {
        abline(lm (y_value ~ x_value), col = col_list [period])
      }
  }
  
  legend (x=0.8,y=0.4,col = col_list[1:5],c(" 1"," 2"," 3"," 4"," 5"), lty = rep(1,5))
  cat("\n\n\\pagebreak\n")
}
```

```{r,echo=FALSE}
for (type in 0:1) {
  plot(1, type="n", xlab=paste ("Partner Trust"), ylab="Send_proportion", main = paste("ID Game", Type_names[type+1]), xlim=c(0, 1), ylim=c(0 - type *1, 1))
  
  for (period in 1:5) {
        send_proportions <- c()
        partner_trusts <- c()
        
        for (exp_id in 1:num_exp) {
        first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
        last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
        simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        
        cur_game <- id_game
        for (user_id in 1:6) {
          sends <- c()
          trusts <- c()
          for (partner_id in 1:6) {
            if (user_id != partner_id) {
              send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
              partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
              types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
              
              if (types[period] == type) {
                sends <- c(sends, send_proportion[period])
                trusts <- c(trusts, partner_trust_score[period])
              }
            }          
          }
          if (length(sends) > 0) {
            send_proportions <- c(send_proportions, mean (sends))
            partner_trusts <- c(partner_trusts, mean (trusts))
          } 
          
        }
      }
      y_value <- send_proportions[order (partner_trusts)]
      x_value <- partner_trusts[order (partner_trusts)]
      lines ( y = y_value , x = x_value, col = col_list [period], pch = 21, lty = 5)
      
      
      if (period > 1) {
        abline(lm (y_value ~ x_value), col = col_list [period])
      }
  }
  legend (x=0.8,y=0.4,col = col_list[1:5],c(" 1"," 2"," 3"," 4"," 5"), lty = rep(1,5))
  cat("\n\n\\pagebreak\n")
}
```

```{r,echo=FALSE}
for (type in 0:1) {
  plot(1, type="n", xlab=paste ("Partner Trust"), ylab="Send_proportion", main = paste("Score Game", Type_names[type+1]), xlim=c(0, 1), ylim=c(0 - type *1, 1))
  
  for (period in 1:5) {
        send_proportions <- c()
        partner_trusts <- c()
        
        for (exp_id in 1:num_exp) {
        first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
        last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
        simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        
        cur_game <- score_game
        for (user_id in 1:6) {
          sends <- c()
          trusts <- c()
          for (partner_id in 1:6) {
            if (user_id != partner_id) {
              send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
              partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
              types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
              
              if (types[period] == type) {
                sends <- c(sends, send_proportion[period])
                trusts <- c(trusts, partner_trust_score[period])
              }
            }          
          }
          if (length(sends) > 0) {
            send_proportions <- c(send_proportions, mean (sends))
            partner_trusts <- c(partner_trusts, mean (trusts))
          } 
          
        }
      }
      y_value <- send_proportions[order (partner_trusts)]
      x_value <- partner_trusts[order (partner_trusts)]
      lines ( y = y_value , x = x_value, col = col_list [period], pch = 21, lty = 5)
      
      
      if (period > 1) {
        abline(lm (y_value ~ x_value), col = col_list [period])
      }
  }
  legend (x=0.8,y=0.4,col = col_list[1:5],c(" 1"," 2"," 3"," 4"," 5"), lty = rep(1,5))
  cat("\n\n\\pagebreak\n")
}
```

```{r,echo=FALSE}
for (type in 0:1) {
  plot(1, type="n", xlab=paste ("Partner Trust"), ylab="Send_proportion", main = paste("Combine Game", Type_names[type+1]), xlim=c(0, 1), ylim=c(0 - type *1, 1))
  
  for (period in 1:5) {
        send_proportions <- c()
        partner_trusts <- c()
        
        for (exp_id in 1:num_exp) {
        first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
        last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
        simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
        combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
        
        cur_game <- combine_game
        for (user_id in 1:6) {
          sends <- c()
          trusts <- c()
          for (partner_id in 1:6) {
            if (user_id != partner_id) {
              send_proportion <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$my_send_proportional
              partner_trust_score <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$showing_trust_score
              types <- cur_game[cur_game$Subject == user_id & cur_game$Partner == partner_id,]$Type
              
              if (types[period] == type) {
                sends <- c(sends, send_proportion[period])
                trusts <- c(trusts, partner_trust_score[period])
              }
            }          
          }
          if (length(sends) > 0) {
            send_proportions <- c(send_proportions, mean (sends))
            partner_trusts <- c(partner_trusts, mean (trusts))
          } 
          
        }
      }
      y_value <- send_proportions[order (partner_trusts)]
      x_value <- partner_trusts[order (partner_trusts)]
      lines ( y = y_value , x = x_value, col = col_list [period], pch = 21, lty = 5)
      
      
      if (period > 1) {
        abline(lm (y_value ~ x_value), col = col_list [period])
      }
  }
  legend (x=0.8,y=0.4,col = col_list[1:5],c(" 1"," 2"," 3"," 4"," 5"), lty = rep(1,5))
  cat("\n\n\\pagebreak\n")
}
```

\pagebreak

## Group Effect on Regression Power (Sending ~ 2 trust scores)

```{r, echo = FALSE}
#   print ("Group interaction on regression power of sending behavior on two trust scores")
#   
#   require (ppcor)
#   for (type in 0:1) {
#     df_simple <- data.frame ("id" = as.numeric(),
#                              "trust_value" = as.numeric(),
#                              "RelSend" = as.numeric(),
#                              "AbsSend" = as.numeric(),
#                              "response_time" = as.numeric(),
#                              "game_pos" = as.numeric(),
#                              "peak_end_trust" = as.numeric(),
#                              "AbsPartnerSend" = as.numeric(),
#                              "my_trust_value" = as.numeric(),
#                              "r_value" = as.numeric(),
#                              "partial_r" = as.numeric())
#     df_id <- data.frame ("id" = as.numeric(),
#                          "trust_value" = as.numeric(),
#                          "RelSend" = as.numeric(),
#                          "AbsSend" = as.numeric(),
#                          "response_time" = as.numeric(),
#                          "game_pos" = as.numeric(),
#                          "peak_end_trust" = as.numeric(),
#                          "AbsPartnerSend" = as.numeric(),
#                          "my_trust_value" = as.numeric(),
#                          "r_value" = as.numeric(),
#                          "partial_r" = as.numeric())
#     df_score <- data.frame ("id" = as.numeric(),
#                             "trust_value" = as.numeric(),
#                             "RelSend" = as.numeric(),
#                             "AbsSend" = as.numeric(),
#                             "response_time" = as.numeric(),
#                             "game_pos" = as.numeric(),
#                             "peak_end_trust" = as.numeric(),
#                             "AbsPartnerSend" = as.numeric(),
#                             "my_trust_value" = as.numeric(),
#                             "r_value" = as.numeric(),
#                             "partial_r" = as.numeric())
#     df_combine <- data.frame ("id" = as.numeric(),
#                               "trust_value" = as.numeric(),
#                               "RelSend" = as.numeric(),
#                               "AbsSend" = as.numeric(),
#                               "response_time" = as.numeric(),
#                               "game_pos" = as.numeric(),
#                               "peak_end_trust" = as.numeric(),
#                               "AbsPartnerSend" = as.numeric(),
#                               "my_trust_value" = as.numeric(),
#                               "r_value" = as.numeric(),
#                               "partial_r" = as.numeric())
#     df_total <- data.frame("id" = as.numeric(),
#                            "GroupID" = as.numeric(),
#                            "SHOW_TRUST" = as.numeric(),
#                            "SHOW_ID" = as.numeric(),
#                            "r_value" = as.numeric(),
#                            "partial_r" = as.numeric())
#     for (exp_id in 1:num_exp) {
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       all_game = list (simple_game, id_game, score_game, combine_game)
#       
#       for (user_id in 1:num_users) {
#         
#         rs = rep (0, num_games)
#         partial_rs = rep (0, num_games)
#         
#         for (game_id in 1:num_games) {
#           cur_game = all_game[[game_id]]
#           this_game_behavior= data.frame("rel_send" = as.numeric(),
#                                          "partner_trust" = as.numeric(),
#                                          "my_trust" = as.numeric())
#           for (partner_id in 1:num_users) {
#             if (user_id == partner_id) {next()}
#             n_data_points = length(cur_game[cur_game$Type == type & cur_game$Subject == user_id & cur_game$Partner == partner_id & cur_game$my_send_proportional >= 0,]$my_send_proportional)
#             if (n_data_points > 0) {
#               for (i in 1:n_data_points) {
#                 new_row <- c(cur_game[cur_game$Type == type & cur_game$Subject == user_id & cur_game$Partner == partner_id & cur_game$my_send_proportional >= 0,]$my_send_proportional[i],
#                              cur_game[cur_game$Type == type & cur_game$Subject == user_id & cur_game$Partner == partner_id & cur_game$my_send_proportional >= 0,]$showing_trust_score[i],
#                              cur_game[cur_game$Type == (1 - type) & cur_game$Partner == user_id & cur_game$Subject == partner_id & cur_game$send_proportion >= 0,]$showing_trust_score[i])
#                 this_game_behavior[(nrow(this_game_behavior) + 1),] <- new_row
#               }
#             }
#           }
#           
#           r <- summary (lm (rel_send ~ partner_trust + my_trust, data = this_game_behavior))$r.squared
#           part_r <- 0
#           try(part_r <- pcor.test(this_game_behavior$my_trust, this_game_behavior$rel_send, this_game_behavior$partner_trust)$estimate)
#           if (is.na(r)) {
#             r <- 0
#           }
#           rs[game_id] <- r
#           partial_rs[game_id] <- part_r
#         }
#         
#         new_row = c((exp_id - 1) * num_users + user_id,
#                     mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$showing_trust_score),
#                     mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id & simple_game$my_send_proportional >= 0,]$my_send_proportional),
#                     mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$Contribution),
#                     mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$response_time),
#                     SIMPLE_GAME_ORDERS[exp_id],
#                     mean (calc_peak_end_trust(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$showing_trust_score)),
#                     mean(simple_game[simple_game$Type == type & simple_game$Subject == user_id,]$PartnerDecision),
#                     mean(simple_game[simple_game$Type == (1  - type) & simple_game$Partner == user_id,]$showing_trust_score),
#                     rs[1],
#                     partial_rs[1]
#         )
#         df_simple[nrow(df_simple) + 1,] <- new_row
#         df_total[nrow(df_total) + 1,] <- c(user_id + num_users * (exp_id - 1),
#                                            exp_id,
#                                            0,
#                                            0,
#                                            rs[1],
#                                            partial_rs[1]
#         )
#         
#         new_row = c((exp_id - 1) * num_users + user_id,
#                     mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$showing_trust_score),
#                     mean(id_game[id_game$Type == type & id_game$Subject == user_id & id_game$my_send_proportional >= 0,]$my_send_proportional),
#                     mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$Contribution),
#                     mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$response_time),
#                     ID_GAME_ORDERS[exp_id],
#                     mean(calc_peak_end_trust(id_game[id_game$Type == type & id_game$Subject == user_id,]$showing_trust_score)),
#                     mean(id_game[id_game$Type == type & id_game$Subject == user_id,]$PartnerDecision),
#                     mean(id_game[id_game$Type == (1  - type) & id_game$Partner == user_id,]$showing_trust_score),
#                     rs[2],
#                     partial_rs[2]
#         )
#         df_id[nrow(df_id) + 1,] <- new_row
#         df_total[nrow(df_total) + 1,] <- c(user_id + num_users * (exp_id - 1),
#                                            exp_id,
#                                            0,
#                                            1,
#                                            rs[2],
#                                            partial_rs[2]
#         )
#         
#         new_row = c((exp_id - 1) * num_users + user_id,
#                     mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$showing_trust_score),
#                     mean(score_game[score_game$Type == type & score_game$Subject == user_id & score_game$my_send_proportional >= 0,]$my_send_proportional),
#                     mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$Contribution),
#                     mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$response_time),
#                     SCORE_GAME_ORDERS[exp_id],
#                     mean (calc_peak_end_trust(score_game[score_game$Type == type & score_game$Subject == user_id,]$showing_trust_score)),
#                     mean(score_game[score_game$Type == type & score_game$Subject == user_id,]$PartnerDecision),
#                     mean(score_game[score_game$Type == (1  - type) & score_game$Partner == user_id,]$showing_trust_score),
#                     rs[3],
#                     partial_rs[3]
#         )
#         df_score[nrow(df_score) + 1,] <- new_row
#         df_total[nrow(df_total) + 1,] <- c(user_id + num_users * (exp_id - 1),
#                                            exp_id,
#                                            1,
#                                            0,
#                                            rs[3],
#                                            partial_rs[3]
#         )
#         
#         new_row = c((exp_id - 1) * num_users + user_id,
#                     mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$showing_trust_score),
#                     mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id & combine_game$my_send_proportional >= 0,]$my_send_proportional),
#                     mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$Contribution),
#                     mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$response_time),
#                     COMBINE_GAME_ORDERS[exp_id],
#                     mean (calc_peak_end_trust(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$showing_trust_score)),
#                     mean(combine_game[combine_game$Type == type & combine_game$Subject == user_id,]$PartnerDecision),
#                     mean(combine_game[combine_game$Type == (1  - type) & combine_game$Partner == user_id,]$showing_trust_score),
#                     rs[4],
#                     partial_rs[4]
#         )
#         df_combine[nrow(df_combine) + 1,] <- new_row
#         df_total[nrow(df_total) + 1,] <- c(user_id + num_users * (exp_id - 1),
#                                            exp_id,
#                                            1,
#                                            1,
#                                            rs[4],
#                                            partial_rs[4]
#         )
#       }
#     }
#     df_total$id <- as.factor (df_total$id)
#     df_total$GroupID <- as.factor (df_total$GroupID)
#     df_total$SHOW_TRUST <- as.factor (df_total$SHOW_TRUST)
#     df_total$SHOW_ID <- as.factor (df_total$SHOW_ID)
#     
#     df_total$score <- df_total$r_value
#     print ("ANOVA analysis of regression power on sending behavior on 2 trust scores on Group:SHOW_TRUST:SHOW_ID")
#     anova_analysis (df_total, type = type, num_way = 3)
#     
# #     print ("ANOVA analysis by groups")
# #     for (exp_id in 1:num_exp) {
# #       print ("")
# #       print (paste ("Analysis of Group ", exp_id, " of ", Type_names[type + 1]))
# #       anova_analysis (df_total[df_total$GroupID == exp_id,], type = type, num_way = 4)
# #       print ("Mean of r value without and with trust")
# #       print (mean (df_total[df_total$GroupID == exp_id & df_total$SHOW_TRUST == 0,]$score))
# #       print (mean (df_total[df_total$GroupID == exp_id & df_total$SHOW_TRUST == 1,]$score))
# #       if (type == 1) {
# #         print ("Mean of r value without and with ID")
# #         print (mean (df_total[df_total$GroupID == exp_id & df_total$SHOW_ID == 0,]$score))
# #         print (mean (df_total[df_total$GroupID == exp_id & df_total$SHOW_ID == 1,]$score))
# #       }
# #     }
#     
#     print ("ANOVA analysis of partial R of sending behavior on 2 trust scores")
#     df_total$score <- df_total$partial_r
#     anova_analysis(df = df_total, type = type, num_way = 3)
#     
#     #     print ("Analysis of group interaction in the game without trust")
#     #     df_wo_trust <- df_total[df_total$SHOW_TRUST == 0,]
#     #     df_wo_trust$game_pos <- df_wo_trust$SHOW_ID
#     #     anova_analysis(df_wo_trust, type = type, num_way = 2)
#     #     
#     #     print ("Analysis of group interaction in the game with trust")
#     #     df_with_trust <- df_total[df_total$SHOW_TRUST == 1,]
#     #     df_with_trust$game_pos <- df_wo_trust$SHOW_ID
#     #     anova_analysis(df_with_trust, type = type, num_way = 2)
#   }
```

\pagebreak

## Analyze the group effect on regression of sending behavior and own trust value

Also, we want to see can we predict the behavior of users based on trust score.

Temporary disable, because it is better to regression on 2 trust scores instead of 1

```{r, echo=FALSE}
#   for (type in 0:1) {
#     df_simple = data.frame("id" = as.numeric(),
#                            "GroupID" = as.numeric(),
#                            "SHOW_TRUST" = as.numeric(),
#                            "SHOW_ID" = as.numeric(),
#                            "R_value" = as.numeric())
#     df_id = data.frame("id" = as.numeric(),
#                        "GroupID" = as.numeric(),
#                        "SHOW_TRUST" = as.numeric(),
#                        "SHOW_ID" = as.numeric(),
#                        "R_value" = as.numeric())
#     df_score = data.frame("id" = as.numeric(),
#                           "GroupID" = as.numeric(),
#                           "SHOW_TRUST" = as.numeric(),
#                           "SHOW_ID" = as.numeric(),
#                           "R_value" = as.numeric())
#     df_combine = data.frame("id" = as.numeric(),
#                             "GroupID" = as.numeric(),
#                             "SHOW_TRUST" = as.numeric(),
#                             "SHOW_ID" = as.numeric(),
#                             "R_value" = as.numeric())
#     for (exp_id in 1:num_exp) {
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       # add up all partner decision to 10 unit to remove the NaN problem of R squared
#       simple_game$PartnerDecision = simple_game$PartnerDecision + 10
#       id_game$PartnerDecision = id_game$PartnerDecision + 10
#       score_game$PartnerDecision = score_game$PartnerDecision + 10
#       combine_game$PartnerDecision = combine_game$PartnerDecision + 10
#       
#       for (user_id in 1:num_users) {
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      0,
#                      summary(lm(PartnerDecision ~ showing_trust_score, data = simple_game[simple_game$Type ==type & simple_game$Partner == user_id,]))$r.squared
#         )
#         df_simple [nrow(df_simple) + 1,] <- new_row
#         
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      1,
#                      summary(lm(PartnerDecision ~ showing_trust_score, data = id_game[id_game$Type ==type & id_game$Partner == user_id,]))$r.squared
#         )
#         df_id [nrow(df_id) + 1,] <- new_row
#         
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      0,
#                      summary(lm(PartnerDecision ~ showing_trust_score, data = score_game[score_game$Type ==type & score_game$Partner == user_id,]))$r.squared
#         )
#         df_score [nrow(df_score) + 1,] <- new_row
#         
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      1,
#                      summary(lm(PartnerDecision ~ showing_trust_score, data = combine_game[combine_game$Type ==type & combine_game$Partner == user_id,]))$r.squared
#         )
#         df_combine [nrow(df_combine) + 1,] <- new_row
#       }
#     }
#     df_total <- rbind (df_simple, df_id)
#     df_total <- rbind (df_total, df_score)
#     df_total <- rbind (df_total, df_combine)
#     df_total$id <- as.factor (df_total$id)
#     df_total$GroupID <- as.factor (df_total$GroupID)
#     df_total$SHOW_TRUST <- as.factor (df_total$SHOW_TRUST)
#     df_total$SHOW_ID <- as.factor (df_total$SHOW_ID)
#     # df_total$score <- sqrt(df_total$R_value)
#     df_total$score <- df_total$R_value
#     if (any(is.na(df_total$score))) {
#       df_total[is.na(df_total$score),]$score <- 0
#     }
#     # print (df_total)
#     df_total$R_value <- NULL
#     
#     if (any (is.na(df_simple$R_value))) {
#       df_simple[is.na(df_simple$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_id$R_value))) {
#       df_id[is.na(df_id$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_score$R_value))) {
#       df_score[is.na(df_score$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_combine$R_value))) {
#       df_combine[is.na(df_combine$R_value),]$R_value <- 0
#     }
#     
#     print (paste("ANOVA analysis for R_value after adding up 10 unit to sending amount on Group:SHOW_TRUST:SHOW_ID for type: ", Type_names [(1 -type) + 1]))
#     anova_analysis (df = df_total, type = (1 - type))
#     
#     # Make 2 - way ANOVA analysis
#     # By making a new code: game_pos, which has 4 possible values 1, 2, 3, 4 for 4 games
#     print (paste("ANOVA analysis for R_value after adding up 10 unit to sending amount on Group:Game_Setting for type: ", Type_names [(1 -type) + 1]))
#     df_total$game_pos <- as.factor (((as.numeric (df_total$SHOW_TRUST) - 1) * 2 + (as.numeric (df_total$SHOW_ID) - 1) + 1))
#     anova_analysis(df_total, num_way = 2, type = (1 - type))
#   }
```

\pagebreak

## Analyze the group effect on correlation of sending behavior and own trust value

We want to see if the correlation (prediction power) of trust score we calculated to users and his own future action are consitency between groups.

Temporary disable because regression on 2 trust scores is better.

```{r, echo=FALSE}
#   for (type in 0:1) {
#     df_simple = data.frame("id" = as.numeric(),
#                            "GroupID" = as.numeric(),
#                            "SHOW_TRUST" = as.numeric(),
#                            "SHOW_ID" = as.numeric(),
#                            "R_value" = as.numeric())
#     df_id = data.frame("id" = as.numeric(),
#                        "GroupID" = as.numeric(),
#                        "SHOW_TRUST" = as.numeric(),
#                        "SHOW_ID" = as.numeric(),
#                        "R_value" = as.numeric())
#     df_score = data.frame("id" = as.numeric(),
#                           "GroupID" = as.numeric(),
#                           "SHOW_TRUST" = as.numeric(),
#                           "SHOW_ID" = as.numeric(),
#                           "R_value" = as.numeric())
#     df_combine = data.frame("id" = as.numeric(),
#                             "GroupID" = as.numeric(),
#                             "SHOW_TRUST" = as.numeric(),
#                             "SHOW_ID" = as.numeric(),
#                             "R_value" = as.numeric())
#     for (exp_id in 1:num_exp) {
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       for (user_id in 1:num_users) {
#         cur_data <- simple_game[simple_game$Type ==type & simple_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      0,
#                      cor(cur_data$send_proportion, cur_data$showing_trust_score)
#         )
#         df_simple [nrow(df_simple) + 1,] <- new_row
#         
#         cur_data <- id_game[id_game$Type ==type & id_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      1,
#                      cor(cur_data$send_proportion, cur_data$showing_trust_score)
#         )
#         df_id [nrow(df_id) + 1,] <- new_row
#         
#         cur_data <- score_game[score_game$Type ==type & score_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      0,
#                      cor(cur_data$send_proportion, cur_data$showing_trust_score)
#         )
#         df_score [nrow(df_score) + 1,] <- new_row
#         
#         cur_data <- combine_game[combine_game$Type ==type & combine_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      1,
#                      cor(cur_data$send_proportion, cur_data$showing_trust_score)
#         )
#         df_combine [nrow(df_combine) + 1,] <- new_row
#       }
#     }
#     df_total <- rbind (df_simple, df_id)
#     df_total <- rbind (df_total, df_score)
#     df_total <- rbind (df_total, df_combine)
#     df_total$id <- as.factor (df_total$id)
#     df_total$GroupID <- as.factor (df_total$GroupID)
#     df_total$SHOW_TRUST <- as.factor (df_total$SHOW_TRUST)
#     df_total$SHOW_ID <- as.factor (df_total$SHOW_ID)
#     # df_total$score <- sqrt(df_total$R_value)
#     df_total$score <- df_total$R_value
#     if (any(is.na(df_total$score))) {
#       df_total[is.na(df_total$score),]$score <- 0
#     }
#     # print (df_total)
#     df_total$R_value <- NULL
#     
#     if (any (is.na(df_simple$R_value))) {
#       df_simple[is.na(df_simple$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_id$R_value))) {
#       df_id[is.na(df_id$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_score$R_value))) {
#       df_score[is.na(df_score$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_combine$R_value))) {
#       df_combine[is.na(df_combine$R_value),]$R_value <- 0
#     }
#     
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:SHOW_TRUST:SHOW_ID for type: ", Type_names [(1 -type) + 1]))
#     anova_analysis (df = df_total, type = (1 - type))
#     
#     # Make 2 - way ANOVA analysis
#     # By making a new code: game_pos, which has 4 possible values 1, 2, 3, 4 for 4 games
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:Game_Setting for type: ", Type_names [(1 -type) + 1]))
#     df_total$game_pos <- as.factor (((as.numeric (df_total$SHOW_TRUST) - 1) * 2 + (as.numeric (df_total$SHOW_ID) - 1) + 1))
#     anova_analysis(df_total, num_way = 2, type = (1 - type))
#   }
```

\pagebreak

## Analyze the group effect on correlation of sending behavior and own trust value without Group 3

We want to see if the correlation (prediction power) of trust score we calculated to users and his own future action are consitency between groups. From the above analysis, we can see that Group 3 is somehow strange, so we want to analyze without them.

Temorary remove

```{r,echo=FALSE}
#   for (type in 0:1) {
#     df_simple = data.frame("id" = as.numeric(),
#                            "GroupID" = as.numeric(),
#                            "SHOW_TRUST" = as.numeric(),
#                            "SHOW_ID" = as.numeric(),
#                            "R_value" = as.numeric())
#     df_id = data.frame("id" = as.numeric(),
#                        "GroupID" = as.numeric(),
#                        "SHOW_TRUST" = as.numeric(),
#                        "SHOW_ID" = as.numeric(),
#                        "R_value" = as.numeric())
#     df_score = data.frame("id" = as.numeric(),
#                           "GroupID" = as.numeric(),
#                           "SHOW_TRUST" = as.numeric(),
#                           "SHOW_ID" = as.numeric(),
#                           "R_value" = as.numeric())
#     df_combine = data.frame("id" = as.numeric(),
#                             "GroupID" = as.numeric(),
#                             "SHOW_TRUST" = as.numeric(),
#                             "SHOW_ID" = as.numeric(),
#                             "R_value" = as.numeric())
#     for (exp_id in 1:num_exp) {
#       if (exp_id == 3) {next()}
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       for (user_id in 1:num_users) {
#         cur_data <- simple_game[simple_game$Type ==type & simple_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      0,
#                      cor(cur_data$PartnerDecision, cur_data$showing_trust_score)
#         )
#         df_simple [nrow(df_simple) + 1,] <- new_row
#         
#         cur_data <- id_game[id_game$Type ==type & id_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      1,
#                      cor(cur_data$PartnerDecision, cur_data$showing_trust_score)
#         )
#         df_id [nrow(df_id) + 1,] <- new_row
#         
#         cur_data <- score_game[score_game$Type ==type & score_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      0,
#                      cor(cur_data$PartnerDecision, cur_data$showing_trust_score)
#         )
#         df_score [nrow(df_score) + 1,] <- new_row
#         
#         cur_data <- combine_game[combine_game$Type ==type & combine_game$Partner == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      1,
#                      cor(cur_data$PartnerDecision, cur_data$showing_trust_score)
#         )
#         df_combine [nrow(df_combine) + 1,] <- new_row
#       }
#     }
#     df_total <- rbind (df_simple, df_id)
#     df_total <- rbind (df_total, df_score)
#     df_total <- rbind (df_total, df_combine)
#     df_total$id <- as.factor (df_total$id)
#     df_total$GroupID <- as.factor (df_total$GroupID)
#     df_total$SHOW_TRUST <- as.factor (df_total$SHOW_TRUST)
#     df_total$SHOW_ID <- as.factor (df_total$SHOW_ID)
#     # df_total$score <- sqrt(df_total$R_value)
#     df_total$score <- df_total$R_value
#     if (any(is.na(df_total$score))) {
#       df_total[is.na(df_total$score),]$score <- 0
#     }
#     # print (df_total)
#     df_total$R_value <- NULL
#     
#     if (any (is.na(df_simple$R_value))) {
#       df_simple[is.na(df_simple$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_id$R_value))) {
#       df_id[is.na(df_id$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_score$R_value))) {
#       df_score[is.na(df_score$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_combine$R_value))) {
#       df_combine[is.na(df_combine$R_value),]$R_value <- 0
#     }
#     
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:SHOW_TRUST:SHOW_ID for type: ", Type_names [(1 -type) + 1]))
#     anova_analysis (df = df_total, type = (1 - type))
#     
#     # Make 2 - way ANOVA analysis
#     # By making a new code: game_pos, which has 4 possible values 1, 2, 3, 4 for 4 games
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:Game_Setting for type: ", Type_names [(1 -type) + 1]))
#     df_total$game_pos <- as.factor (((as.numeric (df_total$SHOW_TRUST) - 1) * 2 + (as.numeric (df_total$SHOW_ID) - 1) + 1))
#     anova_analysis(df_total, num_way = 2, type = (1 - type))
#   }
```

\pagebreak

## Analyze the correlation of behavior on the trust score of partners showed to users

We want to analyze the difference between groups, about the correlation of sending behavior and trust value of the partners.

Temporary disable because regression on 2 trust scores is better.

```{r, echo=FALSE}
#   for (type in 0:1) {
#     df_simple = data.frame("id" = as.numeric(),
#                            "GroupID" = as.numeric(),
#                            "SHOW_TRUST" = as.numeric(),
#                            "SHOW_ID" = as.numeric(),
#                            "R_value" = as.numeric())
#     df_id = data.frame("id" = as.numeric(),
#                        "GroupID" = as.numeric(),
#                        "SHOW_TRUST" = as.numeric(),
#                        "SHOW_ID" = as.numeric(),
#                        "R_value" = as.numeric())
#     df_score = data.frame("id" = as.numeric(),
#                           "GroupID" = as.numeric(),
#                           "SHOW_TRUST" = as.numeric(),
#                           "SHOW_ID" = as.numeric(),
#                           "R_value" = as.numeric())
#     df_combine = data.frame("id" = as.numeric(),
#                             "GroupID" = as.numeric(),
#                             "SHOW_TRUST" = as.numeric(),
#                             "SHOW_ID" = as.numeric(),
#                             "R_value" = as.numeric())
#     for (exp_id in 1:num_exp) {
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       for (user_id in 1:num_users) {
#         cur_data <- simple_game[simple_game$Type ==type & simple_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      0,
#                      cor(cur_data$my_send_proportional, cur_data$showing_trust_score)
#         )
#         df_simple [nrow(df_simple) + 1,] <- new_row
#         
#         cur_data <- id_game[id_game$Type ==type & id_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      1,
#                      cor(cur_data$my_send_proportional, cur_data$showing_trust_score)
#         )
#         df_id [nrow(df_id) + 1,] <- new_row
#         
#         cur_data <- score_game[score_game$Type ==type & score_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      0,
#                      cor(cur_data$my_send_proportional, cur_data$showing_trust_score)
#         )
#         df_score [nrow(df_score) + 1,] <- new_row
#         
#         cur_data <- combine_game[combine_game$Type ==type & combine_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      1,
#                      cor(cur_data$my_send_proportional, cur_data$showing_trust_score)
#         )
#         df_combine [nrow(df_combine) + 1,] <- new_row
#       }
#     }
#     df_total <- rbind (df_simple, df_id)
#     df_total <- rbind (df_total, df_score)
#     df_total <- rbind (df_total, df_combine)
#     df_total$id <- as.factor (df_total$id)
#     df_total$GroupID <- as.factor (df_total$GroupID)
#     df_total$SHOW_TRUST <- as.factor (df_total$SHOW_TRUST)
#     df_total$SHOW_ID <- as.factor (df_total$SHOW_ID)
#     # df_total$score <- sqrt(df_total$R_value)
#     df_total$score <- df_total$R_value
#     if (any(is.na(df_total$score))) {
#       df_total[is.na(df_total$score),]$score <- 0
#     }
#     # print (df_total)
#     df_total$R_value <- NULL
#     
#     if (any (is.na(df_simple$R_value))) {
#       df_simple[is.na(df_simple$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_id$R_value))) {
#       df_id[is.na(df_id$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_score$R_value))) {
#       df_score[is.na(df_score$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_combine$R_value))) {
#       df_combine[is.na(df_combine$R_value),]$R_value <- 0
#     }
#     
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:SHOW_TRUST:SHOW_ID for type: ", Type_names [(1 +type)]))
#     anova_analysis (df = df_total, type = (1 - type))
#     
#     # Make 2 - way ANOVA analysis
#     # By making a new code: game_pos, which has 4 possible values 1, 2, 3, 4 for 4 games
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:Game_Setting for type: ", Type_names [(1 + type)]))
#     df_total$game_pos <- as.factor (((as.numeric (df_total$SHOW_TRUST) - 1) * 2 + (as.numeric (df_total$SHOW_ID) - 1) + 1))
#     anova_analysis(df_total, num_way = 2, type = (1 - type))
#   }
```

\pagebreak

## Analyze the correlation of behavior on the trust score of partners showed to users without Group 3

Temporary remove

```{r, echo=FALSE}
#   for (type in 0:1) {
#     df_simple = data.frame("id" = as.numeric(),
#                            "GroupID" = as.numeric(),
#                            "SHOW_TRUST" = as.numeric(),
#                            "SHOW_ID" = as.numeric(),
#                            "R_value" = as.numeric())
#     df_id = data.frame("id" = as.numeric(),
#                        "GroupID" = as.numeric(),
#                        "SHOW_TRUST" = as.numeric(),
#                        "SHOW_ID" = as.numeric(),
#                        "R_value" = as.numeric())
#     df_score = data.frame("id" = as.numeric(),
#                           "GroupID" = as.numeric(),
#                           "SHOW_TRUST" = as.numeric(),
#                           "SHOW_ID" = as.numeric(),
#                           "R_value" = as.numeric())
#     df_combine = data.frame("id" = as.numeric(),
#                             "GroupID" = as.numeric(),
#                             "SHOW_TRUST" = as.numeric(),
#                             "SHOW_ID" = as.numeric(),
#                             "R_value" = as.numeric())
#     for (exp_id in 1:num_exp) {
#       if (exp_id == 3) {next()}
#       first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
#       last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
#       
#       simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
#       
#       for (user_id in 1:num_users) {
#         cur_data <- simple_game[simple_game$Type ==type & simple_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      0,
#                      cor(cur_data$Contribution, cur_data$showing_trust_score)
#         )
#         df_simple [nrow(df_simple) + 1,] <- new_row
#         
#         cur_data <- id_game[id_game$Type ==type & id_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      0,
#                      1,
#                      cor(cur_data$Contribution, cur_data$showing_trust_score)
#         )
#         df_id [nrow(df_id) + 1,] <- new_row
#         
#         cur_data <- score_game[score_game$Type ==type & score_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      0,
#                      cor(cur_data$Contribution, cur_data$showing_trust_score)
#         )
#         df_score [nrow(df_score) + 1,] <- new_row
#         
#         cur_data <- combine_game[combine_game$Type ==type & combine_game$Subject == user_id,]
#         new_row <- c((exp_id - 1) * num_users + user_id,
#                      exp_id,
#                      1,
#                      1,
#                      cor(cur_data$Contribution, cur_data$showing_trust_score)
#         )
#         df_combine [nrow(df_combine) + 1,] <- new_row
#       }
#     }
#     df_total <- rbind (df_simple, df_id)
#     df_total <- rbind (df_total, df_score)
#     df_total <- rbind (df_total, df_combine)
#     df_total$id <- as.factor (df_total$id)
#     df_total$GroupID <- as.factor (df_total$GroupID)
#     df_total$SHOW_TRUST <- as.factor (df_total$SHOW_TRUST)
#     df_total$SHOW_ID <- as.factor (df_total$SHOW_ID)
#     # df_total$score <- sqrt(df_total$R_value)
#     df_total$score <- df_total$R_value
#     if (any(is.na(df_total$score))) {
#       df_total[is.na(df_total$score),]$score <- 0
#     }
#     # print (df_total)
#     df_total$R_value <- NULL
#     
#     if (any (is.na(df_simple$R_value))) {
#       df_simple[is.na(df_simple$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_id$R_value))) {
#       df_id[is.na(df_id$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_score$R_value))) {
#       df_score[is.na(df_score$R_value),]$R_value <- 0
#     }
#     if (any (is.na(df_combine$R_value))) {
#       df_combine[is.na(df_combine$R_value),]$R_value <- 0
#     }
#     
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:SHOW_TRUST:SHOW_ID for type: ", Type_names [(1 +type)]))
#     anova_analysis (df = df_total, type = (1 - type))
#     
#     # Make 2 - way ANOVA analysis
#     # By making a new code: game_pos, which has 4 possible values 1, 2, 3, 4 for 4 games
#     print (paste("ANOVA analysis of correlation between sending amount and own trust score on Group:Game_Setting for type: ", Type_names [(1 + type)]))
#     df_total$game_pos <- as.factor (((as.numeric (df_total$SHOW_TRUST) - 1) * 2 + (as.numeric (df_total$SHOW_ID) - 1) + 1))
#     anova_analysis(df_total, num_way = 2, type = (1 - type))
#   }
```

\pagebreak

## Analyze on game and group and Tukey test

We analyze the difference between each group for each game

```{r, echo=FALSE}
#   for (type in 0:1) {
#     if (type == 1) {next()}
#     for (game_id in 1:4) {
#       cur_data <- NULL
#       if (game_id == 1) {
#         cur_data <- simple_games[simple_games$Type == type,]
#       }
#       if (game_id == 2) {
#         cur_data <- id_games[id_games$Type == type,]
#       }
#       if (game_id == 3) {
#         cur_data <- score_games[score_games$Type == type,]
#       }
#       if (game_id == 4) {
#         cur_data <- combine_games[combine_games$Type == type,]
#       }
#       # png (paste("./all_data/R_value_Game_",game_id,"_type_", Type_names [(type + 1)],".png"))
#       ys = c (1,2,3,4,5)
#       xs = numeric()
#       
#       # to store confidence interval
#       lowers = numeric()
#       uppers = numeric()
#       
#       all_r = numeric ()
#       all_grp_id = numeric ()
#       for (exp_id in 1:num_exp) {
#         num_per_rounds = num_users * (num_users - 1) * average_rounds / 2
#         first_round = num_per_rounds * (exp_id - 1) + 1
#         last_round = num_per_rounds * exp_id
#         sub_data = cur_data[first_round:last_round,]
#         
#         x <- 0
#         lower <- 0
#         upper <- 0
#         
#         rs <- numeric()
#         
#         for (user_id in 1:num_users) {
#           user_data = sub_data[sub_data$Subject == user_id,]
#           
#           # r = cor (user_data$PartnerDecision, user_data$showing_trust_score)
#           r = user_data$Contribution
#           if (is.na(r)) {
#             r = 0
#           }
#           rs <- c(rs, r)
#           all_r <- c (all_r, r)
#           for (i in 1:length(r)) {
#             all_grp_id <- c(all_grp_id, exp_id)
#           }
#         }
#         
#         # Make scaling
#         rs <- scale(rs)
#         
#         x = mean (rs)
#         lower = x - pop.sd (rs)
#         upper = x + pop.sd (rs)
#         
#         if (is.na(x)) {
#           x = 0
#         }
#         xs <- c(xs, x)
#         if (is.na(lower)) {
#           lower = 0
#         }
#         if (is.na(upper)) {
#           upper = 0
#         }
#         lowers <- c(lowers, lower)
#         uppers <- c(uppers, upper)
#       }
#       
#       all_r <- make_scale (all_r, num_grp = num_exp)
#       
#       if (type == 0) {
#         # Do Tukey test
#         print (paste ("Absolute sending - Game: ", game_id, " for SENDERs"))
#         print ("*********")
# #         print (all_r)
# #         print (all_grp_id)
#         aov1 <- aov (lm (all_r ~ as.factor(all_grp_id)))
#         print (TukeyHSD(aov1))
#       }
#       plot(xs, main = paste("Abs sending of Game ", game_id, " type: ", Type_names [(type + 1)]), xlab = "Group ID", ylab = "scale abs sending", ylim = c(-5,5))
#       for (exp_id in 1:num_exp) {
#         segments (x0 = exp_id, y0 = lowers[exp_id], x1 = exp_id, y1 = uppers[exp_id])
#         epsilon <- 0.02
#         segments (x0 = exp_id - epsilon, y0 = lowers[exp_id], x1 = exp_id + epsilon, y1 = lowers[exp_id])
#         segments (x0 = exp_id - epsilon, y0 = uppers[exp_id], x1 = exp_id + epsilon, y1 = uppers[exp_id])
#       }
#       # dev.off()
#     }
#   }
```


\pagebreak

##Plotting data

We plot absolute sending, relative sending and profit for each games, using standard error bars display.

```{r echo=FALSE}
  #Each of parameter should be a vector of value for a corresponding game
plotGameMetrics <- function (game_simple, game_id, game_score, game_combine, metric_name) {
  means = c(mean(game_simple), mean (game_id), mean (game_score), mean (game_combine))
  std_errors = c(pop.sd(game_simple)/sqrt(length((game_simple))), 
                 pop.sd(game_id)/sqrt(length((game_id))),
                 pop.sd(game_score)/sqrt(length((game_score))),
                 pop.sd(game_combine)/sqrt(length((game_combine))))
  show_trusts = c(1,1,2,2)
  plot (show_trusts, means, main = "", xlim = c(1,2.2), ylim = c(min(means) * 0.9, max(means) * 1.1), ylab = metric_name, xaxt = "n", xlab = "", cex.lab=1.5, cex.axis = 1)
  axis(1, at=1:2, labels= c("Without Trust","With Trust"), cex.lab=1.5, cex.axis=1.5)
  epsilon <- 0.02
  segments(show_trusts,means-std_errors,show_trusts,means+std_errors)
  segments(show_trusts-epsilon,means-std_errors,show_trusts+epsilon,means-std_errors)
  segments(show_trusts-epsilon,means+std_errors,show_trusts+epsilon,means+std_errors)
  segments(show_trusts[1], means[1], show_trusts[3], means[3], col = "red", lwd = 2)
  segments(show_trusts[2], means[2], show_trusts[4], means[4], col = "blue", lwd = 3, lty = 2)
  legend(1.5, max(means) * 0.7,
         c ("With ID", "Without ID"),
         lty = c(2,1),
         lwd = c(3,2),
         col = c("blue","red"),
         cex=1.5
  )
}
```

```{r}
  plotGameMetrics (simple_games$Contribution, 
                   id_games$Contribution, 
                   score_games$Contribution, 
                   combine_games$Contribution, 
                   metric_name = "Net Sending Amount")
  plotGameMetrics (simple_games[simple_games$my_send_proportional >= 0,]$my_send_proportional * 100, 
                   id_games[id_games$my_send_proportional >= 0,]$my_send_proportional * 100, 
                   score_games[score_games$my_send_proportional >= 0,]$my_send_proportional * 100, 
                   combine_games[combine_games$my_send_proportional >= 0,]$my_send_proportional * 100, 
                   metric_name = "Sending Percentage (%)")
  plotGameMetrics (simple_games$CurrGameProfit, id_games$CurrGameProfit, score_games$CurrGameProfit, combine_games$CurrGameProfit, metric_name = "Profit per games")
```

\pagebreak

Date: Tue 7-Jun-2017

We divide the measure for sender and receiver and plot them separately

```{r echo=FALSE}
  plotGameMetrics (simple_games[simple_games$Type == 0,]$Contribution, 
                   id_games[id_games$Type == 0,]$Contribution, 
                   score_games[score_games$Type == 0,]$Contribution, 
                   combine_games[combine_games$Type == 0,]$Contribution, 
                   metric_name = "Net Sending Amount")

  plotGameMetrics (simple_games[simple_games$Type == 1 & simple_games$my_send_proportional >= 0,]$Contribution, 
                   id_games[id_games$Type == 1 & id_games$my_send_proportional >= 0,]$Contribution, 
                   score_games[score_games$Type == 1 & score_games$my_send_proportional >= 0,]$Contribution, 
                   combine_games[combine_games$Type == 1 & combine_games$my_send_proportional >= 0,]$Contribution, 
                   metric_name = "Net Sending Amount")
  
  plotGameMetrics (simple_games[simple_games$Type == 0 & simple_games$my_send_proportional >= 0,]$my_send_proportional, 
                   id_games[id_games$Type == 0 & id_games$my_send_proportional >= 0,]$my_send_proportional, 
                   score_games[score_games$Type == 0 & score_games$my_send_proportional >= 0,]$my_send_proportional, 
                   combine_games[combine_games$Type == 0 & combine_games$my_send_proportional >= 0,]$my_send_proportional, 
                   metric_name = "Sending Proportion")
  
  plotGameMetrics (simple_games[simple_games$Type == 1 & simple_games$my_send_proportional >= 0,]$my_send_proportional, 
                   id_games[id_games$Type == 1 & id_games$my_send_proportional >= 0,]$my_send_proportional, 
                   score_games[score_games$Type == 1 & score_games$my_send_proportional >= 0,]$my_send_proportional, 
                   combine_games[combine_games$Type == 1 & combine_games$my_send_proportional >= 0,]$my_send_proportional, 
                   metric_name = "Sending Proportion")
```

\pagebreak

# Comparing data

## Giangiacomo

We also collected data from another repeated simple games done by "Bravo, Giangiacomo, Flaminio Squazzoni, and Riccardo Boero. "Trust and partner selection in social networks: An experimentally grounded model." Social Networks 34, no. 4 (2012): 481-492." and we want to compare them.

```{r}
    require (BSDA)
    data2 <- read.csv ("./all_data/Data2.csv")
    
    # id: participant id
    # BS: the session was performed in Brescia
    # CN: the session was performed in Cuneo
    # type: 1 = player A; 2 =  player B (role definition in the article)
    # daAaB: amount invested
    # daBaA: amount returned
    # actualDaAaB: amount invested by the opponent when playing as B
    # actualDaBaA: amount returned by the opponent when playing as A
    # prevA: amount received last time the subject played as A (= last non NA actualDaBaA)
    # prevB: amount received last time the subject played as B (= last non NA actualDaAaB)

    
    
    # Convert ID to universal ID
    data2$id <- data2$id + (as.numeric(data2$treatment) - 1) * 36
    
    data2$send_proportion <- ifelse(data2$type == 1, data2$daAaB/10, data2$daBaA / 3 / data2$actualDaAaB)
    data2$send_proportion <- ifelse(data2$send_proportion > 1, 1, data2$send_proportion)
    
    means <- as.numeric()
    std_errors <- as.numeric ()
    
    # print ("Comparing two dataset for SENDERs")
#     print (z.test(data2[!is.na(data2$daAaB),]$daAaB,  sigma.x = 6.8))
#     print (z.test(simple_games[simple_games$Type == 0,]$Contribution, sigma.x = 6.8))
    
    # For our simple game senders
    sent1 = aggregate(simple_games[simple_games$Type == 0,]$Contribution, list(simple_games[simple_games$Type == 0,]$Subject, simple_games[simple_games$Type == 0,]$Date), mean)
    means = c(means, mean(sent1$x))
    std_errors = c(std_errors, pop.sd(sent1$x)/sqrt(length(sent1$x)))
    
    # For Giangiacomo senders
    sent2 = aggregate(data2[!is.na(data2$daAaB),]$daAaB, list(data2[!is.na(data2$daAaB),]$id), mean)
    means = c(means, mean(sent2$x))
    std_errors = c(std_errors, pop.sd(sent2$x)/sqrt(length(sent2$x)))
    
    # Compare data
    print(t.test(sent1$x, sent2$x))
    
    # print ("Comparing two dataset for RECEIVERs")
#     print (z.test(data2[!is.na(data2$daBaA),]$daBaA,  sigma.x = 6.8))
#     print (z.test(simple_games[simple_games$Type == 1,]$Contribution, sigma.x = 6.8))
    
    # For our simple game receivers
    sent1 = aggregate(simple_games[simple_games$Type == 1,]$Contribution, list(simple_games[simple_games$Type == 1,]$Subject, simple_games[simple_games$Type == 1,]$Date), mean)
    means = c(means, mean(sent1$x))
    std_errors = c(std_errors, pop.sd(sent1$x)/sqrt(length(sent1$x)))
    
    # For Giangiacomo receivers
    sent2 = aggregate(data2[!is.na(data2$daBaA),]$daBaA, list(data2[!is.na(data2$daBaA),]$id), mean)
    means = c(means, mean(sent2$x))
    std_errors = c(std_errors, pop.sd(sent2$x)/sqrt(length(sent2$x)))
    
    print(t.test(sent1$x, sent2$x))
    
    # Plotting comparison
    xs = c (0.75,1.25,2.75,3.25)
    # plot (x = xs, y = means, ylab = "Average sending amount", main = "Comparing two datasets w/standard errors", xaxt = "n", xlim = c(0,8), ylim = c(0,4), xlab = "")
    plot (x = xs, y = means, ylab = "Average sending amount", main = "Comparing Simple Game data", xaxt = "n", xlim = c(0,8), ylim = c(0,4), xlab = "")
    axis(1, at=1:5, labels= c("Sender","","Receiver","",""), las = 2)
    segments(x0 = 0.75, y0 = means[1] - std_errors[1], x1 = 0.75, y1 = means[1] + std_errors[1], col = "red")
    segments(x0 = 0.7, y0 = means[1] - std_errors[1], x1 = 0.8, y1 = means[1] - std_errors[1], col = "red")
    segments(x0 = 0.7, y0 = means[1] + std_errors[1], x1 = 0.8, y1 = means[1] + std_errors[1], col = "red")
    
    segments(x0 = 1.25, y0 = means[2] - std_errors[2], x1 = 1.25, y1 = means[2] + std_errors[2], col = "blue", lty = 2)
    segments(x0 = 1.2, y0 = means[2] - std_errors[2], x1 = 1.3, y1 = means[2] - std_errors[2], col = "blue")
    segments(x0 = 1.2, y0 = means[2] + std_errors[2], x1 = 1.3, y1 = means[2] + std_errors[2], col = "blue")
    
    segments(x0 = 2.75, y0 = means[3] - std_errors[3], x1 = 2.75, y1 = means[3] + std_errors[3], col = "red")
    segments(x0 = 2.7, y0 = means[3] - std_errors[3], x1 = 2.8, y1 = means[3] - std_errors[3], col = "red")
    segments(x0 = 2.7, y0 = means[3] + std_errors[3], x1 = 2.8, y1 = means[3] + std_errors[3], col = "red")
    
    segments(x0 = 3.25, y0 = means[4] - std_errors[4], x1 = 3.25, y1 = means[4] + std_errors[4], col = "blue", lty = 2)
    segments(x0 = 3.2, y0 = means[4] - std_errors[4], x1 = 3.3, y1 = means[4] - std_errors[4], col = "blue")
    segments(x0 = 3.2, y0 = means[4] + std_errors[4], x1 = 3.3, y1 = means[4] + std_errors[4], col = "blue")
    
    legend(4, max(means) * 1.05,
           c ("Our data", "Bravo's data"),
           lty = c(1,2),
           lwd = c(3,2),
           col = c("red","blue"))
  
```

\pagebreak

## Dubois

Analyze group effect of Dubois's data

```{r}
  dubois <- read.csv("./all_data/data_dubois.csv", sep = ";")
  dubois$group <- dubois$group + dubois$treatment * 6
  dubois$player_uid <- dubois$player_uid + dubois$treatment * 36
  dubois$group <- as.factor(dubois$group)
  dubois$treatment <- as.factor(dubois$treatment)
  dubois$player_uid <- as.factor(dubois$player_uid)
  
  # Anova analysis per each interaction
#   res1 <- lm (sent ~ treatment + treatment/group, data = dubois)
#   print ("Per interaction")
#   print (anova(res1))
  
  # Anova analysis per each user
  user_sent <- as.vector (aggregate(dubois$sent, list(dubois$player_uid), mean)[,'x'])
  user_sent_back <- as.vector(aggregate(dubois$sent_back, list(dubois$player_uid), mean)[,'x'])
  user_reciprocity <- as.vector (aggregate(dubois$sent_back/dubois$received, list(dubois$player_uid), mean, na.rm = TRUE)[,'x'])
  user_sender_payoff <- as.vector(aggregate(dubois$returned - dubois$sent, list(dubois$player_uid), mean, na.rm = TRUE)[,'x'])
  user_receiver_payoff <- as.vector(aggregate(dubois$received - dubois$sent_back, list(dubois$player_uid), mean, na.rm = TRUE)[,'x'])
  treatment <- as.factor (c(rep(0,36), rep (1, 36), rep(2,36)))
  group <- as.factor (rep (1:18, each = 6))
  
  res2 <- lm (user_sent ~ treatment + treatment/group)
  a <- anova(res2)
  a$`F value`[1] <- (a$`Sum Sq`[1]/a$Df[1]) / (a$`Sum Sq`[2]/a$Df[2])
  a$`Pr(>F)`[1] <- 1 - pf (a$`F value`[1], df1 = a$Df[1], df2 = a$Df[2])
  print (a)
  
  res2 <- lm (user_reciprocity ~ treatment + treatment/group)
  a <- anova(res2)
  a$`F value`[1] <- (a$`Sum Sq`[1]/a$Df[1]) / (a$`Sum Sq`[2]/a$Df[2])
  a$`Pr(>F)`[1] <- 1 - pf (a$`F value`[1], df1 = a$Df[1], df2 = a$Df[2])
  print (a)
  
  res2 <- lm (user_sender_payoff ~ treatment + treatment/group)
  a <- anova(res2)
  a$`F value`[1] <- (a$`Sum Sq`[1]/a$Df[1]) / (a$`Sum Sq`[2]/a$Df[2])
  a$`Pr(>F)`[1] <- 1 - pf (a$`F value`[1], df1 = a$Df[1], df2 = a$Df[2])
  print (a)
  
  res2 <- lm (user_receiver_payoff ~ treatment + treatment/group)
  a <- anova(res2)
  a$`F value`[1] <- (a$`Sum Sq`[1]/a$Df[1]) / (a$`Sum Sq`[2]/a$Df[2])
  a$`Pr(>F)`[1] <- 1 - pf (a$`F value`[1], df1 = a$Df[1], df2 = a$Df[2])
  print (a)
```

### Comparing Dubois data

```{r, echo=FALSE}
  for (type in 0:1) {
    data_dubois <- as.numeric()
    if (type == 0) {
      data_dubois <- user_sent / 10
    }
    else if (type == 1) {
      data_dubois <- user_reciprocity
    }
    
    means <- as.numeric()
    stds <- as.numeric()
    
    means <- c(means, mean (simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]$my_send_proportional))
    stds <- c(stds, pop.sd (simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]$my_send_proportional)/sqrt(30))
    
    means <- c(means, mean (data_dubois[1:36]))
    stds <- c(stds, pop.sd (data_dubois[1:36]) / sqrt(36))
    
    means <- c(means, mean (id_games[id_games$Type == type & id_games$my_send_proportional >= 0,]$my_send_proportional))
    stds <- c(stds, pop.sd (id_games[id_games$Type == type & id_games$my_send_proportional >= 0,]$my_send_proportional)/sqrt(30))
    
    means <- c(means, mean (data_dubois[7:72]))
    stds <- c(stds, pop.sd (data_dubois[7:72])/ sqrt(36))
    
    means <- c(means, mean (score_games[score_games$Type == type & score_games$my_send_proportional >= 0,]$my_send_proportional))
    stds <- c(stds, pop.sd (score_games[score_games$Type == type & score_games$my_send_proportional >= 0,]$my_send_proportional)/sqrt(30))
    
    means <- c(means, mean (data_dubois[73:108]))
    stds <- c(stds, pop.sd (data_dubois[73:108])/ sqrt(36))
    
    means <- c(means, mean (combine_games[combine_games$Type == type & combine_games$my_send_proportional >= 0,]$my_send_proportional))
    stds <- c(stds, pop.sd (combine_games[combine_games$Type == type & combine_games$my_send_proportional >= 0,]$my_send_proportional)/sqrt(30))
    
    # Plot data
    games = 1:7
    plot(x=means, y=games, main = paste("Compare with Dubois of type ", Type_names[type + 1]), xlab = "Send proportion", ylab = "", yaxt = "n", xlim = c(0,1))
    axis(2, at=1:7, labels= c("Simple","NI","ID","TI","Score","TTI", "Combine"), las = 1)
    for (i in 1:7) {
      segments(x0 = (means[i] - stds[i]), y0 = i, x1 = (means[i] + stds[i]), y1 = i)
      epsilon = 0.1
      segments(x0 = (means[i] - stds[i]), y0 = i + epsilon, x1 = (means[i] - stds[i]), y1 = i - epsilon)
      segments(x0 = (means[i] + stds[i]), y0 = i + epsilon, x1 = (means[i] + stds[i]), y1 = i - epsilon)
    }
    cat("\n\n\\pagebreak\n")
  }
```


```{r}
# Plot send proportion for three datasets
# Date: Thu 12-Jun-2017
require(plotrix)
  means <- c()
  std_errors <- c()
  for (type in 0:1) {
    
    data_dubois <- as.numeric()
    if (type == 0) {
      data_dubois <- user_sent[1:36]/10
    } else if (type == 1) {
      data_dubois <- user_reciprocity[1:36]
    }
    # Our data
    our_data <- simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]
    our_send_proportion <- aggregate(our_data$my_send_proportional, list(our_data$Subject, our_data$Date), mean)$x
    
    means <- c(means, mean (our_send_proportion))
    std_errors <- c(std_errors, pop.sd(simple_games[simple_games$Type == type & simple_games$my_send_proportional >= 0,]$my_send_proportional)/sqrt(30))
    
    # Dubois
    means <- c(means, mean (data_dubois[1:36]))
    std_errors <- c(std_errors, pop.sd(data_dubois[1:36])/sqrt(36))
    
    # Bravo
    bravo <- data2
    bravo_send_proportion <- aggregate(bravo[bravo$type == type+1 & !is.na(bravo$send_proportion),]$send_proportion, list(bravo[bravo$type == type+1 & !is.na(bravo$send_proportion),]$id), mean)$x
    means <- c(means, mean(bravo_send_proportion))
    std_errors <- c(std_errors, pop.sd(bravo_send_proportion)/sqrt(108))
    
    print (paste("t-test between send proportions:", Type_names[type+1]))
    
    print ("With Dubois")
    print(t.test(our_send_proportion, data_dubois))
    
    print ("With Bravo")
    bravo_send_proportion <- aggregate(bravo[bravo$type == type+1 & !is.na(bravo$send_proportion),]$send_proportion, list(bravo[bravo$type == type+1 & !is.na(bravo$send_proportion),]$id), mean)$x
    print (t.test (our_send_proportion, bravo_send_proportion))
    
  }  
  
  xs = c (0.75,1,1.25, 2.75,3,3.25)
    # plot (x = xs, y = means, ylab = "Average sending amount", main = "Comparing two datasets w/standard errors", xaxt = "n", xlim = c(0,8), ylim = c(0,4), xlab = "")
    plot (x = xs, y = means, ylab = "Send proportion", main = "", xaxt = "n", xlim = c(0,7), ylim = c(0.1,.5), xlab = "")
    axis(1, at=1:5, labels= c("Sender","","Receiver","",""), las = 2)
    #Our data
    segments(x0 = 0.75, y0 = means[1] - std_errors[1], x1 = 0.75, y1 = means[1] + std_errors[1], col = "red")
    segments(x0 = 0.7, y0 = means[1] - std_errors[1], x1 = 0.8, y1 = means[1] - std_errors[1], col = "red")
    segments(x0 = 0.7, y0 = means[1] + std_errors[1], x1 = 0.8, y1 = means[1] + std_errors[1], col = "red")
    
    #Dubois
    segments(x0 = 1, y0 = means[2] - std_errors[2], x1 = 1, y1 = means[2] + std_errors[2], col = "blue", lty = 2)
    segments(x0 = 0.95, y0 = means[2] - std_errors[2], x1 = 1.05, y1 = means[2] - std_errors[2], col = "blue")
    segments(x0 = 0.95, y0 = means[2] + std_errors[2], x1 = 1.05, y1 = means[2] + std_errors[2], col = "blue")
    
    #Bravo
    segments(x0 = 1.25, y0 = means[3] - std_errors[3], x1 = 1.25, y1 = means[3] + std_errors[3], col = "black", lty = 3)
    segments(x0 = 1.2, y0 = means[3] - std_errors[3], x1 = 1.3, y1 = means[3] - std_errors[3], col = "black")
    segments(x0 = 1.2, y0 = means[3] + std_errors[3], x1 = 1.3, y1 = means[3] + std_errors[3], col = "black")
    
    #our
    segments(x0 = 2.75, y0 = means[4] - std_errors[4], x1 = 2.75, y1 = means[4] + std_errors[4], col = "red")
    segments(x0 = 2.7, y0 = means[4] - std_errors[4], x1 = 2.8, y1 = means[4] - std_errors[4], col = "red")
    segments(x0 = 2.7, y0 = means[4] + std_errors[4], x1 = 2.8, y1 = means[4] + std_errors[4], col = "red")
    
    #Dubois
    segments(x0 = 3, y0 = means[5] - std_errors[5], x1 = 3, y1 = means[5] + std_errors[5], col = "blue", lty = 2)
    segments(x0 = 2.95, y0 = means[5] - std_errors[5], x1 = 3.05, y1 = means[5] - std_errors[5], col = "blue")
    segments(x0 = 2.95, y0 = means[5] + std_errors[5], x1 = 3.05, y1 = means[5] + std_errors[5], col = "blue")
    
    #Bravo
    segments(x0 = 3.25, y0 = means[6] - std_errors[6], x1 = 3.25, y1 = means[6] + std_errors[6], col = "black", lty = 3)
    segments(x0 = 3.2, y0 = means[6] - std_errors[6], x1 = 3.3, y1 = means[6] - std_errors[6], col = "black")
    segments(x0 = 3.2, y0 = means[6] + std_errors[6], x1 = 3.3, y1 = means[6] + std_errors[6], col = "black")
    
    legend(4, max(means) * 1.05,
           c ("Our data", "Dubois's data", "Bravo's data"),
           lty = c(1,2,3),
           lwd = c(1,1,1),
           col = c("red","blue","black"))
```


## Plot net sending amount of three datasets in one figure

``` {r, echo=FALSE}
    means <- as.numeric()
    std_errors <- as.numeric ()
    
    # print ("Comparing two dataset for SENDERs")
#     print (z.test(data2[!is.na(data2$daAaB),]$daAaB,  sigma.x = 6.8))
#     print (z.test(simple_games[simple_games$Type == 0,]$Contribution, sigma.x = 6.8))
    
    # For our simple game senders
    sent1 = aggregate(simple_games[simple_games$Type == 0,]$Contribution, list(simple_games[simple_games$Type == 0,]$Subject, simple_games[simple_games$Type == 0,]$Date), mean)
    means = c(means, mean(sent1$x))
    std_errors = c(std_errors, pop.sd(sent1$x)/sqrt(length(sent1$x)))
    
    # For Giangiacomo senders
    sent2 = aggregate(data2[!is.na(data2$daAaB),]$daAaB, list(data2[!is.na(data2$daAaB),]$id), mean)
    means = c(means, mean(sent2$x))
    std_errors = c(std_errors, pop.sd(sent2$x)/sqrt(length(sent2$x)))
    
    # For Dubois senders
    sent3 = user_sent[1:36]
    means = c(means, mean(sent3))
    std_errors = c(std_errors, pop.sd(sent3)/sqrt(length(sent3)))
    
    # Compare data
    print ("Test sending amount of senders")
    print(t.test(sent1$x, sent2$x))
    print(t.test (sent1$x, sent3))
    
    # For our simple game receivers
    sent1 = aggregate(simple_games[simple_games$Type == 1,]$Contribution, list(simple_games[simple_games$Type == 1,]$Subject, simple_games[simple_games$Type == 1,]$Date), mean)
    means = c(means, mean(sent1$x))
    std_errors = c(std_errors, pop.sd(sent1$x)/sqrt(length(sent1$x)))
    
    # For Giangiacomo receivers
    sent2 = aggregate(data2[!is.na(data2$daBaA),]$daBaA, list(data2[!is.na(data2$daBaA),]$id), mean)
    means = c(means, mean(sent2$x))
    std_errors = c(std_errors, pop.sd(sent2$x)/sqrt(length(sent2$x)))
    
    # For Dubois receivers
    sent3 = user_sent_back[1:36]
    means = c(means, mean(sent3))
    std_errors = c(std_errors, pop.sd(sent3)/sqrt(length(sent3)))
    
    print ("Compare sending amount of receivers")
    print(t.test(sent1$x, sent2$x))
    print(t.test (sent1$x, sent3/10))
    
    # Plotting comparison
    # xs = c (0.75,1.25,2.75,3.25)
    xs = c(0.75, 1, 1.25, 2.75,3,3.25)
    # plot (x = xs, y = means, ylab = "Average sending amount", main = "Comparing two datasets w/standard errors", xaxt = "n", xlim = c(0,8), ylim = c(0,4), xlab = "")
    plot (x = xs, y = means, ylab = "Average net sending amount", main = "", xaxt = "n", xlim = c(0,5), ylim = c(0,4), xlab = "", cex.lab=1.5, cex.axis=1.5)
    axis(1, at=1:5, labels= c("Sender","","Receiver","",""), las = 1, tick = FALSE, cex.axis=1.5)
    segments(x0 = 0.75, y0 = means[1] - std_errors[1], x1 = 0.75, y1 = means[1] + std_errors[1], col = "red")
    segments(x0 = 0.7, y0 = means[1] - std_errors[1], x1 = 0.8, y1 = means[1] - std_errors[1], col = "red")
    segments(x0 = 0.7, y0 = means[1] + std_errors[1], x1 = 0.8, y1 = means[1] + std_errors[1], col = "red")
    
    segments(x0 = 1, y0 = means[2] - std_errors[2], x1 = 1, y1 = means[2] + std_errors[2], col = "black", lty = 3)
    segments(x0 = 0.95, y0 = means[2] - std_errors[2], x1 = 1.05, y1 = means[2] - std_errors[2], col = "black")
    segments(x0 = 0.95, y0 = means[2] + std_errors[2], x1 = 1.05, y1 = means[2] + std_errors[2], col = "black")
    
    segments(x0 = 1.25, y0 = means[3] - std_errors[3], x1 = 1.25, y1 = means[3] + std_errors[3], col = "blue", lty = 2)
    segments(x0 = 1.2, y0 = means[3] - std_errors[3], x1 = 1.3, y1 = means[3] - std_errors[3], col = "blue")
    segments(x0 = 1.2, y0 = means[3] + std_errors[3], x1 = 1.3, y1 = means[3] + std_errors[3], col = "blue")
    
    
    
    segments(x0 = 2.75, y0 = means[4] - std_errors[4], x1 = 2.75, y1 = means[4] + std_errors[4], col = "red")
    segments(x0 = 2.7, y0 = means[4] - std_errors[4], x1 = 2.8, y1 = means[4] - std_errors[4], col = "red")
    segments(x0 = 2.7, y0 = means[4] + std_errors[4], x1 = 2.8, y1 = means[4] + std_errors[4], col = "red")
    
    segments(x0 = 3, y0 = means[5] - std_errors[5], x1 = 3, y1 = means[5] + std_errors[5], col = "black", lty = 3)
    segments(x0 = 2.95, y0 = means[5] - std_errors[5], x1 = 3.05, y1 = means[5] - std_errors[5], col = "black")
    segments(x0 = 2.95, y0 = means[5] + std_errors[5], x1 = 3.05, y1 = means[5] + std_errors[5], col = "black")
    
    segments(x0 = 3.25, y0 = means[6] - std_errors[6], x1 = 3.25, y1 = means[6] + std_errors[6], col = "blue", lty = 2)
    segments(x0 = 3.2, y0 = means[6] - std_errors[6], x1 = 3.3, y1 = means[6] - std_errors[6], col = "blue")
    segments(x0 = 3.2, y0 = means[6] + std_errors[6], x1 = 3.3, y1 = means[6] + std_errors[6], col = "blue")
    
    legend(1, 1.5,
           c ("Our data", "Dubois's data","Bravo's data"),
           lty = c(1,3,2),
           lwd = c(2,2,2),
           col = c("red","black","blue"),
           cex=1.5)
```
\pagebreak

## Behavior over time

After reading the questionnaire, there is a hypothesis that, people send less in the end of game (i.e, people learn the length of the game and adapt to the game). However, after running the regression test between sending behavior and period, there is no evidence to prove the hypothesis.

```{r, echo=FALSE}
for (type in 0:1) {
  df_lm <- data.frame ("id" = as.numeric(),
                       "GroupID" = as.numeric(),
                       "SHOW_TRUST" = as.numeric(),
                       "SHOW_ID" = as.numeric(),
                       "slope" = as.numeric(),
                       "intercept" = as.numeric(),
                       "r_squared" = as.numeric(),
                       "p_value" = as.numeric(),
                       "r_value" = as.numeric(),
                       "r_value_2" = as.numeric()    
                       )
  
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        send_behavior = simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >=0 & simple_game$Type == type,]$my_send_proportional
        rounds <- simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >=0 & simple_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >=0 & simple_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     0,
                     0,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5),
                     round(cor(send_behavior, trusts), digits = 5)
                     )
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        send_behavior = id_game[id_game$Subject == user_id & id_game$my_send_proportional >=0 & id_game$Type == type,]$my_send_proportional
        rounds <- id_game[id_game$Subject == user_id & id_game$my_send_proportional >=0 & id_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- id_game[id_game$Subject == user_id & id_game$my_send_proportional >=0 & id_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     0,
                     1,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5),
                     round(cor(send_behavior, trusts), digits = 5)
                     )
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        send_behavior = score_game[score_game$Subject == user_id & score_game$my_send_proportional >=0 & score_game$Type == type,]$my_send_proportional
        rounds <- score_game[score_game$Subject == user_id & score_game$my_send_proportional >=0 & score_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- score_game[score_game$Subject == user_id & score_game$my_send_proportional >=0 & score_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     1,
                     0,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5),
                     round(cor(send_behavior, trusts), digits = 5)
                     )
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        send_behavior = combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >=0 & combine_game$Type == type,]$my_send_proportional
        rounds <- combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >=0 & combine_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >=0 & combine_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     1,
                     1,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5),
                     round(cor(send_behavior, trusts), digits = 5))
        df_lm[(nrow(df_lm) + 1),] <- new_row
      }
  }
  
  # Plotting r_value of r_value of behavior on round numbers and trust of partner
  plot (y = df_lm$r_value_2, x = df_lm$r_value, main = paste ("r_value of behavior over time of ", Type_names[type + 1]), xlab = "r_value of Round No", ylab = "r_value of trust of partners", pch = 16,
          col = ifelse (df_lm$SHOW_TRUST == 0 & df_lm$SHOW_ID == 0, "red",
                        ifelse(df_lm$SHOW_TRUST == 0 & df_lm$SHOW_ID == 1, "orange", 
                               ifelse(df_lm$SHOW_TRUST == 1 & df_lm$SHOW_ID == 0, "blue","green"))))
  legend(x=-0.08,y=2.5,c("Simple","ID","Score","Combine"),cex=.8, 
        col=c("red","orange","blue","green"),pch=16, bg = "white")
    
  #Make transformation
  df_lm$significane <- ifelse(df_lm$p_value <= 0.1, 1, 0)
  df_lm$slope <- df_lm$slope * df_lm$significane
  df_lm$intercept <- df_lm$intercept * df_lm$significane
  df_lm$r_value <- df_lm$r_value * df_lm$significane
  df_lm$r_squared <- NULL
  df_lm$significane <- ifelse (df_lm$p_value <= 0.05, "*", ifelse (df_lm$p_value <= 0.1, ".", ""))
  df_lm$p_value <- NULL
  
  # print (df_lm)
  
  sum_df_lm <- data.frame ("metric" <- as.character(),
                            "criteria" <- as.character(),
                           "Mean" <- as.numeric(),
                           "std" <- as.numeric(), stringsAsFactors = FALSE)
  
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Slope",
                                          "Without trust",
                                          round(mean(df_lm[df_lm$slope > 0 & df_lm$SHOW_TRUST == 0,]$slope, na.rm = TRUE), digits = 5),
                                          round(pop.sd(df_lm[df_lm$slope > 0 & df_lm$SHOW_TRUST == 0,]$slope), digits = 5))
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Slope",
                                        "With trust",
                                          round (mean(df_lm[df_lm$slope > 0 & df_lm$SHOW_TRUST == 1,]$slope, na.rm = TRUE), digits =  5),
                                          round (pop.sd(df_lm[df_lm$slope > 0 & df_lm$SHOW_TRUST == 1,]$slope), digits = 5))
  
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Intercept",
                                          "Without trust",
                                          round (mean(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 0,]$intercept, na.rm = TRUE), digits = 5),
                                          round (pop.sd(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 0,]$intercept), digits = 5))
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Intercept",
                                        "With trust",
                                          round (mean(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 1,]$intercept, na.rm = TRUE), digits = 5),
                                          round (pop.sd(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 1,]$intercept), digits = 5))
  
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                          "Without trust",
                                          round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 0,]$r_value, na.rm = TRUE), digits = 5),
                                          round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 0,]$r_value), digits = 5))
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                        "With trust",
                                          round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 1,]$r_value, na.rm = TRUE), digits = 5),
                                          round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 1,]$r_value), digits = 5))
  
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                          "Without ID",
                                          round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 0,]$r_value, na.rm = TRUE), digits = 5),
                                          round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 0,]$r_value), digits = 5))
  sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                        "With ID",
                                          round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 1,]$r_value, na.rm = TRUE), digits = 2),
                                          round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 1,]$r_value), digits = 2))
  
  colnames(sum_df_lm) <- c("","metric" <- as.character(),
                            "criteria" <- as.character(),
                           "Mean" <- as.numeric(),
                           "std" <- as.numeric())
  print (sum_df_lm)
      
  df_lm$id <- as.factor(df_lm$id)
  df_lm$SHOW_TRUST <- as.factor(df_lm$SHOW_TRUST)
  df_lm$SHOW_ID <- as.factor (df_lm$SHOW_ID)
  df_lm$GroupID <- as.factor(df_lm$GroupID)
  
  print ("Anova analysis for slope")
  df_lm$score <- df_lm$slope 
  anova_analysis(df = df_lm, type = type, num_way = 3)
  
  print ("Anova analysis for intercept")
  df_lm$score <- df_lm$intercept 
  anova_analysis(df = df_lm, type = type, num_way = 3)
  
  print ("Anova analysis for R value")
  df_lm$score <- df_lm$r_value 
  anova_analysis(df = df_lm, type = type, num_way = 3)
  
  cat("\n\n\\pagebreak\n")
}
```

\pagebreak

```{r, echo=FALSE}
  # Plot behavior of each game by rounds
for (type in 0:1) {
  send_behavior <- as.numeric()
  for (i in 1:(average_rounds*(num_users - 1))) {
    send_behavior <- c(send_behavior, mean (simple_games[simple_games$Period == i & simple_games$my_send_proportional >= 0 & simple_games$Type == type,]$my_send_proportional))
  }
  plot (send_behavior, main = (paste("Sending behavior of Simple Games over time of: ", Type_names[(type + 1)])), xlab = "Rounds", ylab = "Sending proportion", ylim = c(0,1))
  lines(send_behavior, col = "red")
  rounds <- 1:length(send_behavior)
  reg1 <- lm (send_behavior ~ rounds)
  abline(reg1)
  cat("\n\n\\pagebreak\n")
}
```
  
\pagebreak  

```{r,echo=FALSE}
for (type in 0:1) {
  send_behavior <- as.numeric()
  for (i in 1:(average_rounds*(num_users - 1))) {
    send_behavior <- c(send_behavior, mean (id_games[id_games$Period == i & id_games$my_send_proportional >= 0 & id_games$Type == type,]$my_send_proportional))
  }
  plot (send_behavior, main = (paste("Sending behavior of ID Games over time of: ", Type_names[(type + 1)])), xlab = "Rounds", ylab = "Sending proportion", ylim = c(0,1))
  lines(send_behavior, col = "blue", add = TRUE)
  rounds <- 1:length(send_behavior)
  reg1 <- lm (send_behavior ~ rounds)
  abline(reg1)
  cat("\n\n\\pagebreak\n")
}
```
  
\pagebreak

```{r, echo=FALSE}
for (type in 0:1) {
  send_behavior <- as.numeric()
  for (i in 1:(average_rounds*(num_users - 1))) {
    send_behavior <- c(send_behavior, mean (score_games[score_games$Period == i & score_games$my_send_proportional >= 0 & score_games$Type == type,]$my_send_proportional))
  }
  plot (send_behavior, main = (paste("Sending behavior of Score Games over time of: ", Type_names[(type + 1)])), xlab = "Rounds", ylab = "Sending proportion", ylim = c(0,1))
  lines(send_behavior, col = "green", add = TRUE)
  rounds <- 1:length(send_behavior)
  reg1 <- lm (send_behavior ~ rounds)
  abline(reg1)
  cat("\n\n\\pagebreak\n")
}
```
  
\pagebreak

```{r, echo=FALSE}
for (type in 0:1) {
  send_behavior <- as.numeric()
  for (i in 1:(average_rounds*(num_users - 1))) {
    send_behavior <- c(send_behavior, mean (combine_games[combine_games$Period == i & combine_games$my_send_proportional >= 0 & combine_games$Type == type,]$my_send_proportional))
  }
  plot (send_behavior, main = (paste("Sending behavior of Combine Games over time of: ", Type_names[(type + 1)])), xlab = "Rounds", ylab = "Sending proportion", ylim = c(0,1))
  lines(send_behavior, col = "yellow", add = TRUE)
  rounds <- 1:length(send_behavior)
  reg1 <- lm (send_behavior ~ rounds)
  abline(reg1)
  cat("\n\n\\pagebreak\n")
}
```

\pagebreak

date: Wed 7-Jun-2017
```{r, echo=FALSE}

game_lists <- list (simple_games, id_games, score_games, combine_games)
col_list <- c("red","green","blue","black")
for (type in 0:1) {
  
  plot(1, type="n", xlab="Round number", ylab="Send proportion", xlim=c(0, 25), ylim=c(0, 1))
  
  for (game_number in 1:4) {
    cur_games <- as.data.frame(game_lists[game_number])
    send_behavior <- as.numeric()
    for (i in 1:(average_rounds*(num_users - 1) - 1)) {
      send_behavior <- c(send_behavior, mean (cur_games[cur_games$Period %% 25 == i & cur_games$my_send_proportional >= 0 & cur_games$Type == type,]$my_send_proportional))
    }
    send_behavior <- c(send_behavior, mean (cur_games[cur_games$Period %% 25 == 0 & cur_games$my_send_proportional >= 0 & cur_games$Type == type,]$my_send_proportional))
    lines(y=send_behavior,x=1:25, col = col_list[game_number], type ="o")
    rounds <- 1:length(send_behavior)
    reg1 <- lm (send_behavior ~ rounds)
    # abline(reg1, col = col_list[game_number])
    print (paste("GAME:", GAME_NAMES[game_number], " for type:", Type_names[type+1]))
    print (summary (reg1))
  }
  
  legend(x=1,y=1,col=col_list,legend = GAME_NAMES, lty = 1)
  
  cat("\n\n\\pagebreak\n")
}

```

\pagebreak

### Standard deviation of each user by game

```{r, echo=FALSE}
for (type in 0:1) {
  df_lm <- data.frame ("id" = as.numeric(),
                       "GroupID" = as.numeric(),
                       "SHOW_TRUST" = as.numeric(),
                       "SHOW_ID" = as.numeric(),
                       "mean" = as.numeric(),
                       "std" = as.numeric()
                       )
  
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     0,
                     0,
                     round(mean(simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >= 0 & simple_game$Type == type,]$my_send_proportional, na.rm = TRUE), digits = 5),
                     round(pop.sd(simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >= 0 & simple_game$Type == type,]$my_send_proportional), digits = 5)
        )
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     0,
                     1,
                     round(mean(id_game[id_game$Subject == user_id & id_game$my_send_proportional >= 0 & id_game$Type == type,]$my_send_proportional, na.rm = TRUE), digits = 5),
                     round(pop.sd(id_game[id_game$Subject == user_id & id_game$my_send_proportional >= 0 & id_game$Type == type,]$my_send_proportional), digits = 5)
        )
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     1,
                     0,
                     round(mean(score_game[score_game$Subject == user_id & score_game$my_send_proportional >= 0 & score_game$Type == type,]$my_send_proportional, na.rm = TRUE), digits = 5),
                     round(pop.sd(score_game[score_game$Subject == user_id & score_game$my_send_proportional >= 0 & score_game$Type == type,]$my_send_proportional), digits = 5)
        )
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     1,
                     1,
                     round(mean(combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >= 0 & combine_game$Type == type,]$my_send_proportional, na.rm = TRUE), digits = 5),
                     round(pop.sd(combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >= 0 & combine_game$Type == type,]$my_send_proportional), digits = 5)
        )
        df_lm[(nrow(df_lm) + 1),] <- new_row
      }
  }
  
  # print (df_lm)
      
  df_lm$id <- as.factor(df_lm$id)
  df_lm$SHOW_TRUST <- as.factor(df_lm$SHOW_TRUST)
  df_lm$SHOW_ID <- as.factor (df_lm$SHOW_ID)
  df_lm$GroupID <- as.factor(df_lm$GroupID)
  
  print ("Anova analysis for standard deviation of relative sending")
  df_lm$score <- df_lm$std 
  anova_analysis(df = df_lm, type = type, num_way = 3)
  
  print ("Mean of standard deviation by game")
  print (mean(df_lm[df_lm$SHOW_ID == 0 & df_lm$SHOW_TRUST == 0,]$std, na.rm = TRUE))
  print (mean(df_lm[df_lm$SHOW_ID == 0 & df_lm$SHOW_TRUST == 1,]$std, na.rm = TRUE))
  print (mean(df_lm[df_lm$SHOW_ID == 1 & df_lm$SHOW_TRUST == 0,]$std, na.rm = TRUE))
  print (mean(df_lm[df_lm$SHOW_ID == 1 & df_lm$SHOW_TRUST == 1,]$std, na.rm = TRUE))
}
```

\pagebreak

### Behavior on trust score over time

We want to see the adaptation of user on trust score over time.

```{r, echo=FALSE}
  for (type in 0:1) {
    df_lm <- data.frame ("id" = as.numeric(),
                         "GroupID" = as.numeric(),
                         "SHOW_TRUST" = as.numeric(),
                         "SHOW_ID" = as.numeric(),
                         "slope1" = as.numeric(),
                         "slope2" = as.numeric(),
                         "intercept" = as.numeric(),
                         "r_squared" = as.numeric(),
                         "p_value" = as.numeric(),
                         "r_value" = as.numeric()
    )
    
    for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        send_behavior = simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >=0 & simple_game$Type == type,]$my_send_proportional
        rounds <- simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >=0 & simple_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- simple_game[simple_game$Subject == user_id & simple_game$my_send_proportional >=0 & simple_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds + trusts)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     0,
                     0,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[3]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5))
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        send_behavior = id_game[id_game$Subject == user_id & id_game$my_send_proportional >=0 & id_game$Type == type,]$my_send_proportional
        rounds <- id_game[id_game$Subject == user_id & id_game$my_send_proportional >=0 & id_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- id_game[id_game$Subject == user_id & id_game$my_send_proportional >=0 & id_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds + trusts)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     0,
                     1,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[3]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5))
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        send_behavior = score_game[score_game$Subject == user_id & score_game$my_send_proportional >=0 & score_game$Type == type,]$my_send_proportional
        rounds <- score_game[score_game$Subject == user_id & score_game$my_send_proportional >=0 & score_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- score_game[score_game$Subject == user_id & score_game$my_send_proportional >=0 & score_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds + trusts)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     1,
                     0,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[3]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5))
        df_lm[(nrow(df_lm) + 1),] <- new_row
        
        send_behavior = combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >=0 & combine_game$Type == type,]$my_send_proportional
        rounds <- combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >=0 & combine_game$Type == type,]$Period %% (average_rounds * (num_users - 1))
        trusts <- combine_game[combine_game$Subject == user_id & combine_game$my_send_proportional >=0 & combine_game$Type == type,]$showing_trust_score
        lm1 <- lm (send_behavior ~ rounds + trusts)
        new_row <- c(user_id + (exp_id - 1) * num_users,
                     exp_id,
                     1,
                     1,
                     round(as.numeric(lm1$coefficients[2]), digits = 5),
                     round(as.numeric(lm1$coefficients[3]), digits = 5),
                     round(as.numeric(lm1$coefficients[1]), digits = 5),
                     round(summary(lm1)$r.squared, digits = 5),
                     round(anova(lm1)$'Pr(>F)'[1], digits = 5),
                     round(cor(send_behavior, rounds), digits = 5))
        df_lm[(nrow(df_lm) + 1),] <- new_row
      }
    }
    
    # Plotting regression on trust of partner over time
    # before the transformation
    plot (y = df_lm$slope2, x = df_lm$slope1, main = paste ("Regression on trust over time of ", Type_names[type + 1]), xlab = "Slope of Round No", ylab = "Slope of trust of partners", pch = 16,
          col = ifelse (df_lm$SHOW_TRUST == 0 & df_lm$SHOW_ID == 0, "red",
                        ifelse(df_lm$SHOW_TRUST == 0 & df_lm$SHOW_ID == 1, "orange", 
                               ifelse(df_lm$SHOW_TRUST == 1 & df_lm$SHOW_ID == 0, "blue","green"))))
    legend(x=-0.08,y=2.5,c("Simple","ID","Score","Combine"),cex=.8, 
        col=c("red","orange","blue","green"),pch=16, bg = "white")
    
    #Make transformation
    df_lm$significane <- ifelse(df_lm$p_value <= 0.1, 1, 0)
    df_lm$slope1 <- df_lm$slope1 * df_lm$significane
    df_lm$slope2 <- df_lm$slope2 * df_lm$significane
    df_lm$intercept <- df_lm$intercept * df_lm$significane
    df_lm$r_value <- df_lm$r_value * df_lm$significane
    df_lm$r_squared <- NULL
    df_lm$significane <- ifelse (df_lm$p_value <= 0.05, "*", ifelse (df_lm$p_value <= 0.1, ".", ""))
    df_lm$p_value <- NULL
    
    # print (df_lm)
    
    sum_df_lm <- data.frame ("metric" <- as.character(),
                             "criteria" <- as.character(),
                             "Mean" <- as.numeric(),
                             "std" <- as.numeric(), stringsAsFactors = FALSE)
    
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Slope 1",
                                            "Without trust",
                                            round(mean(df_lm[df_lm$slope1 > 0 & df_lm$SHOW_TRUST == 0,]$slope1, na.rm = TRUE), digits = 5),
                                            round(pop.sd(df_lm[df_lm$slope1 > 0 & df_lm$SHOW_TRUST == 0,]$slope1), digits = 5))
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Slope 1",
                                            "With trust",
                                            round (mean(df_lm[df_lm$slope1 > 0 & df_lm$SHOW_TRUST == 1,]$slope1, na.rm = TRUE), digits =  5),
                                            round (pop.sd(df_lm[df_lm$slope1 > 0 & df_lm$SHOW_TRUST == 1,]$slope1), digits = 5))
    
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Slope 2",
                                            "Without trust",
                                            round(mean(df_lm[df_lm$slope2 > 0 & df_lm$SHOW_TRUST == 0,]$slope2, na.rm = TRUE), digits = 5),
                                            round(pop.sd(df_lm[df_lm$slope2 > 0 & df_lm$SHOW_TRUST == 0,]$slope2), digits = 5))
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Slope 2",
                                            "With trust",
                                            round (mean(df_lm[df_lm$slope2 > 0 & df_lm$SHOW_TRUST == 1,]$slope2, na.rm = TRUE), digits =  5),
                                            round (pop.sd(df_lm[df_lm$slope2 > 0 & df_lm$SHOW_TRUST == 1,]$slope2), digits = 5))
    
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Intercept",
                                            "Without trust",
                                            round (mean(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 0,]$intercept, na.rm = TRUE), digits = 5),
                                            round (pop.sd(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 0,]$intercept), digits = 5))
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("Intercept",
                                            "With trust",
                                            round (mean(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 1,]$intercept, na.rm = TRUE), digits = 5),
                                            round (pop.sd(df_lm[df_lm$intercept > 0 & df_lm$SHOW_TRUST == 1,]$intercept), digits = 5))
    
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                            "Without trust",
                                            round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 0,]$r_value, na.rm = TRUE), digits = 5),
                                            round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 0,]$r_value), digits = 5))
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                            "With trust",
                                            round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 1,]$r_value, na.rm = TRUE), digits = 5),
                                            round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_TRUST == 1,]$r_value), digits = 5))
    
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                            "Without ID",
                                            round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 0,]$r_value, na.rm = TRUE), digits = 5),
                                            round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 0,]$r_value), digits = 5))
    sum_df_lm [(nrow(sum_df_lm) + 1),] <- c("r_value",
                                            "With ID",
                                            round (mean(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 1,]$r_value, na.rm = TRUE), digits = 2),
                                            round (pop.sd(df_lm[df_lm$r_value > 0 & df_lm$SHOW_ID == 1,]$r_value), digits = 2))
    
    print (sum_df_lm)
    
    df_lm$id <- as.factor(df_lm$id)
    df_lm$SHOW_TRUST <- as.factor(df_lm$SHOW_TRUST)
    df_lm$SHOW_ID <- as.factor (df_lm$SHOW_ID)
    df_lm$GroupID <- as.factor(df_lm$GroupID)
    
    print ("Anova analysis for slope of round ID")
    df_lm$score <- df_lm$slope1
    anova_analysis(df = df_lm, type = type, num_way = 3)
    
    print ("Anova analysis for slope of trust of partners")
    df_lm$score <- df_lm$slope2
    anova_analysis(df = df_lm, type = type, num_way = 3)
    
    print ("Anova analysis for intercept")
    df_lm$score <- df_lm$intercept 
    anova_analysis(df = df_lm, type = type, num_way = 3)
    
    print ("Anova analysis for R value")
    df_lm$score <- df_lm$r_value 
    anova_analysis(df = df_lm, type = type, num_way = 3)
  }
```

\pagebreak

# Questionaire analysis

In this section, we present the summary of questionaire we asked participants after the experiment
```{r}
  print ("What game the receivers will send back most, with the same amount of sending first?")
  print (summary (SBJs$receive_back_most))
  print ("What game is best for personal earning?")
  print (summary (SBJs$best_personal))
  print ("What game is worst for personal earning?")
  print (summary (SBJs$worst_personal))
  print ("What game is best for total earning?")
  print (summary (SBJs$best_total))
  print ("What game is worst for total earning?")
  print (summary (SBJs$worst_total))
  
  print ("In Simple Game, profit is higher if you send more?")
  print (summary (SBJs$send_more_for_profit))
  print ("In Simple Game, profit is higher if you send less?")
  print (summary (SBJs$send_less_for_profit))
  
  print ("In Simple Game, you are receive, you send back more if your sender send more?")
  print (summary (SBJs$trust_help_receiver))
  
  print ("Show ID and Score help to realize behavior of partners in the history?")
  print (summary (SBJs$show_id_help))
  print (summary (SBJs$show_score_help))
  print (summary (SBJs$show_combine_help))
  
  print ("In Combine game, trust score reflects correct behavior of the partner?")
  print (summary (SBJs$trust_score_correctness))
  
  print ("In Score game, you send more if your partner has higher trust score?")
  print (summary (SBJs$trust_help_sender))
  
  print ("Showing ID and score help you decide how to behave?")
  print (summary (SBJs$identity_help_decide))
  print (summary (SBJs$trust_score_help_decide))
  print (summary (SBJs$combine_help_decide))
  
  print ("What factor is more important?")
  print (summary (SBJs$important_factor))
  
  print ("Do you think your partners are fair?")
  print (summary (SBJs$partner_fair))
```

\pagebreak

## Chi square test between factorial questions

We want to see if the questionaire showed the correct experience of users.

For factorial question, we will calculate chi - square test to see whether they are significant or not.

```{r echo=FALSE}
chi_square <- function (question1, question2) {
  mm <- matrix(0,4,4)
  for (i in 1:length(question1)) {
    if (as.numeric(question1[i]) <= 4 & as.numeric(question2[i]) <= 4) {
      mm [as.numeric(question1[i]), as.numeric(question2[i])] = mm [as.numeric(question1[i]), as.numeric(question2[i])] + 1
    }
  }
  print (mm)
  print  (fisher.test(mm))
}
```

```{r}
  chi_square (SBJs$receive_back_most, SBJs$best_personal)
```
```{r}
  chi_square (SBJs$receive_back_most, SBJs$worst_personal)
```
```{r}
  chi_square (SBJs$receive_back_most, SBJs$best_total)
```
```{r}
  chi_square (SBJs$receive_back_most, SBJs$worst_total)
```
```{r}
  chi_square (SBJs$best_personal, SBJs$worst_personal)
```
```{r}
  chi_square (SBJs$best_personal, SBJs$best_total)
```
```{r}
  chi_square (SBJs$best_personal, SBJs$worst_total)
```
```{r}
  chi_square (SBJs$worst_personal, SBJs$best_total)
```
```{r}
  chi_square (SBJs$worst_personal, SBJs$worst_total)
```
```{r}
  chi_square (SBJs$best_total, SBJs$worst_total)
```

\pagebreak

## Comparing questionaire with real data

### Highest sending back

In the first question, we ask what game the receivers will send back most, given the same amount of sending first by senders.

First, we analyze for all games. From the above analysis (basic data analysis), we know the increasing order is: Simple Game < Score Game < ID Game < Combine Game, but actually the difference between 3 last games are very small.

### Best and worst game for personal earning and total earning

In the questionarie, for the best game, 16 people selected game 4, 9 selected game 3 (Score Game), 3 and 2 selected Game 2 (ID Game) and Game 1 (Simple Game) respectively.

For the worst game, the numbers are: 26 for game 1, 1 for Game 3 and 3 for Game 4.

For best game for total earnings, 

We can analyze the data to see what is the correct answer, the numbers selected Game 1, 2, 3, 4 are 1, 3, 10, 15 respectively, and there is 1 person has no idea

For the worst, the numbers are 24, 2, 1, 2, and again there is 1 person has no idea.

```{r}
  best_personal_earnings = c(0, 0, 0, 0)
  worst_personal_earnings = c (0, 0, 0, 0)
  best_total_earnings = c (0, 0, 0, 0)
  worst_total_earnings = c (0, 0, 0, 0)
  
  real_best_personal = as.numeric()
  real_worst_personal = as.numeric ()
  real_best_total = as.numeric ()
  real_worst_total = as.numeric()
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        earning = c(sum(simple_game[simple_game$Subject == user_id,]$CurrGameProfit),
                    sum(id_game[id_game$Subject == user_id,]$CurrGameProfit),
                    sum(score_game[score_game$Subject == user_id,]$CurrGameProfit),
                    sum(combine_game[combine_game$Subject == user_id,]$CurrGameProfit))
        best_personal_earnings [which.max(earning)] = best_personal_earnings [which.max(earning)] + 1
        worst_personal_earnings [which.min(earning)] = worst_personal_earnings [which.min(earning)] + 1
        real_best_personal <- c (real_best_personal, which.max(earning))
        real_worst_personal <- c (real_worst_personal, which.min(earning))
      }
      earning = c(sum(simple_game$CurrGameProfit),
                    sum(id_game$CurrGameProfit),
                    sum(score_game$CurrGameProfit),
                    sum(combine_game$CurrGameProfit))
      best_total_earnings [which.max(earning)] = best_total_earnings [which.max(earning)] + 1
      worst_total_earnings[which.min(earning)] = worst_total_earnings[which.min(earning)] + 1
      
      real_best_total <- c(real_best_total, which.max(earning))
      real_worst_total <- c(real_worst_total, which.min(earning))
  }
  print (best_personal_earnings)
  print (worst_personal_earnings)
  print (best_total_earnings)
  print (worst_total_earnings)
  
  print ("Comparing questionnaire with real data, one by one")
  print (data.frame(SBJs$best_personal, real_best_personal))
  print (data.frame(SBJs$worst_personal, real_worst_personal))
  print (data.frame(SBJs$best_total, real_best_total))
  print (data.frame(SBJs$worst_total, real_worst_total))
```

\pagebreak

## Consitency between questionnaire and real data in best personal earning

```{r}
  
  # profit of game people believe that it is the best
  best_person_earning_questionnaire = as.numeric()
  worst_person_earning_questionnaire = as.numeric()
  
  # profit of game which is really best for personal earning
  real_best_person_earning = as.numeric()
  real_worst_person_earning = as.numeric()
  
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        earning = c(sum(simple_game[simple_game$Subject == user_id,]$CurrGameProfit),
                    sum(id_game[id_game$Subject == user_id,]$CurrGameProfit),
                    sum(score_game[score_game$Subject == user_id,]$CurrGameProfit),
                    sum(combine_game[combine_game$Subject == user_id,]$CurrGameProfit))
        
        best_person_earning_questionnaire <- c(best_person_earning_questionnaire, earning[as.numeric(SBJs$best_personal[(user_id + (exp_id - 1) * num_users)])])
        real_best_person_earning <- c (real_best_person_earning, max(earning))
        
        worst_person_earning_questionnaire <- c(worst_person_earning_questionnaire, earning[as.numeric(SBJs$worst_personal[(user_id + (exp_id - 1) * num_users)])])
        real_worst_person_earning <- c (real_worst_person_earning, min(earning))
#         print ("---")
#         print (earning[as.numeric(SBJs$worst_personal[(user_id + (exp_id - 1) * num_users)])])
#         print (min(earning))
      }
  }
  
  print (t.test(best_person_earning_questionnaire, real_best_person_earning, paired = TRUE))
  
  print (t.test(worst_person_earning_questionnaire, real_worst_person_earning, paired = TRUE))
```


\pagebreak

## Chi square test between questionnaire and real data

```{r}
  best_personal_earnings = c(0, 0, 0, 0)
  worst_personal_earnings = c (0, 0, 0, 0)
  best_total_earnings = c (0, 0, 0, 0)
  worst_total_earnings = c (0, 0, 0, 0)
  
  real_best_personal = as.numeric()
  real_worst_personal = as.numeric ()
  real_best_total = as.numeric ()
  real_worst_total = as.numeric()
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        earning = c(sum(simple_game[simple_game$Subject == user_id,]$CurrGameProfit),
                    sum(id_game[id_game$Subject == user_id,]$CurrGameProfit),
                    sum(score_game[score_game$Subject == user_id,]$CurrGameProfit),
                    sum(combine_game[combine_game$Subject == user_id,]$CurrGameProfit))
        best_personal_earnings [which.max(earning)] = best_personal_earnings [which.max(earning)] + 1
        worst_personal_earnings [which.min(earning)] = worst_personal_earnings [which.min(earning)] + 1
        real_best_personal <- c (real_best_personal, which.max(earning))
        real_worst_personal <- c (real_worst_personal, which.min(earning))
      }
      earning = c(sum(simple_game$CurrGameProfit),
                    sum(id_game$CurrGameProfit),
                    sum(score_game$CurrGameProfit),
                    sum(combine_game$CurrGameProfit))
      best_total_earnings [which.max(earning)] = best_total_earnings [which.max(earning)] + 1
      worst_total_earnings[which.min(earning)] = worst_total_earnings[which.min(earning)] + 1
      
      # repeat 6 times for 6 users
      # because all of 6 users have the same best game for total earning
      for (i in 1:num_users) {
        real_best_total <- c(real_best_total, which.max(earning))
        real_worst_total <- c(real_worst_total, which.min(earning))
      }
  }
  
  chi_square (SBJs$best_personal, real_best_personal)
  chi_square (SBJs$worst_personal, real_worst_personal)
  chi_square (SBJs$best_total, real_best_total)
  chi_square (SBJs$worst_total, real_worst_total)
```

\pagebreak

## Chi square after reducing the dimension of game

Above, we analyze chi - square for each game (game 1, 2, 3, 4). In this section, we reduce the game to games: without and with trust, or without and with ID.

```{r echo=FALSE}
chi_square_2x2 <- function (question1, question2) {
  question1 <- ifelse(question1 == 0, 2 ,1)
  question2 <- ifelse(question2 == 0, 2 ,1)
  
  mm <- matrix(0,2,2)
  for (i in 1:length(question1)) {
    if (as.numeric(question1[i]) <= 2 & as.numeric(question2[i]) <= 2) {
      mm [as.numeric(question1[i]), as.numeric(question2[i])] = mm [as.numeric(question1[i]), as.numeric(question2[i])] + 1
    }
  }
  print (mm)
  print  (fisher.test(mm))
}
```

```{r}
  best_personal_earnings = c(0, 0, 0, 0)
  worst_personal_earnings = c (0, 0, 0, 0)
  best_total_earnings = c (0, 0, 0, 0)
  worst_total_earnings = c (0, 0, 0, 0)
  
  real_best_personal = as.numeric()
  real_worst_personal = as.numeric ()
  real_best_total = as.numeric ()
  real_worst_total = as.numeric()
  for (exp_id in 1:num_exp) {
      first_round_of_exp_subjects = (exp_id - 1) * num_rounds_per_game * num_users + 1
      last_round_of_exp_subjects = exp_id * num_rounds_per_game * num_users
      
      simple_game = simple_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      id_game = id_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      score_game = score_games [first_round_of_exp_subjects:last_round_of_exp_subjects,]
      combine_game = combine_games[first_round_of_exp_subjects:last_round_of_exp_subjects,]
      
      for (user_id in 1:num_users) {
        earning = c(sum(simple_game[simple_game$Subject == user_id,]$CurrGameProfit),
                    sum(id_game[id_game$Subject == user_id,]$CurrGameProfit),
                    sum(score_game[score_game$Subject == user_id,]$CurrGameProfit),
                    sum(combine_game[combine_game$Subject == user_id,]$CurrGameProfit))
        best_personal_earnings [which.max(earning)] = best_personal_earnings [which.max(earning)] + 1
        worst_personal_earnings [which.min(earning)] = worst_personal_earnings [which.min(earning)] + 1
        real_best_personal <- c (real_best_personal, which.max(earning))
        real_worst_personal <- c (real_worst_personal, which.min(earning))
      }
      earning = c(sum(simple_game$CurrGameProfit),
                    sum(id_game$CurrGameProfit),
                    sum(score_game$CurrGameProfit),
                    sum(combine_game$CurrGameProfit))
      best_total_earnings [which.max(earning)] = best_total_earnings [which.max(earning)] + 1
      worst_total_earnings[which.min(earning)] = worst_total_earnings[which.min(earning)] + 1
      
      # repeat 6 times for 6 users
      # because all of 6 users have the same best game for total earning
      for (i in 1:num_users) {
        real_best_total <- c(real_best_total, which.max(earning))
        real_worst_total <- c(real_worst_total, which.min(earning))
      }
  }
  
  print ("Without and with trust")
  chi_square_2x2 (floor(as.numeric (SBJs$best_personal)/2), floor ( as.numeric (real_best_personal)/2))
  print ("Without and with ID")
  chi_square_2x2 (floor(as.numeric (SBJs$best_personal)%%2), floor (as.numeric (real_best_personal)%%2))
  
  print ("Without and with trust")
  chi_square_2x2 (floor( as.numeric (SBJs$worst_personal)/2), floor ( as.numeric (real_worst_personal)/2))
  print ("Without and with ID")
  chi_square_2x2 (floor( as.numeric (SBJs$worst_personal)%%2), floor (real_worst_personal%%2))
  
  print ("Without and with trust")
  chi_square_2x2 (floor( as.numeric (SBJs$best_total)/2), floor (real_best_total/2))
  print ("Without and with ID")
  chi_square_2x2 (floor( as.numeric (SBJs$best_total)%%2), floor (real_best_total%%2))
  
  print ("Without and with trust")
  chi_square_2x2 (floor( as.numeric (SBJs$worst_total)/2), floor (real_worst_total/2))
  print ("Without and with ID")
  chi_square_2x2 (floor( as.numeric (SBJs$worst_total)%%2), floor (real_worst_total%%2))
```